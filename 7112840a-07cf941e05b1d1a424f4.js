/*! For license information please see 7112840a-07cf941e05b1d1a424f4.js.LICENSE.txt */
"use strict";(self.webpackChunkbugoverdose=self.webpackChunkbugoverdose||[]).push([[16],{2040:function(e,t,n){n.d(t,{u7:function(){return Xl},Jj:function(){return Wc},IX:function(){return Oc},my:function(){return xc},xU:function(){return Nl},Lz:function(){return zc},WA:function(){return V},F8:function(){return Yc},$q:function(){return Al},W:function(){return _l},EK:function(){return ee},PU:function(){return th},l7:function(){return we},Ky:function(){return Te},Xb:function(){return se},Cf:function(){return mc},K9:function(){return L},Me:function(){return le},yq:function(){return D},Wi:function(){return dc},ET:function(){return dh},Ab:function(){return Ih},vr:function(){return xh},Fc:function(){return qc},hJ:function(){return Ec},B$:function(){return Sc},at:function(){return bc},oe:function(){return fh},AK:function(){return wh},TF:function(){return Kc},JU:function(){return Nc},ST:function(){return Pc},fH:function(){return Vc},Ix:function(){return Bc},Wu:function(){return zl},Lx:function(){return Ql},qY:function(){return Lc},GL:function(){return ph},QT:function(){return rh},kl:function(){return ah},Xk:function(){return uh},PL:function(){return oh},UQ:function(){return sh},zN:function(){return ch},nP:function(){return Th},b9:function(){return ql},vh:function(){return Ul},Pb:function(){return Gc},L$:function(){return jc},cf:function(){return vh},sc:function(){return yh},Xo:function(){return Vl},IO:function(){return Rl},iE:function(){return _c},Eo:function(){return Ac},i3:function(){return kh},Bt:function(){return bh},pl:function(){return lh},Ub:function(){return A},qK:function(){return Dl},TQ:function(){return Gl},e0:function(){return Kl},r7:function(){return hh},Mx:function(){return Uc},ar:function(){return Ml}});var r=n(2826),i=n(8052),a=n(885),u=n(5861),o=n(136),s=n(6215),c=n(1120),l=n(2982),h=n(5671),f=n(3144),d=n(7757),v=n.n(d),y=n(7626),p=n(1215),m=n(2212),g=n(1584),k=n(1337);function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var I="@firebase/firestore",T=function(){function e(t){(0,h.Z)(this,e),this.uid=t}return(0,f.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();T.UNAUTHENTICATED=new T(null),T.GOOGLE_CREDENTIALS=new T("google-credentials-uid"),T.FIRST_PARTY=new T("first-party-uid"),T.MOCK_USER=new T("mock-user");var E="9.6.7",S=new m.Yd("@firebase/firestore");function N(){return S.logLevel}function A(e){S.setLogLevel(e)}function _(e){if(S.logLevel<=m.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(C);S.debug.apply(S,["Firestore (".concat(E,"): ").concat(e)].concat((0,l.Z)(i)))}}function Z(e){if(S.logLevel<=m.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(C);S.error.apply(S,["Firestore (".concat(E,"): ").concat(e)].concat((0,l.Z)(i)))}}function D(e){if(S.logLevel<=m.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(C);S.warn.apply(S,["Firestore (".concat(E,"): ").concat(e)].concat((0,l.Z)(i)))}}function C(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(E,") INTERNAL ASSERTION FAILED: ")+e;throw Z(t),new Error(t)}function R(e,t){e||O()}function L(e,t){e||O()}function M(e,t){return e}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,f.Z)(n)}(g.ZR),F=(0,f.Z)((function e(){var t=this;(0,h.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),q=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),U=function(){function e(){(0,h.Z)(this,e)}return(0,f.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(T.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),B=function(){function e(t){(0,h.Z)(this,e),this.token=t,this.changeListener=null}return(0,f.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),K=function(){function e(t){(0,h.Z)(this,e),this.t=t,this.currentUser=T.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,f.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new F;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new F,e.enqueueRetryable((function(){return i(n.currentUser)}))};var o=function(){var t=a;e.enqueueRetryable((0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},s=function(e){_("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return s(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?s(e):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new F)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(R("string"==typeof n.accessToken),new q(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return R(null===e||"string"==typeof e),new T(e)}}]),e}(),G=(0,f.Z)((function e(t,n,r){(0,h.Z)(this,e),this.type="FirstParty",this.user=T.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",n);var i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)})),j=function(){function e(t,n,r){(0,h.Z)(this,e),this.h=t,this.l=n,this.m=r}return(0,f.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new G(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(T.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),Q=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),z=function(){function e(t){(0,h.Z)(this,e),this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}return(0,f.Z)(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&_("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.p;return n.p=e.token,_("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable((function(){return r(t)}))};var i=function(e){_("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.g.onInit((function(e){return i(e)})),setTimeout((function(){if(!n.appCheck){var e=n.g.getImmediate({optional:!0});e?i(e):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((function(t){return t?(R("string"==typeof t.token),e.p=t.token,new Q(t.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}(),W=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.I(e)},this.T=function(e){return n.writeSequenceNumber(e)})}return(0,f.Z)(e,[{key:"I",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.T&&this.T(e),e}}]),e}();function H(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}W.A=-1;var Y=function(){function e(){(0,h.Z)(this,e)}return(0,f.Z)(e,null,[{key:"R",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=H(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function J(e,t){return e<t?-1:e>t?1:0}function X(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function $(e){return e+"\0"}var ee=function(){function e(t,n){if((0,h.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,f.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),te=function(){function e(t){(0,h.Z)(this,e),this.timestamp=t}return(0,f.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new ee(0,0))}}]),e}();function ne(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function re(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ie(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var ae=function(){function e(t,n,r){(0,h.Z)(this,e),void 0===n?n=0:n>t.length&&O(),void 0===r?r=t.length-n:r>t.length-n&&O(),this.segments=t,this.offset=n,this.len=r}return(0,f.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),ue=function(e){(0,o.Z)(n,e);var t=x(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,u=r;a<u.length;a++){var o=u[a];if(o.indexOf("//")>=0)throw new V(P.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push.apply(e,(0,l.Z)(o.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(ae),oe=/^[_a-zA-Z][_a-zA-Z0-9]*$/,se=function(e){(0,o.Z)(n,e);var t=x(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return oe.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new V(P.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},u=!1;i<e.length;){var o=e[i];if("\\"===o){if(i+1===e.length)throw new V(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new V(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===o?(u=!u,i++):"."!==o||u?(r+=o,i++):(a(),i++)}if(a(),u)throw new V(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(ae),ce=function(){function e(t){(0,h.Z)(this,e),this.fields=t,t.sort(se.comparator)}return(0,f.Z)(e,[{key:"covers",value:function(e){var t,n=w(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return X(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}]),e}();function le(){return"undefined"!=typeof atob}var he=function(e){function t(e){(0,h.Z)(this,t),this.binaryString=e}return(0,f.Z)(t,[{key:e,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return J(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(atob(e))}},{key:"fromUint8Array",value:function(e){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new t(n)}}]),t}(Symbol.iterator);he.EMPTY_BYTE_STRING=new he("");var fe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function de(e){if(R(!!e),"string"==typeof e){var t=0,n=fe.exec(e);if(R(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:ve(e.seconds),nanos:ve(e.nanos)}}function ve(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ye(e){return"string"==typeof e?he.fromBase64String(e):he.fromUint8Array(e)}function pe(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function me(e){var t=e.mapValue.fields.__previous_value__;return pe(t)?me(t):t}function ge(e){var t=de(e.mapValue.fields.__local_write_time__.timestampValue);return new ee(t.seconds,t.nanos)}var ke=(0,f.Z)((function e(t,n,r,i,a,u,o,s){(0,h.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=o,this.useFetchStreams=s})),we=function(){function e(t,n){(0,h.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,f.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}();function be(e){return null==e}function xe(e){return 0===e&&1/e==-1/0}function Ie(e){return"number"==typeof e&&Number.isInteger(e)&&!xe(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var Te=function(){function e(t){(0,h.Z)(this,e),this.path=t}return(0,f.Z)(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===ue.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(ue.fromString(t))}},{key:"fromName",value:function(t){return new e(ue.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(ue.emptyPath())}},{key:"comparator",value:function(e,t){return ue.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new ue(t.slice()))}}]),e}(),Ee={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function Se(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?pe(e)?4:10:O()}function Ne(e,t){if(e===t)return!0;var n=Se(e);if(n!==Se(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ge(e).isEqual(ge(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=de(e.timestampValue),r=de(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ye(e.bytesValue).isEqual(ye(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ve(e.geoPointValue.latitude)===ve(t.geoPointValue.latitude)&&ve(e.geoPointValue.longitude)===ve(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ve(e.integerValue)===ve(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=ve(e.doubleValue),r=ve(t.doubleValue);return n===r?xe(n)===xe(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return X(e.arrayValue.values||[],t.arrayValue.values||[],Ne);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ne(n)!==ne(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ne(n[i],r[i])))return!1;return!0}(e,t);default:return O()}}function Ae(e,t){return void 0!==(e.values||[]).find((function(e){return Ne(e,t)}))}function _e(e,t){if(e===t)return 0;var n=Se(e),r=Se(t);if(n!==r)return J(n,r);switch(n){case 0:return 0;case 1:return J(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=ve(e.integerValue||e.doubleValue),r=ve(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ze(e.timestampValue,t.timestampValue);case 4:return Ze(ge(e),ge(t));case 5:return J(e.stringValue,t.stringValue);case 6:return function(e,t){var n=ye(e),r=ye(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=J(n[i],r[i]);if(0!==a)return a}return J(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=J(ve(e.latitude),ve(t.latitude));return 0!==n?n:J(ve(e.longitude),ve(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=_e(n[i],r[i]);if(a)return a}return J(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var u=0;u<r.length&&u<a.length;++u){var o=J(r[u],a[u]);if(0!==o)return o;var s=_e(n[r[u]],i[a[u]]);if(0!==s)return s}return J(r.length,a.length)}(e.mapValue,t.mapValue);default:throw O()}}function Ze(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return J(e,t);var n=de(e),r=de(t),i=J(n.seconds,r.seconds);return 0!==i?i:J(n.nanos,r.nanos)}function De(e){return Ce(e)}function Ce(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=de(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ye(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Te.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=w(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=Ce(a)}}catch(u){i.e(u)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n="{",r=!0,i=w(Object.keys(e.fields||{}).sort());try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+="".concat(a,":").concat(Ce(e.fields[a]))}}catch(u){i.e(u)}finally{i.f()}return n+"}"}(e.mapValue):O();var t,n}function Oe(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Re(e){return!!e&&"integerValue"in e}function Le(e){return!!e&&"arrayValue"in e}function Me(e){return!!e&&"nullValue"in e}function Pe(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ve(e){return!!e&&"mapValue"in e}function Fe(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return re(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Fe(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Fe(e.arrayValue.values[r]);return n}return Object.assign({},e)}var qe=function(){function e(t){(0,h.Z)(this,e),this.value=t}return(0,f.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Ve(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Fe(t)}},{key:"setAll",value:function(e){var t=this,n=se.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var u=t.getFieldsMap(n);t.applyChanges(u,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Fe(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());Ve(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return Ne(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Ve(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){re(t,(function(t,n){return e[t]=n}));var r,i=w(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(u){i.e(u)}finally{i.f()}}},{key:"clone",value:function(){return new e(Fe(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Ue(e){var t=[];return re(e.fields,(function(e,n){var r=new se([e]);if(Ve(n)){var i=Ue(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,u=w(i);try{for(u.s();!(a=u.n()).done;){var o=a.value;t.push(r.child(o))}}catch(s){u.e(s)}finally{u.f()}}}else t.push(r)})),new ce(t)}var Be=function(){function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.data=a,this.documentState=u}return(0,f.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=qe.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=qe.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,te.min(),te.min(),qe.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,te.min(),r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,te.min(),qe.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,te.min(),qe.empty(),2)}}]),e}(),Ke=(0,f.Z)((function e(t,n,r,i){(0,h.Z)(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}));Ke.UNKNOWN_ID=-1;var Ge=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.fieldPath=t,this.kind=n})),je=function(){function e(t,n){(0,h.Z)(this,e),this.sequenceNumber=t,this.offset=n}return(0,f.Z)(e,null,[{key:"empty",value:function(){return new e(0,Qe.min())}}]),e}(),Qe=function(){function e(t,n,r){(0,h.Z)(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return(0,f.Z)(e,null,[{key:"min",value:function(){return new e(te.min(),Te.empty(),-1)}}]),e}(),ze=(0,f.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,h.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=u,this.endAt=o,this.P=null}));function We(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new ze(e,t,n,r,i,a,u)}function He(e){var t=M(e);if(null===t.P){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return(t=e).field.canonicalString()+t.op.toString()+De(t.value);var t})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),be(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((function(e){return De(e)})).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((function(e){return De(e)})).join(",")),t.P=n}return t.P}function Ye(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!ct(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!Ne(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ht(e.startAt,t.startAt)&&ht(e.endAt,t.endAt)}function Je(e){return Te.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var Xe=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,f.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.V(_e(t,this.value)):null!==t&&Se(this.value)===Se(t)&&this.V(_e(t,this.value))}},{key:"V",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return O()}}},{key:"S",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.v(e,t,r):new $e(e,t,r):"array-contains"===t?new rt(e,r):"in"===t?new it(e,r):"not-in"===t?new at(e,r):"array-contains-any"===t?new ut(e,r):new n(e,t,r)}},{key:"v",value:function(e,t,n){return"in"===t?new et(e,n):new tt(e,n)}}]),n}(function(){return(0,f.Z)((function e(){(0,h.Z)(this,e)}))}()),$e=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this,e,r,i)).key=Te.fromName(i.referenceValue),a}return(0,f.Z)(n,[{key:"matches",value:function(e){var t=Te.comparator(e.key,this.key);return this.V(t)}}]),n}(Xe),et=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,"in",r)).keys=nt("in",r),i}return(0,f.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Xe),tt=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=nt("not-in",r),i}return(0,f.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Xe);function nt(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return Te.fromName(e.referenceValue)}))}var rt=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,f.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return Le(t)&&Ae(t.arrayValue,this.value)}}]),n}(Xe),it=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"in",r)}return(0,f.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&Ae(this.value.arrayValue,t)}}]),n}(Xe),at=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"not-in",r)}return(0,f.Z)(n,[{key:"matches",value:function(e){if(Ae(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Ae(this.value.arrayValue,t)}}]),n}(Xe),ut=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,f.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!Le(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return Ae(t.value.arrayValue,e)}))}}]),n}(Xe),ot=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.position=t,this.inclusive=n})),st=(0,f.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,h.Z)(this,e),this.field=t,this.dir=n}));function ct(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function lt(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],u=e.position[i];if(r=a.field.isKeyField()?Te.comparator(Te.fromName(u.referenceValue),n.key):_e(u,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function ht(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Ne(e.position[n],t.position[n]))return!1;return!0}var ft=(0,f.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,h.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=u,this.startAt=o,this.endAt=s,this.D=null,this.C=null,this.startAt,this.endAt}));function dt(e,t,n,r,i,a,u,o){return new ft(e,t,n,r,i,a,u,o)}function vt(e){return new ft(e)}function yt(e){return!be(e.limit)&&"F"===e.limitType}function pt(e){return!be(e.limit)&&"L"===e.limitType}function mt(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function gt(e){var t,n=w(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.S())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function kt(e){return null!==e.collectionGroup}function wt(e){var t=M(e);if(null===t.D){t.D=[];var n=gt(t),r=mt(t);if(null!==n&&null===r)n.isKeyField()||t.D.push(new st(n)),t.D.push(new st(se.keyField(),"asc"));else{var i,a=!1,u=w(t.explicitOrderBy);try{for(u.s();!(i=u.n()).done;){var o=i.value;t.D.push(o),o.field.isKeyField()&&(a=!0)}}catch(c){u.e(c)}finally{u.f()}if(!a){var s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.D.push(new st(se.keyField(),s))}}}return t.D}function bt(e){var t=M(e);if(!t.C)if("F"===t.limitType)t.C=We(t.path,t.collectionGroup,wt(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=w(wt(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,u="desc"===a.dir?"asc":"desc";r.push(new st(a.field,u))}}catch(c){i.e(c)}finally{i.f()}var o=t.endAt?new ot(t.endAt.position,!t.endAt.inclusive):null,s=t.startAt?new ot(t.startAt.position,!t.startAt.inclusive):null;t.C=We(t.path,t.collectionGroup,r,t.filters,t.limit,o,s)}return t.C}function xt(e,t,n){return new ft(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function It(e,t){return Ye(bt(e),bt(t))&&e.limitType===t.limitType}function Tt(e){return"".concat(He(bt(e)),"|lt:").concat(e.limitType)}function Et(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(De(t.value));var t})).join(", "),"]")),be(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((function(e){return De(e)})).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((function(e){return De(e)})).join(",")),"Target(".concat(t,")")}(bt(e)),"; limitType=").concat(e.limitType,")")}function St(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Te.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=w(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=w(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=lt(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,wt(e),t))&&!(e.endAt&&!function(e,t,n){var r=lt(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,wt(e),t))}(e,t)}function Nt(e){return function(t,n){var r,i=!1,a=w(wt(e));try{for(a.s();!(r=a.n()).done;){var u=r.value,o=At(u,t,n);if(0!==o)return o;i=i||u.field.isKeyField()}}catch(s){a.e(s)}finally{a.f()}return 0}}function At(e,t,n){var r=e.field.isKeyField()?Te.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?_e(r,i):O()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return O()}}function _t(e,t){if(e.N){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xe(t)?"-0":t}}function Zt(e){return{integerValue:""+e}}function Dt(e,t){return Ie(t)?Zt(t):_t(e,t)}var Ct=(0,f.Z)((function e(){(0,h.Z)(this,e),this._=void 0}));function Ot(e,t,n){return e instanceof Mt?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Pt?Vt(e,t):e instanceof Ft?qt(e,t):function(e,t){var n=Lt(e,t),r=Bt(n)+Bt(e.k);return Re(n)&&Re(e.k)?Zt(r):_t(e.O,r)}(e,t)}function Rt(e,t,n){return e instanceof Pt?Vt(e,t):e instanceof Ft?qt(e,t):n}function Lt(e,t){return e instanceof Ut?Re(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var Mt=function(e){(0,o.Z)(n,e);var t=x(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n)}(Ct),Pt=function(e){(0,o.Z)(n,e);var t=x(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,f.Z)(n)}(Ct);function Vt(e,t){var n,r=Kt(t),i=w(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return Ne(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Ft=function(e){(0,o.Z)(n,e);var t=x(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,f.Z)(n)}(Ct);function qt(e,t){var n,r=Kt(t),i=w(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!Ne(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Ut=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).O=e,i.k=r,i}return(0,f.Z)(n)}(Ct);function Bt(e){return ve(e.integerValue||e.doubleValue)}function Kt(e){return Le(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Gt=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.field=t,this.transform=n}));var jt=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.version=t,this.transformResults=n})),Qt=function(){function e(t,n){(0,h.Z)(this,e),this.updateTime=t,this.exists=n}return(0,f.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function zt(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Wt=(0,f.Z)((function e(){(0,h.Z)(this,e)}));function Ht(e,t,n){e instanceof en?function(e,t,n){var r=e.value.clone(),i=rn(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof tn?function(e,t,n){if(zt(e.precondition,t)){var r=rn(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(nn(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Yt(e,t,n){e instanceof en?function(e,t,n){if(zt(e.precondition,t)){var r=e.value.clone(),i=an(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument($t(t),r).setHasLocalMutations()}}(e,t,n):e instanceof tn?function(e,t,n){if(zt(e.precondition,t)){var r=an(e.fieldTransforms,n,t),i=t.data;i.setAll(nn(e)),i.setAll(r),t.convertToFoundDocument($t(t),i).setHasLocalMutations()}}(e,t,n):function(e,t){zt(e.precondition,t)&&t.convertToNoDocument(te.min())}(e,t)}function Jt(e,t){var n,r=null,i=w(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.field),o=Lt(a.transform,u||null);null!=o&&(null==r&&(r=qe.empty()),r.set(a.field,o))}}catch(s){i.e(s)}finally{i.f()}return r||null}function Xt(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&X(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Pt&&t instanceof Pt||e instanceof Ft&&t instanceof Ft?X(e.elements,t.elements,Ne):e instanceof Ut&&t instanceof Ut?Ne(e.k,t.k):e instanceof Mt&&t instanceof Mt}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function $t(e){return e.isFoundDocument()?e.version:te.min()}var en=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,h.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=u,a.type=0,a}return(0,f.Z)(n)}(Wt),tn=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i,a){var u,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,h.Z)(this,n),(u=t.call(this)).key=e,u.data=r,u.fieldMask=i,u.precondition=a,u.fieldTransforms=o,u.type=1,u}return(0,f.Z)(n)}(Wt);function nn(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function rn(e,t,n){var r=new Map;R(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],u=a.transform,o=t.data.field(a.field);r.set(a.field,Rt(u,o,n[i]))}return r}function an(e,t,n){var r,i=new Map,a=w(e);try{for(a.s();!(r=a.n()).done;){var u=r.value,o=u.transform,s=n.data.field(u.field);i.set(u.field,Ot(o,s,t))}}catch(c){a.e(c)}finally{a.f()}return i}var un,on,sn=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,f.Z)(n)}(Wt),cn=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,f.Z)(n)}(Wt),ln=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.count=t}));function hn(e){switch(e){default:return O();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function fn(e){if(void 0===e)return Z("GRPC error has no .code"),P.UNKNOWN;switch(e){case un.OK:return P.OK;case un.CANCELLED:return P.CANCELLED;case un.UNKNOWN:return P.UNKNOWN;case un.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case un.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case un.INTERNAL:return P.INTERNAL;case un.UNAVAILABLE:return P.UNAVAILABLE;case un.UNAUTHENTICATED:return P.UNAUTHENTICATED;case un.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case un.NOT_FOUND:return P.NOT_FOUND;case un.ALREADY_EXISTS:return P.ALREADY_EXISTS;case un.PERMISSION_DENIED:return P.PERMISSION_DENIED;case un.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case un.ABORTED:return P.ABORTED;case un.OUT_OF_RANGE:return P.OUT_OF_RANGE;case un.UNIMPLEMENTED:return P.UNIMPLEMENTED;case un.DATA_LOSS:return P.DATA_LOSS;default:return O()}}(on=un||(un={}))[on.OK=0]="OK",on[on.CANCELLED=1]="CANCELLED",on[on.UNKNOWN=2]="UNKNOWN",on[on.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",on[on.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",on[on.NOT_FOUND=5]="NOT_FOUND",on[on.ALREADY_EXISTS=6]="ALREADY_EXISTS",on[on.PERMISSION_DENIED=7]="PERMISSION_DENIED",on[on.UNAUTHENTICATED=16]="UNAUTHENTICATED",on[on.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",on[on.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",on[on.ABORTED=10]="ABORTED",on[on.OUT_OF_RANGE=11]="OUT_OF_RANGE",on[on.UNIMPLEMENTED=12]="UNIMPLEMENTED",on[on.INTERNAL=13]="INTERNAL",on[on.UNAVAILABLE=14]="UNAVAILABLE",on[on.DATA_LOSS=15]="DATA_LOSS";var dn=function(){function e(t,n){(0,h.Z)(this,e),this.comparator=t,this.root=n||yn.EMPTY}return(0,f.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,yn.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,yn.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new vn(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new vn(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new vn(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new vn(this.root,e,this.comparator,!0)}}]),e}(),vn=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,f.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),yn=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,f.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw O();if(this.right.isRed())throw O();var e=this.left.check();if(e!==this.right.check())throw O();return e+(this.isRed()?0:1)}}]),e}();yn.EMPTY=null,yn.RED=!0,yn.BLACK=!1,yn.EMPTY=new(function(){function e(){(0,h.Z)(this,e),this.size=0}return(0,f.Z)(e,[{key:"key",get:function(){throw O()}},{key:"value",get:function(){throw O()}},{key:"color",get:function(){throw O()}},{key:"left",get:function(){throw O()}},{key:"right",get:function(){throw O()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new yn(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var pn=function(){function e(t){(0,h.Z)(this,e),this.comparator=t,this.data=new dn(this.comparator)}return(0,f.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new mn(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new mn(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),mn=function(){function e(t){(0,h.Z)(this,e),this.iter=t}return(0,f.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();function gn(e){return e.hasNext()?e.getNext():void 0}var kn=new dn(Te.comparator);function wn(){return kn}var bn=new dn(Te.comparator);function xn(){return bn}var In=new dn(Te.comparator),Tn=new pn(Te.comparator);function En(){for(var e=Tn,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.add(u)}return e}var Sn=new pn(J);function Nn(){return Sn}var An=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,f.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,_n.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(te.min(),r,Nn(),wn(),En())}}]),e}(),_n=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,f.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(he.EMPTY_BYTE_STRING,n,En(),En(),En())}}]),e}(),Zn=(0,f.Z)((function e(t,n,r,i){(0,h.Z)(this,e),this.M=t,this.removedTargetIds=n,this.key=r,this.$=i})),Dn=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.targetId=t,this.F=n})),Cn=(0,f.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,h.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i})),On=function(){function e(){(0,h.Z)(this,e),this.B=0,this.L=Mn(),this.U=he.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}return(0,f.Z)(e,[{key:"current",get:function(){return this.q}},{key:"resumeToken",get:function(){return this.U}},{key:"G",get:function(){return 0!==this.B}},{key:"j",get:function(){return this.K}},{key:"W",value:function(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}},{key:"H",value:function(){var e=En(),t=En(),n=En();return this.L.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:O()}})),new _n(this.U,this.q,e,t,n)}},{key:"J",value:function(){this.K=!1,this.L=Mn()}},{key:"Y",value:function(e,t){this.K=!0,this.L=this.L.insert(e,t)}},{key:"X",value:function(e){this.K=!0,this.L=this.L.remove(e)}},{key:"Z",value:function(){this.B+=1}},{key:"tt",value:function(){this.B-=1}},{key:"et",value:function(){this.K=!0,this.q=!0}}]),e}(),Rn=function(){function e(t){(0,h.Z)(this,e),this.nt=t,this.st=new Map,this.it=wn(),this.rt=Ln(),this.ot=new pn(J)}return(0,f.Z)(e,[{key:"ct",value:function(e){var t,n=w(e.M);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.$&&e.$.isFoundDocument()?this.ut(r,e.$):this.at(r,e.key,e.$)}}catch(o){n.e(o)}finally{n.f()}var i,a=w(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var u=i.value;this.at(u,e.key,e.$)}}catch(o){a.e(o)}finally{a.f()}}},{key:"ht",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.lt(n);switch(e.state){case 0:t.ft(n)&&r.W(e.resumeToken);break;case 1:r.tt(),r.G||r.J(),r.W(e.resumeToken);break;case 2:r.tt(),r.G||t.removeTarget(n);break;case 3:t.ft(n)&&(r.et(),r.W(e.resumeToken));break;case 4:t.ft(n)&&(t.dt(n),r.W(e.resumeToken));break;default:O()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach((function(e,r){n.ft(r)&&t(r)}))}},{key:"_t",value:function(e){var t=e.targetId,n=e.F.count,r=this.wt(t);if(r){var i=r.target;if(Je(i))if(0===n){var a=new Te(i.path);this.at(t,a,Be.newNoDocument(a,te.min()))}else R(1===n);else this.gt(t)!==n&&(this.dt(t),this.ot=this.ot.add(t))}}},{key:"yt",value:function(e){var t=this,n=new Map;this.st.forEach((function(r,i){var a=t.wt(i);if(a){if(r.current&&Je(a.target)){var u=new Te(a.target.path);null!==t.it.get(u)||t.It(i,u)||t.at(i,u,Be.newNoDocument(u,e))}r.j&&(n.set(i,r.H()),r.J())}}));var r=En();this.rt.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.wt(e);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))})),this.it.forEach((function(t,n){return n.setReadTime(e)}));var i=new An(e,n,this.ot,this.it,r);return this.it=wn(),this.rt=Ln(),this.ot=new pn(J),i}},{key:"ut",value:function(e,t){if(this.ft(e)){var n=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,n),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Et(t.key).add(e))}}},{key:"at",value:function(e,t,n){if(this.ft(e)){var r=this.lt(e);this.It(e,t)?r.Y(t,1):r.X(t),this.rt=this.rt.insert(t,this.Et(t).delete(e)),n&&(this.it=this.it.insert(t,n))}}},{key:"removeTarget",value:function(e){this.st.delete(e)}},{key:"gt",value:function(e){var t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Z",value:function(e){this.lt(e).Z()}},{key:"lt",value:function(e){var t=this.st.get(e);return t||(t=new On,this.st.set(e,t)),t}},{key:"Et",value:function(e){var t=this.rt.get(e);return t||(t=new pn(J),this.rt=this.rt.insert(e,t)),t}},{key:"ft",value:function(e){var t=null!==this.wt(e);return t||_("WatchChangeAggregator","Detected inactive target",e),t}},{key:"wt",value:function(e){var t=this.st.get(e);return t&&t.G?null:this.nt.Tt(e)}},{key:"dt",value:function(e){var t=this;this.st.set(e,new On),this.nt.getRemoteKeysForTarget(e).forEach((function(n){t.at(e,n,null)}))}},{key:"It",value:function(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}]),e}();function Ln(){return new dn(Te.comparator)}function Mn(){return new dn(Te.comparator)}var Pn={asc:"ASCENDING",desc:"DESCENDING"},Vn={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Fn=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.databaseId=t,this.N=n}));function qn(e,t){return e.N?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Un(e,t){return e.N?t.toBase64():t.toUint8Array()}function Bn(e,t){return qn(e,t.toTimestamp())}function Kn(e){return R(!!e),te.fromTimestamp(function(e){var t=de(e);return new ee(t.seconds,t.nanos)}(e))}function Gn(e,t){return function(e){return new ue(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function jn(e){var t=ue.fromString(e);return R(vr(t)),t}function Qn(e,t){return Gn(e.databaseId,t.path)}function zn(e,t){var n=jn(t);if(n.get(1)!==e.databaseId.projectId)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Te(Jn(n))}function Wn(e,t){return Gn(e.databaseId,t)}function Hn(e){var t=jn(e);return 4===t.length?ue.emptyPath():Jn(t)}function Yn(e){return new ue(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Jn(e){return R(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Xn(e,t,n){return{name:Qn(e,t),fields:n.value.mapValue.fields}}function $n(e,t,n){var r=zn(e,t.name),i=Kn(t.updateTime),a=new qe({mapValue:{fields:t.fields}}),u=Be.newFoundDocument(r,i,a);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function er(e,t){return"found"in t?function(e,t){R(!!t.found),t.found.name,t.found.updateTime;var n=zn(e,t.found.name),r=Kn(t.found.updateTime),i=new qe({mapValue:{fields:t.found.fields}});return Be.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){R(!!t.missing),R(!!t.readTime);var n=zn(e,t.missing),r=Kn(t.readTime);return Be.newNoDocument(n,r)}(e,t):O()}function tr(e,t){var n;if(t instanceof en)n={update:Xn(e,t.key,t.value)};else if(t instanceof sn)n={delete:Qn(e,t.key)};else if(t instanceof tn)n={update:Xn(e,t.key,t.data),updateMask:dr(t.fieldMask)};else{if(!(t instanceof cn))return O();n={verify:Qn(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof Mt)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Pt)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ft)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ut)return{fieldPath:t.field.canonicalString(),increment:n.k};throw O()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Bn(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:O()}(e,t.precondition)),n}function nr(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Qt.updateTime(Kn(e.updateTime)):void 0!==e.exists?Qt.exists(e.exists):Qt.none()}(t.currentDocument):Qt.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)R("REQUEST_TIME"===t.setToServerValue),n=new Mt;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Pt(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new Ft(i)}else"increment"in t?n=new Ut(e,t.increment):O();var a=se.fromServerFormat(t.fieldPath);return new Gt(a,n)}(e,t)})):[];if(t.update){t.update.name;var i=zn(e,t.update.name),a=new qe({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(e){var t=e.fieldPaths||[];return new ce(t.map((function(e){return se.fromServerFormat(e)})))}(t.updateMask);return new tn(i,a,u,n,r)}return new en(i,a,n,r)}if(t.delete){var o=zn(e,t.delete);return new sn(o,n)}if(t.verify){var s=zn(e,t.verify);return new cn(s,n)}return O()}function rr(e,t){return{documents:[Wn(e,t.path)]}}function ir(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Wn(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Wn(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map((function(e){return function(e){if("=="===e.op){if(Pe(e.value))return{unaryFilter:{field:cr(e.field),op:"IS_NAN"}};if(Me(e.value))return{unaryFilter:{field:cr(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Pe(e.value))return{unaryFilter:{field:cr(e.field),op:"IS_NOT_NAN"}};if(Me(e.value))return{unaryFilter:{field:cr(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cr(e.field),op:sr(e.op),value:e.value}}}(e)}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:cr(e.field),direction:or(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var u,o=function(e,t){return e.N||be(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(u=t.startAt).inclusive,values:u.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function ar(e){var t=Hn(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){R(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var u=[];n.where&&(u=ur(n.where));var o=[];n.orderBy&&(o=n.orderBy.map((function(e){return function(e){return new st(lr(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var s=null;n.limit&&(s=function(e){var t;return be(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new ot(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new ot(n,t)}(n.endAt)),dt(t,i,o,u,s,"F",c,l)}function ur(e){return e?void 0!==e.unaryFilter?[fr(e)]:void 0!==e.fieldFilter?[hr(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return ur(e)})).reduce((function(e,t){return e.concat(t)})):O():[]}function or(e){return Pn[e]}function sr(e){return Vn[e]}function cr(e){return{fieldPath:e.canonicalString()}}function lr(e){return se.fromServerFormat(e.fieldPath)}function hr(e){return Xe.create(lr(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return O()}}(e.fieldFilter.op),e.fieldFilter.value)}function fr(e){switch(e.unaryFilter.op){case"IS_NAN":var t=lr(e.unaryFilter.field);return Xe.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=lr(e.unaryFilter.field);return Xe.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=lr(e.unaryFilter.field);return Xe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=lr(e.unaryFilter.field);return Xe.create(i,"!=",{nullValue:"NULL_VALUE"});default:return O()}}function dr(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function vr(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function yr(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=mr(t)),t=pr(e.get(n),t);return mr(t)}function pr(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="";break;case"":n+="";break;default:n+=a}}return n}function mr(e){return e+""}function gr(e){var t=e.length;if(R(t>=2),2===t)return R(""===e.charAt(0)&&""===e.charAt(1)),ue.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var u=e.indexOf("",a);switch((u<0||u>n)&&O(),e.charAt(u+1)){case"":var o=e.substring(a,u),s=void 0;0===i.length?s=o:(s=i+=o,i=""),r.push(s);break;case"":i+=e.substring(a,u),i+="\0";break;case"":i+=e.substring(a,u+1);break;default:O()}a=u+2}return new ue(r)}var kr=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.seconds=t,this.nanoseconds=n})),wr=(0,f.Z)((function e(t,n,r){(0,h.Z)(this,e),this.ownerId=t,this.allowTabSynchronization=n,this.leaseTimestampMs=r}));wr.store="owner",wr.key="owner";var br=(0,f.Z)((function e(t,n,r){(0,h.Z)(this,e),this.userId=t,this.lastAcknowledgedBatchId=n,this.lastStreamToken=r}));br.store="mutationQueues",br.keyPath="userId";var xr=(0,f.Z)((function e(t,n,r,i,a){(0,h.Z)(this,e),this.userId=t,this.batchId=n,this.localWriteTimeMs=r,this.baseMutations=i,this.mutations=a}));xr.store="mutations",xr.keyPath="batchId",xr.userMutationsIndex="userMutationsIndex",xr.userMutationsKeyPath=["userId","batchId"];var Ir=function(){function e(){(0,h.Z)(this,e)}return(0,f.Z)(e,null,[{key:"prefixForUser",value:function(e){return[e]}},{key:"prefixForPath",value:function(e,t){return[e,yr(t)]}},{key:"key",value:function(e,t,n){return[e,yr(t),n]}}]),e}();Ir.store="documentMutations",Ir.PLACEHOLDER=new Ir;var Tr=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.path=t,this.readTime=n})),Er=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.path=t,this.version=n})),Sr=(0,f.Z)((function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.unknownDocument=t,this.noDocument=n,this.document=r,this.hasCommittedMutations=i,this.readTime=a,this.parentPath=u}));Sr.store="remoteDocuments",Sr.readTimeIndex="readTimeIndex",Sr.readTimeIndexPath="readTime",Sr.collectionReadTimeIndex="collectionReadTimeIndex",Sr.collectionReadTimeIndexPath=["parentPath","readTime"];var Nr=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.byteSize=t}));Nr.store="remoteDocumentGlobal",Nr.key="remoteDocumentGlobalKey";var Ar=(0,f.Z)((function e(t,n,r,i,a,u,o){(0,h.Z)(this,e),this.targetId=t,this.canonicalId=n,this.readTime=r,this.resumeToken=i,this.lastListenSequenceNumber=a,this.lastLimboFreeSnapshotVersion=u,this.query=o}));Ar.store="targets",Ar.keyPath="targetId",Ar.queryTargetsIndexName="queryTargetsIndex",Ar.queryTargetsKeyPath=["canonicalId","targetId"];var _r=(0,f.Z)((function e(t,n,r){(0,h.Z)(this,e),this.targetId=t,this.path=n,this.sequenceNumber=r}));_r.store="targetDocuments",_r.keyPath=["targetId","path"],_r.documentTargetsIndex="documentTargetsIndex",_r.documentTargetsKeyPath=["path","targetId"];var Zr=(0,f.Z)((function e(t,n,r,i){(0,h.Z)(this,e),this.highestTargetId=t,this.highestListenSequenceNumber=n,this.lastRemoteSnapshotVersion=r,this.targetCount=i}));Zr.key="targetGlobalKey",Zr.store="targetGlobal";var Dr=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.collectionId=t,this.parent=n}));Dr.store="collectionParents",Dr.keyPath=["collectionId","parent"];var Cr=(0,f.Z)((function e(t,n,r,i){(0,h.Z)(this,e),this.clientId=t,this.updateTimeMs=n,this.networkEnabled=r,this.inForeground=i}));Cr.store="clientMetadata",Cr.keyPath="clientId";var Or=(0,f.Z)((function e(t,n,r){(0,h.Z)(this,e),this.bundleId=t,this.createTime=n,this.version=r}));Or.store="bundles",Or.keyPath="bundleId";var Rr=(0,f.Z)((function e(t,n,r){(0,h.Z)(this,e),this.name=t,this.readTime=n,this.bundledQuery=r}));Rr.store="namedQueries",Rr.keyPath="name";var Lr=(0,f.Z)((function e(t,n,r){(0,h.Z)(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r}));Lr.store="indexConfiguration",Lr.keyPath="indexId",Lr.collectionGroupIndex="collectionGroupIndex",Lr.collectionGroupIndexPath="collectionGroup";var Mr=(0,f.Z)((function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.indexId=t,this.uid=n,this.sequenceNumber=r,this.readTime=i,this.documentKey=a,this.largestBatchId=u}));Mr.store="indexState",Mr.keyPath=["indexId","uid"],Mr.sequenceNumberIndex="sequenceNumberIndex",Mr.sequenceNumberIndexPath=["uid","sequenceNumber"];var Pr=(0,f.Z)((function e(t,n,r,i,a){(0,h.Z)(this,e),this.indexId=t,this.uid=n,this.arrayValue=r,this.directionalValue=i,this.documentKey=a}));Pr.store="indexEntries",Pr.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],Pr.documentKeyIndex="documentKeyIndex",Pr.documentKeyIndexPath=["indexId","uid","documentKey"];var Vr=(0,f.Z)((function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.userId=t,this.collectionPath=n,this.documentId=r,this.collectionGroup=i,this.largestBatchId=a,this.overlayMutation=u}));Vr.store="documentOverlays",Vr.keyPath=["userId","collectionPath","documentId"],Vr.collectionPathOverlayIndex="collectionPathOverlayIndex",Vr.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],Vr.collectionGroupOverlayIndex="collectionGroupOverlayIndex",Vr.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];var Fr=[br.store,xr.store,Ir.store,Sr.store,Ar.store,wr.store,Zr.store,_r.store].concat([Cr.store]).concat([Nr.store]).concat([Dr.store]).concat([Or.store,Rr.store]),qr=[].concat((0,l.Z)(Fr),[Vr.store]),Ur=[].concat((0,l.Z)(qr),[Lr.store,Mr.store,Pr.store]),Br="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Kr=function(){function e(){(0,h.Z)(this,e),this.onCommittedListeners=[]}return(0,f.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}(),Gr=function(){function e(t){var n=this;(0,h.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,f.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&O(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=w(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}}]),e}(),jr=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.At=new F,this.transaction.oncomplete=function(){r.At.resolve()},this.transaction.onabort=function(){n.error?r.At.reject(new Wr(t,n.error)):r.At.resolve()},this.transaction.onerror=function(e){var n=$r(e.target.error);r.At.reject(new Wr(t,n))}}return(0,f.Z)(e,[{key:"Rt",get:function(){return this.At.promise}},{key:"abort",value:function(e){e&&this.At.reject(e),this.aborted||(_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"Pt",value:function(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Yr(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Wr(n,t)}}}]),e}(),Qr=function(){function e(t,n,r){(0,h.Z)(this,e),this.name=t,this.version=n,this.bt=r,12.2===e.vt((0,g.z$)())&&Z("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var t,n;return(0,f.Z)(e,[{key:"xt",value:(n=(0,u.Z)(v().mark((function e(t){var n=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return _("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Wr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new V(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new V(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Wr(t,n))},i.onupgradeneeded=function(e){_("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.bt.kt(t,i.transaction,e.oldVersion,n.version).next((function(){_("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.Ot&&(this.db.onversionchange=function(e){return n.Ot(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"Mt",value:function(e){this.Ot=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:(t=(0,u.Z)(v().mark((function e(t,n,r,i){var a,u,o,s,c=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,u=0;case 2:return++u,e.prev=3,e.delegateYield(v().mark((function e(){var n,u;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.xt(t);case 2:return c.db=e.sent,n=jr.open(c.db,t,a?"readonly":"readwrite",r),u=i(n).next((function(e){return n.Pt(),e})).catch((function(e){return n.abort(e),Gr.reject(e)})).toPromise(),u.catch((function(){})),e.next=7,n.Rt;case 7:return e.t0=u,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!=typeof(o=e.t0)){e.next=8;break}return e.abrupt("return",o.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),s="FirebaseError"!==e.t1.name&&u<3,_("SimpleDb","Transaction failed with error:",e.t1.message,"Retrying:",s),this.close(),s){e.next=15;break}return e.abrupt("return",Promise.reject(e.t1));case 15:e.next=2;break;case 17:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(e,n,r,i){return t.apply(this,arguments)})},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return _("SimpleDb","Removing database:",e),Jr(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"Vt",value:function(){if(!(0,g.hl)())return!1;if(e.St())return!0;var t=(0,g.z$)(),n=e.vt(t),r=0<n&&n<10,i=e.Dt(t),a=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||a)}},{key:"St",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={})||void 0===e?void 0:e.Ct)}},{key:"Nt",value:function(e,t){return e.store(t)}},{key:"vt",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"Dt",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),zr=function(){function e(t){(0,h.Z)(this,e),this.$t=t,this.Ft=!1,this.Bt=null}return(0,f.Z)(e,[{key:"isDone",get:function(){return this.Ft}},{key:"Lt",get:function(){return this.Bt}},{key:"cursor",set:function(e){this.$t=e}},{key:"done",value:function(){this.Ft=!0}},{key:"Ut",value:function(e){this.Bt=e}},{key:"delete",value:function(){return Jr(this.$t.delete())}}]),e}(),Wr=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,P.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return(0,f.Z)(n)}(V);function Hr(e){return"IndexedDbTransactionError"===e.name}var Yr=function(){function e(t){(0,h.Z)(this,e),this.store=t}return(0,f.Z)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(_("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Jr(n)}},{key:"add",value:function(e){return _("SimpleDb","ADD",this.store.name,e,e),Jr(this.store.add(e))}},{key:"get",value:function(e){var t=this;return Jr(this.store.get(e)).next((function(n){return void 0===n&&(n=null),_("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return _("SimpleDb","DELETE",this.store.name,e),Jr(this.store.delete(e))}},{key:"count",value:function(){return _("SimpleDb","COUNT",this.store.name),Jr(this.store.count())}},{key:"qt",value:function(e,t){var n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){var r=this.cursor(n),i=[];return this.Kt(r,(function(e,t){i.push(t)})).next((function(){return i}))}var a=this.store.getAll(n.range);return new Gr((function(e,t){a.onerror=function(e){t(e.target.error)},a.onsuccess=function(t){e(t.target.result)}}))}},{key:"Gt",value:function(e,t){_("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.jt=!1;var r=this.cursor(n);return this.Kt(r,(function(e,t,n){return n.delete()}))}},{key:"Qt",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.Kt(r,t)}},{key:"Wt",value:function(e){var t=this.cursor({});return new Gr((function(n,r){t.onerror=function(e){var t=$r(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"Kt",value:function(e,t){var n=[];return new Gr((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new zr(i),u=t(i.primaryKey,i.value,a);if(u instanceof Gr){var o=u.catch((function(e){return a.done(),Gr.reject(e)}));n.push(o)}a.isDone?r():null===a.Lt?i.continue():i.continue(a.Lt)}else r()}})).next((function(){return Gr.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.jt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function Jr(e){return new Gr((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=$r(e.target.error);n(t)}}))}var Xr=!1;function $r(e){var t=Qr.vt((0,g.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new V("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Xr||(Xr=!0,setTimeout((function(){throw r}),0)),r}}return e}var ei=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).zt=e,i.currentSequenceNumber=r,i}return(0,f.Z)(n)}(Kr);function ti(e,t){var n=M(e);return Qr.Nt(n.zt,t)}var ni=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,f.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&Ht(i,e,n[r])}}},{key:"applyToLocalView",value:function(e){var t,n=w(this.baseMutations);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.key.isEqual(e.key)&&Yt(r,e,this.localWriteTime)}}catch(o){n.e(o)}finally{n.f()}var i,a=w(this.mutations);try{for(a.s();!(i=a.n()).done;){var u=i.value;u.key.isEqual(e.key)&&Yt(u,e,this.localWriteTime)}}catch(o){a.e(o)}finally{a.f()}}},{key:"applyToLocalDocumentSet",value:function(e){var t=this;this.mutations.forEach((function(n){var r=e.get(n.key),i=r;t.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(te.min())}))}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),En())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&X(this.mutations,e.mutations,(function(e,t){return Xt(e,t)}))&&X(this.baseMutations,e.baseMutations,(function(e,t){return Xt(e,t)}))}}]),e}(),ri=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,f.Z)(e,null,[{key:"from",value:function(t,n,r){R(t.mutations.length===r.length);for(var i=In,a=t.mutations,u=0;u<a.length;u++)i=i.insert(a[u].key,r[u].version);return new e(t,n,r,i)}}]),e}(),ii=function(){function e(t,n){(0,h.Z)(this,e),this.largestBatchId=t,this.mutation=n}return(0,f.Z)(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),ai=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:te.min(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:te.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:he.EMPTY_BYTE_STRING;(0,h.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=o}return(0,f.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),ui=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.Ht=t}));function oi(e,t){var n;if(t.document)n=$n(e.Ht,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var r=Te.fromSegments(t.noDocument.path),i=fi(t.noDocument.readTime);n=Be.newNoDocument(r,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return O();var a=Te.fromSegments(t.unknownDocument.path),u=fi(t.unknownDocument.version);n=Be.newUnknownDocument(a,u)}return t.readTime&&n.setReadTime(li(t.readTime)),n}function si(e,t){var n=ci(t.readTime),r=t.key.path.popLast().toArray();if(t.isFoundDocument()){var i=function(e,t){return{name:Qn(e,t.key),fields:t.data.value.mapValue.fields,updateTime:qn(e,t.version.toTimestamp())}}(e.Ht,t),a=t.hasCommittedMutations;return new Sr(null,null,i,a,n,r)}if(t.isNoDocument()){var u=t.key.path.toArray(),o=hi(t.version),s=t.hasCommittedMutations;return new Sr(null,new Tr(u,o),null,s,n,r)}if(t.isUnknownDocument()){var c=t.key.path.toArray(),l=hi(t.version);return new Sr(new Er(c,l),null,null,!0,n,r)}return O()}function ci(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function li(e){var t=new ee(e[0],e[1]);return te.fromTimestamp(t)}function hi(e){var t=e.toTimestamp();return new kr(t.seconds,t.nanoseconds)}function fi(e){var t=new ee(e.seconds,e.nanoseconds);return te.fromTimestamp(t)}function di(e,t){for(var n=(t.baseMutations||[]).map((function(t){return nr(e.Ht,t)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var u=t.mutations.map((function(t){return nr(e.Ht,t)})),o=ee.fromMillis(t.localWriteTimeMs);return new ni(t.batchId,o,n,u)}function vi(e){var t,n,r=fi(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?fi(e.lastLimboFreeSnapshotVersion):te.min();return void 0!==e.query.documents?(R(1===(n=e.query).documents.length),t=bt(vt(Hn(n.documents[0])))):t=function(e){return bt(ar(e))}(e.query),new ai(t,e.targetId,0,e.lastListenSequenceNumber,r,i,he.fromBase64String(e.resumeToken))}function yi(e,t){var n,r=hi(t.snapshotVersion),i=hi(t.lastLimboFreeSnapshotVersion);n=Je(t.target)?rr(e.Ht,t.target):ir(e.Ht,t.target);var a=t.resumeToken.toBase64();return new Ar(t.targetId,He(t.target),r,a,t.sequenceNumber,i,n)}function pi(e){var t=ar({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?xt(t,t.limit,"L"):t}function mi(e,t){return new ii(t.largestBatchId,nr(e.Ht,t.overlayMutation))}function gi(e,t){var n=t.path.lastSegment();return[e,yr(t.path.popLast()),n]}var ki=function(){function e(){(0,h.Z)(this,e)}return(0,f.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return wi(e).get(t).next((function(e){if(e)return{id:(t=e).bundleId,createTime:fi(t.createTime),version:t.version};var t}))}},{key:"saveBundleMetadata",value:function(e,t){return wi(e).put({bundleId:(n=t).id,createTime:hi(Kn(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return bi(e).get(t).next((function(e){if(e)return{name:(t=e).name,query:pi(t.bundledQuery),readTime:fi(t.readTime)};var t}))}},{key:"saveNamedQuery",value:function(e,t){return bi(e).put(function(e){return{name:e.name,readTime:hi(Kn(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function wi(e){return ti(e,Or.store)}function bi(e){return ti(e,Rr.store)}var xi=function(){function e(t,n){(0,h.Z)(this,e),this.O=t,this.userId=n}return(0,f.Z)(e,[{key:"getOverlay",value:function(e,t){var n=this;return Ii(e).get(gi(this.userId,t)).next((function(e){return e?mi(n.O,e):null}))}},{key:"saveOverlays",value:function(e,t,n){var r=this,i=[];return n.forEach((function(n){var a=new ii(t,n);i.push(r.Yt(e,a))})),Gr.waitFor(i)}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=new Set;t.forEach((function(e){return i.add(yr(e.getCollectionPath()))}));var a=[];return i.forEach((function(t){var i=IDBKeyRange.bound([r.userId,t,n],[r.userId,t,n+1],!1,!0);a.push(Ii(e).Gt(Vr.collectionPathOverlayIndex,i))})),Gr.waitFor(a)}},{key:"getOverlaysForCollection",value:function(e,t,n){var r=this,i=new Map,a=yr(t),u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,Number.POSITIVE_INFINITY],!0);return Ii(e).qt(Vr.collectionPathOverlayIndex,u).next((function(e){var t,n=w(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,u=mi(r.O,a);i.set(u.getKey(),u)}}catch(o){n.e(o)}finally{n.f()}return i}))}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){var i,a=this,u=new Map,o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ii(e).Qt({index:Vr.collectionGroupOverlayIndex,range:o},(function(e,t,n){var o=mi(a.O,t);u.size<r||o.largestBatchId===i?(u.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((function(){return u}))}},{key:"Yt",value:function(e,t){return Ii(e).put(function(e,t,n){var r=gi(t,n.mutation.key),i=(0,a.Z)(r,3),u=(i[0],i[1]),o=i[2];return new Vr(t,u,o,n.mutation.key.getCollectionGroup(),n.largestBatchId,tr(e.Ht,n.mutation))}(this.O,this.userId,t))}}],[{key:"Jt",value:function(t,n){return new e(t,n.uid||"")}}]),e}();function Ii(e){return ti(e,Vr.store)}var Ti=function(){function e(){(0,h.Z)(this,e)}return(0,f.Z)(e,[{key:"Xt",value:function(e,t){this.Zt(e,t),t.te()}},{key:"Zt",value:function(e,t){if("nullValue"in e)this.ee(t,5);else if("booleanValue"in e)this.ee(t,10),t.ne(e.booleanValue?1:0);else if("integerValue"in e)this.ee(t,15),t.ne(ve(e.integerValue));else if("doubleValue"in e){var n=ve(e.doubleValue);isNaN(n)?this.ee(t,13):(this.ee(t,15),xe(n)?t.ne(0):t.ne(n))}else if("timestampValue"in e){var r=e.timestampValue;this.ee(t,20),"string"==typeof r?t.se(r):(t.se("".concat(r.seconds||"")),t.ne(r.nanos||0))}else if("stringValue"in e)this.ie(e.stringValue,t),this.re(t);else if("bytesValue"in e)this.ee(t,30),t.oe(ye(e.bytesValue)),this.re(t);else if("referenceValue"in e)this.ce(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.ee(t,45),t.ne(i.latitude||0),t.ne(i.longitude||0)}else"mapValue"in e?Ne(e,Ee)?this.ee(t,Number.MAX_SAFE_INTEGER):(this.ue(e.mapValue,t),this.re(t)):"arrayValue"in e?(this.ae(e.arrayValue,t),this.re(t)):O()}},{key:"ie",value:function(e,t){this.ee(t,25),this.he(e,t)}},{key:"he",value:function(e,t){t.se(e)}},{key:"ue",value:function(e,t){var n=e.fields||{};this.ee(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.ie(a,t),this.Zt(n[a],t)}}},{key:"ae",value:function(e,t){var n=e.values||[];this.ee(t,50);var r,i=w(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.Zt(a,t)}}catch(u){i.e(u)}finally{i.f()}}},{key:"ce",value:function(e,t){var n=this;this.ee(t,37),Te.fromName(e).path.forEach((function(e){n.ee(t,60),n.he(e,t)}))}},{key:"ee",value:function(e,t){e.ne(t)}},{key:"re",value:function(e){e.ne(2)}}]),e}();function Ei(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function Si(e){var t=64-function(e){for(var t=0,n=0;n<8;++n){var r=Ei(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Ti.le=new Ti;var Ni=function(){function e(){(0,h.Z)(this,e),this.buffer=new Uint8Array(1024),this.position=0}return(0,f.Z)(e,[{key:"fe",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.de(n.value),n=t.next();this._e()}},{key:"we",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.me(n.value),n=t.next();this.ge()}},{key:"ye",value:function(e){var t,n=w(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.de(i);else if(i<2048)this.de(960|i>>>6),this.de(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.de(480|i>>>12),this.de(128|63&i>>>6),this.de(128|63&i);else{var a=r.codePointAt(0);this.de(240|a>>>18),this.de(128|63&a>>>12),this.de(128|63&a>>>6),this.de(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this._e()}},{key:"pe",value:function(e){var t,n=w(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.me(i);else if(i<2048)this.me(960|i>>>6),this.me(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.me(480|i>>>12),this.me(128|63&i>>>6),this.me(128|63&i);else{var a=r.codePointAt(0);this.me(240|a>>>18),this.me(128|63&a>>>12),this.me(128|63&a>>>6),this.me(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.ge()}},{key:"Ie",value:function(e){var t=this.Ee(e),n=Si(t);this.Te(1+n),this.buffer[this.position++]=255&n;for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}},{key:"Ae",value:function(e){var t=this.Ee(e),n=Si(t);this.Te(1+n),this.buffer[this.position++]=~(255&n);for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}},{key:"Re",value:function(){this.Pe(255),this.Pe(255)}},{key:"be",value:function(){this.ve(255),this.ve(255)}},{key:"reset",value:function(){this.position=0}},{key:"seed",value:function(e){this.Te(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:"Ve",value:function(){return this.buffer.slice(0,this.position)}},{key:"Ee",value:function(e){var t=function(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var r=1;r<t.length;++r)t[r]^=n?255:0;return t}},{key:"de",value:function(e){var t=255&e;0===t?(this.Pe(0),this.Pe(255)):255===t?(this.Pe(255),this.Pe(0)):this.Pe(t)}},{key:"me",value:function(e){var t=255&e;0===t?(this.ve(0),this.ve(255)):255===t?(this.ve(255),this.ve(0)):this.ve(e)}},{key:"_e",value:function(){this.Pe(0),this.Pe(1)}},{key:"ge",value:function(){this.ve(0),this.ve(1)}},{key:"Pe",value:function(e){this.Te(1),this.buffer[this.position++]=e}},{key:"ve",value:function(e){this.Te(1),this.buffer[this.position++]=~e}},{key:"Te",value:function(e){var t=e+this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);var r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}}]),e}(),Ai=function(){function e(t){(0,h.Z)(this,e),this.Se=t}return(0,f.Z)(e,[{key:"oe",value:function(e){this.Se.fe(e)}},{key:"se",value:function(e){this.Se.ye(e)}},{key:"ne",value:function(e){this.Se.Ie(e)}},{key:"te",value:function(){this.Se.Re()}}]),e}(),_i=function(){function e(t){(0,h.Z)(this,e),this.Se=t}return(0,f.Z)(e,[{key:"oe",value:function(e){this.Se.we(e)}},{key:"se",value:function(e){this.Se.pe(e)}},{key:"ne",value:function(e){this.Se.Ae(e)}},{key:"te",value:function(){this.Se.be()}}]),e}(),Zi=function(){function e(){(0,h.Z)(this,e),this.Se=new Ni,this.De=new Ai(this.Se),this.Ce=new _i(this.Se)}return(0,f.Z)(e,[{key:"seed",value:function(e){this.Se.seed(e)}},{key:"Ne",value:function(e){return 0===e?this.De:this.Ce}},{key:"Ve",value:function(){return this.Se.Ve()}},{key:"reset",value:function(){this.Se.reset()}}]),e}(),Di=(0,f.Z)((function e(t,n,r,i){(0,h.Z)(this,e),this.indexId=t,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}));function Ci(e,t){var n=e.indexId-t.indexId;return 0!==n?n:0!==(n=Te.comparator(e.documentKey,t.documentKey))?n:0!==(n=Oi(e.arrayValue,t.arrayValue))?n:Oi(e.directionalValue,t.directionalValue)}function Oi(e,t){for(var n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}var Ri=function(){function e(){(0,h.Z)(this,e),this.xe=new Li}return(0,f.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.xe.add(t),Gr.resolve()}},{key:"getCollectionParents",value:function(e,t){return Gr.resolve(this.xe.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return Gr.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return Gr.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t,n){return Gr.resolve(En())}},{key:"getFieldIndex",value:function(e,t){return Gr.resolve(null)}},{key:"getFieldIndexes",value:function(e,t){return Gr.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return Gr.resolve(null)}},{key:"updateCollectionGroup",value:function(e,t,n){return Gr.resolve()}},{key:"updateIndexEntries",value:function(e,t){return Gr.resolve()}}]),e}(),Li=function(){function e(){(0,h.Z)(this,e),this.index={}}return(0,f.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new pn(ue.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new pn(ue.comparator)).toArray()}}]),e}(),Mi=function(){function e(t){(0,h.Z)(this,e),this.user=t,this.ke=new Li,this.uid=t.uid||""}return(0,f.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.ke.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((function(){n.ke.add(t)}));var a={collectionId:r,parent:yr(i)};return Pi(e).put(a)}return Gr.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[$(t),""],!1,!0);return Pi(e).qt(r).next((function(e){var r,i=w(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(gr(a.parent))}}catch(u){i.e(u)}finally{i.f()}return n}))}},{key:"addFieldIndex",value:function(e,t){var n=Fi(e),r=function(e){return new Lr(e.indexId,e.collectionGroup,e.fields.map((function(e){return[e.fieldPath.canonicalString(),e.kind]})))}(t);return delete r.indexId,n.add(r).next()}},{key:"deleteFieldIndex",value:function(e,t){var n=Fi(e),r=qi(e),i=Vi(e);return n.delete(t.indexId).next((function(){return r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})).next((function(){return i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}))}},{key:"getDocumentsMatchingTarget",value:function(e,t,n){return Gr.resolve(En())}},{key:"getFieldIndex",value:function(e,t){return Gr.resolve(null)}},{key:"Oe",value:function(e,t){var n,r=new Zi,i=w(function(e){return e.fields.filter((function(e){return 2!==e.kind}))}(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.fieldPath);if(null==u)return null;var o=r.Ne(a.kind);Ti.le.Xt(u,o)}}catch(s){i.e(s)}finally{i.f()}return r.Ve()}},{key:"Me",value:function(e){var t=new Zi;return Ti.le.Xt(e,t.Ne(0)),t.Ve()}},{key:"getFieldIndexes",value:function(e,t){var n=this,r=Fi(e),i=qi(e);return(t?r.qt(Lr.collectionGroupIndex,IDBKeyRange.bound(t,t)):r.qt()).next((function(e){var t=[];return Gr.forEach(e,(function(e){return i.get([e.indexId,n.uid]).next((function(n){t.push(function(e,t){var n=t?new je(t.sequenceNumber,new Qe(fi(t.readTime),new Te(gr(t.documentKey)),t.largestBatchId)):je.empty(),r=e.fields.map((function(e){var t=(0,a.Z)(e,2),n=t[0],r=t[1];return new Ge(se.fromServerFormat(n),r)}));return new Ke(e.indexId,e.collectionGroup,r,n)}(e,n))}))})).next((function(){return t}))}))}},{key:"getNextCollectionGroupToUpdate",value:function(e){return this.getFieldIndexes(e).next((function(e){return 0===e.length?null:(e.sort((function(e,t){return e.indexState.sequenceNumber-t.indexState.sequenceNumber})),e[0].collectionGroup)}))}},{key:"updateCollectionGroup",value:function(e,t,n){var r=this,i=Fi(e),a=qi(e);return this.$e(e).next((function(e){return i.qt(Lr.collectionGroupIndex,IDBKeyRange.bound(t,t)).next((function(t){return Gr.forEach(t,(function(t){return a.put(function(e,t,n,r){return new Mr(e,t.uid||"",n,hi(r.readTime),yr(r.documentKey.path),r.largestBatchId)}(t.indexId,r.user,e,n))}))}))}))}},{key:"updateIndexEntries",value:function(e,t){var n=this,r=new Map;return Gr.forEach(t,(function(t,i){var a=r.get(t.collectionGroup);return(a?Gr.resolve(a):n.getFieldIndexes(e,t.collectionGroup)).next((function(a){return r.set(t.collectionGroup,a),Gr.forEach(a,(function(r){return n.Fe(e,t,r).next((function(t){var a=n.Be(i,r);return t.isEqual(a)?Gr.resolve():n.Le(e,i,t,a)}))}))}))}))}},{key:"Ue",value:function(e,t,n){return Vi(e).put(new Pr(n.indexId,this.uid,n.arrayValue,n.directionalValue,yr(t.key.path)))}},{key:"qe",value:function(e,t,n){return Vi(e).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,yr(t.key.path)])}},{key:"Fe",value:function(e,t,n){var r=Vi(e),i=new pn(Ci);return r.Qt({index:Pr.documentKeyIndex,range:IDBKeyRange.only([n.indexId,this.uid,yr(t.path)])},(function(e,r){i=i.add(new Di(n.indexId,t,r.arrayValue,r.directionalValue))})).next((function(){return i}))}},{key:"Be",value:function(e,t){var n=new pn(Ci),r=this.Oe(t,e);if(null==r)return n;var i=function(e){return e.fields.find((function(e){return 2===e.kind}))}(t);if(null!=i){var a=e.data.field(i.fieldPath);if(Le(a)){var u,o=w(a.arrayValue.values||[]);try{for(o.s();!(u=o.n()).done;){var s=u.value;n=n.add(new Di(t.indexId,e.key,this.Me(s),r))}}catch(c){o.e(c)}finally{o.f()}}}else n=n.add(new Di(t.indexId,e.key,new Uint8Array,r));return n}},{key:"Le",value:function(e,t,n,r){var i=this;_("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);var a=[];return function(e,t,n,r,i){for(var a=e.getIterator(),u=t.getIterator(),o=gn(a),s=gn(u);o||s;){var c=!1,l=!1;if(o&&s){var h=n(o,s);h<0?l=!0:h>0&&(c=!0)}else null!=o?l=!0:c=!0;c?(r(s),s=gn(u)):l?(i(o),o=gn(a)):(o=gn(a),s=gn(u))}}(n,r,Ci,(function(n){a.push(i.Ue(e,t,n))}),(function(n){a.push(i.qe(e,t,n))})),Gr.waitFor(a)}},{key:"$e",value:function(e){var t=1;return qi(e).Qt({index:Mr.sequenceNumberIndex,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(function(e,n,r){r.done(),t=n.sequenceNumber+1})).next((function(){return t}))}}]),e}();function Pi(e){return ti(e,Dr.store)}function Vi(e){return ti(e,Pr.store)}function Fi(e){return ti(e,Lr.store)}function qi(e){return ti(e,Mr.store)}var Ui={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Bi=function(){function e(t,n,r){(0,h.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,f.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function Ki(e,t,n){var r=e.store(xr.store),i=e.store(Ir.store),a=[],u=IDBKeyRange.only(n.batchId),o=0,s=r.Qt({range:u},(function(e,t,n){return o++,n.delete()}));a.push(s.next((function(){R(1===o)})));var c,l=[],h=w(n.mutations);try{for(h.s();!(c=h.n()).done;){var f=c.value,d=Ir.key(t,f.key.path,n.batchId);a.push(i.delete(d)),l.push(f.key)}}catch(v){h.e(v)}finally{h.f()}return Gr.waitFor(a).next((function(){return l}))}function Gi(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw O();t=e.noDocument}return JSON.stringify(t).length}Bi.DEFAULT_COLLECTION_PERCENTILE=10,Bi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bi.DEFAULT=new Bi(41943040,Bi.DEFAULT_COLLECTION_PERCENTILE,Bi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bi.DISABLED=new Bi(-1,0,0);var ji=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.userId=t,this.O=n,this.indexManager=r,this.referenceDelegate=i,this.Ke={}}return(0,f.Z)(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zi(e).Qt({index:xr.userMutationsIndex,range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=Wi(e),u=zi(e);return u.add({}).next((function(o){R("number"==typeof o);var s,c=new ni(o,t,n,r),l=function(e,t,n){var r=n.baseMutations.map((function(t){return tr(e.Ht,t)})),i=n.mutations.map((function(t){return tr(e.Ht,t)}));return new xr(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.O,i.userId,c),h=[],f=new pn((function(e,t){return J(e.canonicalString(),t.canonicalString())})),d=w(r);try{for(d.s();!(s=d.n()).done;){var v=s.value,y=Ir.key(i.userId,v.key.path,o);f=f.add(v.key.path.popLast()),h.push(u.put(l)),h.push(a.put(y,Ir.PLACEHOLDER))}}catch(p){d.e(p)}finally{d.f()}return f.forEach((function(t){h.push(i.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){i.Ke[o]=c.keys()})),Gr.waitFor(h).next((function(){return c}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return zi(e).get(t).next((function(e){return e?(R(e.userId===n.userId),di(n.O,e)):null}))}},{key:"Ge",value:function(e,t){var n=this;return this.Ke[t]?Gr.resolve(this.Ke[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.Ke[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return zi(e).Qt({index:xr.userMutationsIndex,range:i},(function(e,t,i){t.userId===n.userId&&(R(t.batchId>=r),a=di(n.O,t)),i.done()})).next((function(){return a}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return zi(e).Qt({index:xr.userMutationsIndex,range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return zi(e).qt(xr.userMutationsIndex,n).next((function(e){return e.map((function(e){return di(t.O,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=Ir.prefixForPath(this.userId,t.path),i=IDBKeyRange.lowerBound(r),u=[];return Wi(e).Qt({range:i},(function(r,i,o){var s=(0,a.Z)(r,3),c=s[0],l=s[1],h=s[2],f=gr(l);if(c===n.userId&&t.path.isEqual(f))return zi(e).get(h).next((function(e){if(!e)throw O();R(e.userId===n.userId),u.push(di(n.O,e))}));o.done()})).next((function(){return u}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new pn(J),i=[];return t.forEach((function(t){var u=Ir.prefixForPath(n.userId,t.path),o=IDBKeyRange.lowerBound(u),s=Wi(e).Qt({range:o},(function(e,i,u){var o=(0,a.Z)(e,3),s=o[0],c=o[1],l=o[2],h=gr(c);s===n.userId&&t.path.isEqual(h)?r=r.add(l):u.done()}));i.push(s)})),Gr.waitFor(i).next((function(){return n.je(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,u=Ir.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(u),s=new pn(J);return Wi(e).Qt({range:o},(function(e,t,u){var o=(0,a.Z)(e,3),c=o[0],l=o[1],h=o[2],f=gr(l);c===n.userId&&r.isPrefixOf(f)?f.length===i&&(s=s.add(h)):u.done()})).next((function(){return n.je(e,s)}))}},{key:"je",value:function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){i.push(zi(e).get(t).next((function(e){if(null===e)throw O();R(e.userId===n.userId),r.push(di(n.O,e))})))})),Gr.waitFor(i).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return Ki(e.zt,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.Qe(t.batchId)})),Gr.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"Qe",value:function(e){delete this.Ke[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return Gr.resolve();var r=IDBKeyRange.lowerBound(Ir.prefixForUser(t.userId)),i=[];return Wi(e).Qt({range:r},(function(e,n,r){if(e[0]===t.userId){var a=gr(e[1]);i.push(a)}else r.done()})).next((function(){R(0===i.length)}))}))}},{key:"containsKey",value:function(e,t){return Qi(e,this.userId,t)}},{key:"We",value:function(e){var t=this;return Hi(e).get(this.userId).next((function(e){return e||new br(t.userId,-1,"")}))}}],[{key:"Jt",value:function(t,n,r,i){return R(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function Qi(e,t,n){var r=Ir.prefixForPath(t,n.path),i=r[1],u=IDBKeyRange.lowerBound(r),o=!1;return Wi(e).Qt({range:u,jt:!0},(function(e,n,r){var u=(0,a.Z)(e,3),s=u[0],c=u[1];u[2];s===t&&c===i&&(o=!0),r.done()})).next((function(){return o}))}function zi(e){return ti(e,xr.store)}function Wi(e){return ti(e,Ir.store)}function Hi(e){return ti(e,br.store)}var Yi=function(){function e(t){(0,h.Z)(this,e),this.ze=t}return(0,f.Z)(e,[{key:"next",value:function(){return this.ze+=2,this.ze}}],[{key:"He",value:function(){return new e(0)}},{key:"Je",value:function(){return new e(-1)}}]),e}(),Ji=function(){function e(t,n){(0,h.Z)(this,e),this.referenceDelegate=t,this.O=n}return(0,f.Z)(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.Ye(e).next((function(n){var r=new Yi(n.highestTargetId);return n.highestTargetId=r.next(),t.Xe(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.Ye(e).next((function(e){return te.fromTimestamp(new ee(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.Ye(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.Ye(e).next((function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.Xe(e,i)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.Ze(e,t).next((function(){return n.Ye(e).next((function(r){return r.targetCount+=1,n.tn(t,r),n.Xe(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.Ze(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return Xi(e).delete(t.targetId)})).next((function(){return n.Ye(e)})).next((function(t){return R(t.targetCount>0),t.targetCount-=1,n.Xe(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Xi(e).Qt((function(u,o){var s=vi(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))})).next((function(){return Gr.waitFor(a)})).next((function(){return i}))}},{key:"forEachTarget",value:function(e,t){return Xi(e).Qt((function(e,n){var r=vi(n);t(r)}))}},{key:"Ye",value:function(e){return $i(e).get(Zr.key).next((function(e){return R(null!==e),e}))}},{key:"Xe",value:function(e,t){return $i(e).put(Zr.key,t)}},{key:"Ze",value:function(e,t){return Xi(e).put(yi(this.O,t))}},{key:"tn",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.Ye(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=He(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Xi(e).Qt({range:r,index:Ar.queryTargetsIndexName},(function(e,n,r){var a=vi(n);Ye(t,a.target)&&(i=a,r.done())})).next((function(){return i}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=ea(e);return t.forEach((function(t){var u=yr(t.path);i.push(a.put(new _r(n,u))),i.push(r.referenceDelegate.addReference(e,n,t))})),Gr.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=ea(e);return Gr.forEach(t,(function(t){var a=yr(t.path);return Gr.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=ea(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ea(e),i=En();return r.Qt({range:n,jt:!0},(function(e,t,n){var r=gr(e[1]),a=new Te(r);i=i.add(a)})).next((function(){return i}))}},{key:"containsKey",value:function(e,t){var n=yr(t.path),r=IDBKeyRange.bound([n],[$(n)],!1,!0),i=0;return ea(e).Qt({index:_r.documentTargetsIndex,jt:!0,range:r},(function(e,t,n){var r=(0,a.Z)(e,2),u=r[0];r[1];0!==u&&(i++,n.done())})).next((function(){return i>0}))}},{key:"Tt",value:function(e,t){return Xi(e).get(t).next((function(e){return e?vi(e):null}))}}]),e}();function Xi(e){return ti(e,Ar.store)}function $i(e){return ti(e,Zr.store)}function ea(e){return ti(e,_r.store)}function ta(e){return na.apply(this,arguments)}function na(){return(na=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===P.FAILED_PRECONDITION&&t.message===Br){e.next=2;break}throw t;case 2:_("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ra(e,t){var n=(0,a.Z)(e,2),r=n[0],i=n[1],u=(0,a.Z)(t,2),o=u[0],s=u[1],c=J(r,o);return 0===c?J(i,s):c}var ia=function(){function e(t){(0,h.Z)(this,e),this.en=t,this.buffer=new pn(ra),this.nn=0}return(0,f.Z)(e,[{key:"sn",value:function(){return++this.nn}},{key:"rn",value:function(e){var t=[e,this.sn()];if(this.buffer.size<this.en)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();ra(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),aa=function(){function e(t,n){(0,h.Z)(this,e),this.garbageCollector=t,this.asyncQueue=n,this.on=!1,this.cn=null}return(0,f.Z)(e,[{key:"start",value:function(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.un(e)}},{key:"stop",value:function(){this.cn&&(this.cn.cancel(),this.cn=null)}},{key:"started",get:function(){return null!==this.cn}},{key:"un",value:function(e){var t=this,n=this.on?3e5:6e4;_("LruGarbageCollector","Garbage collection scheduled in ".concat(n,"ms")),this.cn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(0,u.Z)(v().mark((function n(){return v().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.cn=null,t.on=!0,n.prev=1,n.next=4,e.collectGarbage(t.garbageCollector);case 4:n.next=14;break;case 6:if(n.prev=6,n.t0=n.catch(1),!Hr(n.t0)){n.next=12;break}_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n.t0),n.next=14;break;case 12:return n.next=14,ta(n.t0);case 14:return n.next=16,t.un(e);case 16:case"end":return n.stop()}}),n,null,[[1,6]])}))))}}]),e}(),ua=function(){function e(t,n){(0,h.Z)(this,e),this.an=t,this.params=n}return(0,f.Z)(e,[{key:"calculateTargetCount",value:function(e,t){return this.an.hn(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return Gr.resolve(W.A);var r=new ia(t);return this.an.forEachTarget(e,(function(e){return r.rn(e.sequenceNumber)})).next((function(){return n.an.ln(e,(function(e){return r.rn(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.an.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.an.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector","Garbage collection skipped; disabled"),Gr.resolve(Ui)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),Ui):n.fn(e,t)}))}},{key:"getCacheSize",value:function(e){return this.an.getCacheSize(e)}},{key:"fn",value:function(e,t){var n,r,i,a,u,o,s,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,u=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return i=t,o=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return s=Date.now(),N()<=m.in.DEBUG&&_("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(a-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(u-a)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(o-u)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(s-o)+"ms\n"+"Total Duration: ".concat(s-l,"ms")),Gr.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})}))}}]),e}(),oa=function(){function e(t,n){(0,h.Z)(this,e),this.db=t,this.garbageCollector=function(e,t){return new ua(e,t)}(this,n)}return(0,f.Z)(e,[{key:"hn",value:function(e){var t=this.dn(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"dn",value:function(e){var t=0;return this.ln(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"ln",value:function(e,t){return this._n(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return sa(e,n)}},{key:"removeReference",value:function(e,t,n){return sa(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return sa(e,t)}},{key:"wn",value:function(e,t){return function(e,t){var n=!1;return Hi(e).Wt((function(r){return Qi(e,r,t).next((function(e){return e&&(n=!0),Gr.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this._n(e,(function(u,o){if(o<=t){var s=n.wn(e,u).next((function(t){if(!t)return a++,r.getEntry(e,u).next((function(){return r.removeEntry(u,te.min()),ea(e).delete([0,yr(u.path)])}))}));i.push(s)}})).next((function(){return Gr.waitFor(i)})).next((function(){return r.apply(e)})).next((function(){return a}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return sa(e,t)}},{key:"_n",value:function(e,t){var n,r=ea(e),i=W.A;return r.Qt({index:_r.documentTargetsIndex},(function(e,r){var u=(0,a.Z)(e,2),o=u[0],s=(u[1],r.path),c=r.sequenceNumber;0===o?(i!==W.A&&t(new Te(gr(n)),i),i=c,n=s):i=W.A})).next((function(){i!==W.A&&t(new Te(gr(n)),i)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function sa(e,t){return ea(e).put(function(e,t){return new _r(0,yr(e.path),t)}(t,e.currentSequenceNumber))}var ca=function(){function e(t,n){(0,h.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return(0,f.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=w(n);try{for(i.s();!(r=i.n()).done;){var u=(0,a.Z)(r.value,2),o=u[0],s=u[1];if(this.equalsFn(o,e))return s}}catch(c){i.e(c)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}},{key:"forEach",value:function(e){re(this.inner,(function(t,n){var r,i=w(n);try{for(i.s();!(r=i.n()).done;){var u=(0,a.Z)(r.value,2),o=u[0],s=u[1];e(o,s)}}catch(c){i.e(c)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return ie(this.inner)}}]),e}(),la=function(){function e(){(0,h.Z)(this,e),this.changes=new ca((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,f.Z)(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,Be.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Gr.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),ha=function(){function e(t){(0,h.Z)(this,e),this.O=t}return(0,f.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t,n){return va(e).put(ya(t),n)}},{key:"removeEntry",value:function(e,t){var n=va(e),r=ya(t);return n.delete(r)}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.mn(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this;return va(e).get(ya(t)).next((function(e){return n.gn(t,e)}))}},{key:"yn",value:function(e,t){var n=this;return va(e).get(ya(t)).next((function(e){return{document:n.gn(t,e),size:Gi(e)}}))}},{key:"getEntries",value:function(e,t){var n=this,r=wn();return this.pn(e,t,(function(e,t){var i=n.gn(e,t);r=r.insert(e,i)})).next((function(){return r}))}},{key:"In",value:function(e,t){var n=this,r=wn(),i=new dn(Te.comparator);return this.pn(e,t,(function(e,t){var a=n.gn(e,t);r=r.insert(e,a),i=i.insert(e,Gi(t))})).next((function(){return{documents:r,En:i}}))}},{key:"pn",value:function(e,t,n){if(t.isEmpty())return Gr.resolve();var r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator(),a=i.getNext();return va(e).Qt({range:r},(function(e,t,r){for(var u=Te.fromSegments(e);a&&Te.comparator(a,u)<0;)n(a,null),a=i.getNext();a&&a.isEqual(u)&&(n(a,t),a=i.hasNext()?i.getNext():null),a?r.Ut(a.path.toArray()):r.done()})).next((function(){for(;a;)n(a,null),a=i.hasNext()?i.getNext():null}))}},{key:"getAll",value:function(e,t,n){var r=this,i=wn(),a=t.length+1,u={};if(n.isEqual(te.min())){var o=t.toArray();u.range=IDBKeyRange.lowerBound(o)}else{var s=t.toArray(),c=ci(n);u.range=IDBKeyRange.lowerBound([s,c],!0),u.index=Sr.collectionReadTimeIndex}return va(e).Qt(u,(function(e,n,u){if(e.length===a){var o=r.gn(Te.fromSegments(e),n);t.isPrefixOf(o.key.path)?i=i.insert(o.key,o):u.done()}})).next((function(){return i}))}},{key:"newChangeBuffer",value:function(e){return new fa(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return da(e).get(Nr.key).next((function(e){return R(!!e),e}))}},{key:"mn",value:function(e,t){return da(e).put(Nr.key,t)}},{key:"gn",value:function(e,t){if(t){var n=oi(this.O,t);if(!n.isNoDocument()||!n.version.isEqual(te.min()))return n}return Be.newInvalidDocument(e)}}]),e}(),fa=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).Tn=e,i.trackRemovals=r,i.An=new ca((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),i}return(0,f.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new pn((function(e,t){return J(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(a,u){var o=t.An.get(a);if(u.isValidDocument()){var s=si(t.Tn.O,u);i=i.add(a.path.popLast());var c=Gi(s);r+=c-o,n.push(t.Tn.addEntry(e,a,s))}else if(r-=o,t.trackRemovals){var l=si(t.Tn.O,u.convertToNoDocument(te.min()));n.push(t.Tn.addEntry(e,a,l))}else n.push(t.Tn.removeEntry(e,a))})),i.forEach((function(r){n.push(t.Tn.indexManager.addToCollectionParentIndex(e,r))})),n.push(this.Tn.updateMetadata(e,r)),Gr.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.Tn.yn(e,t).next((function(e){return n.An.set(t,e.size),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.Tn.In(e,t).next((function(e){var t=e.documents;return e.En.forEach((function(e,t){n.An.set(e,t)})),t}))}}]),n}(la);function da(e){return ti(e,Nr.store)}function va(e){return ti(e,Sr.store)}function ya(e){return e.path.toArray()}var pa=function(){function e(t){(0,h.Z)(this,e),this.O=t}return(0,f.Z)(e,[{key:"kt",value:function(e,t,n,r){var i=this,a=new jr("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(wr.store)}(e),function(e){e.createObjectStore(br.store,{keyPath:br.keyPath}),e.createObjectStore(xr.store,{keyPath:xr.keyPath,autoIncrement:!0}).createIndex(xr.userMutationsIndex,xr.userMutationsKeyPath,{unique:!0}),e.createObjectStore(Ir.store)}(e),ma(e),function(e){e.createObjectStore(Sr.store)}(e));var u=Gr.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(_r.store),e.deleteObjectStore(Ar.store),e.deleteObjectStore(Zr.store)}(e),ma(e)),u=u.next((function(){return function(e){var t=e.store(Zr.store),n=new Zr(0,0,te.min().toTimestamp(),0);return t.put(Zr.key,n)}(a)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(e,t){return t.store(xr.store).qt().next((function(n){e.deleteObjectStore(xr.store),e.createObjectStore(xr.store,{keyPath:xr.keyPath,autoIncrement:!0}).createIndex(xr.userMutationsIndex,xr.userMutationsKeyPath,{unique:!0});var r=t.store(xr.store),i=n.map((function(e){return r.put(e)}));return Gr.waitFor(i)}))}(e,a)}))),u=u.next((function(){!function(e){e.createObjectStore(Cr.store,{keyPath:Cr.keyPath})}(e)}))),n<5&&r>=5&&(u=u.next((function(){return i.Rn(a)}))),n<6&&r>=6&&(u=u.next((function(){return function(e){e.createObjectStore(Nr.store)}(e),i.Pn(a)}))),n<7&&r>=7&&(u=u.next((function(){return i.bn(a)}))),n<8&&r>=8&&(u=u.next((function(){return i.vn(e,a)}))),n<9&&r>=9&&(u=u.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){var t=e.objectStore(Sr.store);t.createIndex(Sr.readTimeIndex,Sr.readTimeIndexPath,{unique:!1}),t.createIndex(Sr.collectionReadTimeIndex,Sr.collectionReadTimeIndexPath,{unique:!1})}(t)}))),n<10&&r>=10&&(u=u.next((function(){return i.Vn(a)}))),n<11&&r>=11&&(u=u.next((function(){!function(e){e.createObjectStore(Or.store,{keyPath:Or.keyPath})}(e),function(e){e.createObjectStore(Rr.store,{keyPath:Rr.keyPath})}(e)}))),n<12&&r>=12&&(u=u.next((function(){!function(e){var t=e.createObjectStore(Vr.store,{keyPath:Vr.keyPath});t.createIndex(Vr.collectionPathOverlayIndex,Vr.collectionPathOverlayIndexPath,{unique:!1}),t.createIndex(Vr.collectionGroupOverlayIndex,Vr.collectionGroupOverlayIndexPath,{unique:!1})}(e)}))),n<13&&r>=13&&(u=u.next((function(){!function(e){e.createObjectStore(Lr.store,{keyPath:Lr.keyPath,autoIncrement:!0}).createIndex(Lr.collectionGroupIndex,Lr.collectionGroupIndexPath,{unique:!1}),e.createObjectStore(Mr.store,{keyPath:Mr.keyPath}).createIndex(Mr.sequenceNumberIndex,Mr.sequenceNumberIndexPath,{unique:!1}),e.createObjectStore(Pr.store,{keyPath:Pr.keyPath}).createIndex(Pr.documentKeyIndex,Pr.documentKeyIndexPath,{unique:!1})}(e)}))),u}},{key:"Pn",value:function(e){var t=0;return e.store(Sr.store).Qt((function(e,n){t+=Gi(n)})).next((function(){var n=new Nr(t);return e.store(Nr.store).put(Nr.key,n)}))}},{key:"Rn",value:function(e){var t=this,n=e.store(br.store),r=e.store(xr.store);return n.qt().next((function(n){return Gr.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.qt(xr.userMutationsIndex,i).next((function(r){return Gr.forEach(r,(function(r){R(r.userId===n.userId);var i=di(t.O,r);return Ki(e,n.userId,i).next((function(){}))}))}))}))}))}},{key:"bn",value:function(e){var t=e.store(_r.store),n=e.store(Sr.store);return e.store(Zr.store).get(Zr.key).next((function(e){var r=[];return n.Qt((function(n,i){var a=new ue(n),u=function(e){return[0,yr(e)]}(a);r.push(t.get(u).next((function(n){return n?Gr.resolve():function(n){return t.put(new _r(0,yr(n),e.highestListenSequenceNumber))}(a)})))})).next((function(){return Gr.waitFor(r)}))}))}},{key:"vn",value:function(e,t){e.createObjectStore(Dr.store,{keyPath:Dr.keyPath});var n=t.store(Dr.store),r=new Li,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:yr(i)})}};return t.store(Sr.store).Qt({jt:!0},(function(e,t){var n=new ue(e);return i(n.popLast())})).next((function(){return t.store(Ir.store).Qt({jt:!0},(function(e,t){var n=(0,a.Z)(e,3),r=(n[0],n[1]),u=(n[2],gr(r));return i(u.popLast())}))}))}},{key:"Vn",value:function(e){var t=this,n=e.store(Ar.store);return n.Qt((function(e,r){var i=vi(r),a=yi(t.O,i);return n.put(a)}))}}]),e}();function ma(e){e.createObjectStore(_r.store,{keyPath:_r.keyPath}).createIndex(_r.documentTargetsIndex,_r.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Ar.store,{keyPath:Ar.keyPath}).createIndex(Ar.queryTargetsIndexName,Ar.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Zr.store)}var ga="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ka=function(){function e(t,n,r,i,a,u,o,s,c,l){var f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:12;if((0,h.Z)(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Sn=a,this.window=u,this.document=o,this.Dn=c,this.Cn=l,this.schemaVersion=f,this.Nn=null,this.xn=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kn=null,this.inForeground=!1,this.On=null,this.Mn=null,this.$n=Number.NEGATIVE_INFINITY,this.Fn=function(e){return Promise.resolve()},!e.Vt())throw new V(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new oa(this,i),this.Bn=n+"main",this.O=new ui(s),this.Ln=new Qr(this.Bn,this.schemaVersion,new pa(this.O)),this.Un=new Ji(this.referenceDelegate,this.O),this.qn=function(e){return new ha(e)}(this.O),this.Kn=new ki,this.window&&this.window.localStorage?this.Gn=this.window.localStorage:(this.Gn=null,!1===l&&Z("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}var t,n;return(0,f.Z)(e,[{key:"start",value:function(){var e=this;return this.jn().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new V(P.FAILED_PRECONDITION,ga);return e.Qn(),e.Wn(),e.zn(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.Un.getHighestSequenceNumber(t)}))})).then((function(t){e.Nn=new W(t,e.Dn)})).then((function(){e.xn=!0})).catch((function(t){return e.Ln&&e.Ln.close(),Promise.reject(t)}))}},{key:"Hn",value:function(e){var t=this;return this.Fn=function(){var n=(0,u.Z)(v().mark((function n(r){return v().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.Ln.Mt(function(){var t=(0,u.Z)(v().mark((function t(n){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Sn.enqueueAndForget((0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.jn();case 4:case"end":return e.stop()}}),e)})))))}},{key:"jn",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return ba(t).put(new Cr(e.clientId,Date.now(),e.networkEnabled,e.inForeground)).next((function(){if(e.isPrimary)return e.Jn(t).next((function(t){t||(e.isPrimary=!1,e.Sn.enqueueRetryable((function(){return e.Fn(!1)})))}))})).next((function(){return e.Yn(t)})).next((function(n){return e.isPrimary&&!n?e.Xn(t).next((function(){return!1})):!!n&&e.Zn(t).next((function(){return!0}))}))})).catch((function(t){if(Hr(t))return _("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.Sn.enqueueRetryable((function(){return e.Fn(t)})),e.isPrimary=t}))}},{key:"Jn",value:function(e){var t=this;return wa(e).get(wr.key).next((function(e){return Gr.resolve(t.ts(e))}))}},{key:"es",value:function(e){return ba(e).delete(this.clientId)}},{key:"ns",value:(n=(0,u.Z)(v().mark((function e(){var t,n,r,i,a=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.ss(this.$n,18e5)){e.next=6;break}return this.$n=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=ti(e,Cr.store);return t.qt().next((function(e){var n=a.rs(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return Gr.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.Gn){n=w(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.Gn.removeItem(this.os(i.clientId))}catch(u){n.e(u)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"zn",value:function(){var e=this;this.Mn=this.Sn.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.jn().then((function(){return e.ns()})).then((function(){return e.zn()}))}))}},{key:"ts",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"Yn",value:function(e){var t=this;return this.Cn?Gr.resolve(!0):wa(e).get(wr.key).next((function(n){if(null!==n&&t.ss(n.leaseTimestampMs,5e3)&&!t.cs(n.ownerId)){if(t.ts(n)&&t.networkEnabled)return!0;if(!t.ts(n)){if(!n.allowTabSynchronization)throw new V(P.FAILED_PRECONDITION,ga);return!1}}return!(!t.networkEnabled||!t.inForeground)||ba(e).qt().next((function(e){return void 0===t.rs(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&_("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:(t=(0,u.Z)(v().mark((function e(){var t=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.xn=!1,this.us(),this.Mn&&(this.Mn.cancel(),this.Mn=null),this.hs(),this.ls(),e.next=7,this.Ln.runTransaction("shutdown","readwrite",[wr.store,Cr.store],(function(e){var n=new ei(e,W.A);return t.Xn(n).next((function(){return t.es(n)}))}));case 7:this.Ln.close(),this.fs();case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"rs",value:function(e,t){var n=this;return e.filter((function(e){return n.ss(e.updateTimeMs,t)&&!n.cs(e.clientId)}))}},{key:"ds",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return ba(t).qt().next((function(t){return e.rs(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.xn}},{key:"getMutationQueue",value:function(e,t){return ji.Jt(e,this.O,t,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.Un}},{key:"getRemoteDocumentCache",value:function(){return this.qn}},{key:"getIndexManager",value:function(e){return new Mi(e)}},{key:"getDocumentOverlayCache",value:function(e){return xi.Jt(this.O,e)}},{key:"getBundleCache",value:function(){return this.Kn}},{key:"runTransaction",value:function(e,t,n){var r=this;_("IndexedDbPersistence","Starting transaction:",e);var i,a,u="readonly"===t?"readonly":"readwrite",o=13===(i=this.schemaVersion)?Ur:12===i?qr:11===i?Fr:void O();return this.Ln.runTransaction(e,u,o,(function(i){return a=new ei(i,r.Nn?r.Nn.next():W.A),"readwrite-primary"===t?r.Jn(a).next((function(e){return!!e||r.Yn(a)})).next((function(t){if(!t)throw Z("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.Sn.enqueueRetryable((function(){return r.Fn(!1)})),new V(P.FAILED_PRECONDITION,Br);return n(a)})).next((function(e){return r.Zn(a).next((function(){return e}))})):r._s(a).next((function(){return n(a)}))})).then((function(e){return a.raiseOnCommittedEvent(),e}))}},{key:"_s",value:function(e){var t=this;return wa(e).get(wr.key).next((function(e){if(null!==e&&t.ss(e.leaseTimestampMs,5e3)&&!t.cs(e.ownerId)&&!t.ts(e)&&!(t.Cn||t.allowTabSynchronization&&e.allowTabSynchronization))throw new V(P.FAILED_PRECONDITION,ga)}))}},{key:"Zn",value:function(e){var t=new wr(this.clientId,this.allowTabSynchronization,Date.now());return wa(e).put(wr.key,t)}},{key:"Xn",value:function(e){var t=this,n=wa(e);return n.get(wr.key).next((function(e){return t.ts(e)?(_("IndexedDbPersistence","Releasing primary lease."),n.delete(wr.key)):Gr.resolve()}))}},{key:"ss",value:function(e,t){var n=Date.now();return!(e<n-t||e>n&&(Z("Detected an update time that is in the future: ".concat(e," > ").concat(n)),1))}},{key:"Qn",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.On=function(){e.Sn.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.jn()}))},this.document.addEventListener("visibilitychange",this.On),this.inForeground="visible"===this.document.visibilityState)}},{key:"hs",value:function(){this.On&&(this.document.removeEventListener("visibilitychange",this.On),this.On=null)}},{key:"Wn",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.kn=function(){t.us(),(0,g.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&t.Sn.enterRestrictedMode(!0),t.Sn.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.kn))}},{key:"ls",value:function(){this.kn&&(this.window.removeEventListener("pagehide",this.kn),this.kn=null)}},{key:"cs",value:function(e){var t;try{var n=null!==(null===(t=this.Gn)||void 0===t?void 0:t.getItem(this.os(e)));return _("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Z("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"us",value:function(){if(this.Gn)try{this.Gn.setItem(this.os(this.clientId),String(Date.now()))}catch(e){Z("Failed to set zombie client id.",e)}}},{key:"fs",value:function(){if(this.Gn)try{this.Gn.removeItem(this.os(this.clientId))}catch(e){}}},{key:"os",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"Vt",value:function(){return Qr.Vt()}}]),e}();function wa(e){return ti(e,wr.store)}function ba(e){return ti(e,Cr.store)}function xa(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var Ia=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.progress=t,this.ws=n})),Ta=function(){function e(t,n,r){(0,h.Z)(this,e),this.qn=t,this.gs=n,this.indexManager=r}return(0,f.Z)(e,[{key:"ys",value:function(e,t){var n=this;return this.gs.getAllMutationBatchesAffectingDocumentKey(e,t).next((function(r){return n.ps(e,t,r)}))}},{key:"ps",value:function(e,t,n){return this.qn.getEntry(e,t).next((function(e){var t,r=w(n);try{for(r.s();!(t=r.n()).done;){t.value.applyToLocalView(e)}}catch(i){r.e(i)}finally{r.f()}return e}))}},{key:"Is",value:function(e,t){e.forEach((function(e,n){var r,i=w(t);try{for(i.s();!(r=i.n()).done;){r.value.applyToLocalView(n)}}catch(a){i.e(a)}finally{i.f()}}))}},{key:"Es",value:function(e,t){var n=this;return this.qn.getEntries(e,t).next((function(t){return n.Ts(e,t).next((function(){return t}))}))}},{key:"Ts",value:function(e,t){var n=this;return this.gs.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){return n.Is(t,e)}))}},{key:"As",value:function(e,t,n){return function(e){return Te.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Rs(e,t.path):kt(t)?this.Ps(e,t,n):this.bs(e,t,n)}},{key:"Rs",value:function(e,t){return this.ys(e,new Te(t)).next((function(e){var t=xn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"Ps",value:function(e,t,n){var r=this,i=t.collectionGroup,a=xn();return this.indexManager.getCollectionParents(e,i).next((function(u){return Gr.forEach(u,(function(u){var o=function(e,t){return new ft(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,u.child(i));return r.bs(e,o,n).next((function(e){e.forEach((function(e,t){a=a.insert(e,t)}))}))})).next((function(){return a}))}))}},{key:"bs",value:function(e,t,n){var r,i=this;return this.qn.getAll(e,t.path,n).next((function(n){return r=n,i.gs.getAllMutationBatchesAffectingQuery(e,t)})).next((function(e){var t,n=w(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value,u=w(a.mutations);try{for(u.s();!(i=u.n()).done;){var o=i.value,s=o.key,c=r.get(s);null==c&&(c=Be.newInvalidDocument(s),r=r.insert(s,c)),Yt(o,c,a.localWriteTime),c.isFoundDocument()||(r=r.remove(s))}}catch(l){u.e(l)}finally{u.f()}}}catch(l){n.e(l)}finally{n.f()}})).next((function(){return r.forEach((function(e,n){St(t,n)||(r=r.remove(e))})),r}))}}]),e}(),Ea=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.targetId=t,this.fromCache=n,this.vs=r,this.Vs=i}return(0,f.Z)(e,null,[{key:"Ss",value:function(t,n){var r,i=En(),a=En(),u=w(n.docChanges);try{for(u.s();!(r=u.n()).done;){var o=r.value;switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}}}catch(s){u.e(s)}finally{u.f()}return new e(t,n.fromCache,i,a)}}]),e}(),Sa=function(){function e(){(0,h.Z)(this,e)}return(0,f.Z)(e,[{key:"Ds",value:function(e){this.Cs=e}},{key:"As",value:function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(te.min())?this.Ns(e,t):this.Cs.Es(e,r).next((function(a){var u=i.xs(t,a);return(yt(t)||pt(t))&&i.ks(t.limitType,u,r,n)?i.Ns(e,t):(N()<=m.in.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Et(t)),i.Cs.As(e,t,n).next((function(e){return u.forEach((function(t){e=e.insert(t.key,t)})),e})))}))}},{key:"xs",value:function(e,t){var n=new pn(Nt(e));return t.forEach((function(t,r){St(e,r)&&(n=n.add(r))})),n}},{key:"ks",value:function(e,t,n,r){if(n.size!==t.size)return!0;var i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Ns",value:function(e,t){return N()<=m.in.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",Et(t)),this.Cs.As(e,t,te.min())}}]),e}(),Na=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.persistence=t,this.Os=n,this.O=i,this.Ms=new dn(J),this.$s=new ca((function(e){return He(e)}),Ye),this.Fs=te.min(),this.Bs=t.getRemoteDocumentCache(),this.Un=t.getTargetCache(),this.Kn=t.getBundleCache(),this.Ls(r)}return(0,f.Z)(e,[{key:"Ls",value:function(e){this.indexManager=this.persistence.getIndexManager(e),this.gs=this.persistence.getMutationQueue(e,this.indexManager),this.Us=new Ta(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.Ms)}))}}]),e}();function Aa(e,t,n,r){return new Na(e,t,n,r)}function _a(e,t){return Za.apply(this,arguments)}function Za(){return(Za=(0,u.Z)(v().mark((function e(t,n){var r;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.gs.getAllMutationBatches(e).next((function(i){return t=i,r.Ls(n),r.gs.getAllMutationBatches(e)})).next((function(n){var i,a=[],u=[],o=En(),s=w(t);try{for(s.s();!(i=s.n()).done;){var c=i.value;a.push(c.batchId);var l,h=w(c.mutations);try{for(h.s();!(l=h.n()).done;){var f=l.value;o=o.add(f.key)}}catch(k){h.e(k)}finally{h.f()}}}catch(k){s.e(k)}finally{s.f()}var d,v=w(n);try{for(v.s();!(d=v.n()).done;){var y=d.value;u.push(y.batchId);var p,m=w(y.mutations);try{for(m.s();!(p=m.n()).done;){var g=p.value;o=o.add(g.key)}}catch(k){m.e(k)}finally{m.f()}}}catch(k){v.e(k)}finally{v.f()}return r.Us.Es(e,o).next((function(e){return{qs:e,removedBatchIds:a,addedBatchIds:u}}))}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Da(e,t){var n=M(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.Bs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),u=Gr.resolve();return a.forEach((function(e){u=u.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);R(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),u.next((function(){return e.gs.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.gs.performConsistencyCheck(e)})).next((function(){return n.Us.Es(e,r)}))}))}function Ca(e){var t=M(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Un.getLastRemoteSnapshotVersion(e)}))}function Oa(e,t){var n=M(e),r=t.snapshotVersion,i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.Ms;var u=[];t.targetChanges.forEach((function(a,o){var s=i.get(o);if(s){u.push(n.Un.removeMatchingKeys(e,a.removedDocuments,o).next((function(){return n.Un.addMatchingKeys(e,a.addedDocuments,o)})));var c=s.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(o)?c=c.withResumeToken(he.EMPTY_BYTE_STRING,te.min()).withLastLimboFreeSnapshotVersion(te.min()):a.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(a.resumeToken,r)),i=i.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,a)&&u.push(n.Un.updateTargetData(e,c))}}));var o=wn();if(t.documentUpdates.forEach((function(r){t.resolvedLimboDocuments.has(r)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),u.push(Ra(e,a,t.documentUpdates).next((function(e){o=e}))),!r.isEqual(te.min())){var s=n.Un.getLastRemoteSnapshotVersion(e).next((function(t){return n.Un.setTargetsMetadata(e,e.currentSequenceNumber,r)}));u.push(s)}return Gr.waitFor(u).next((function(){return a.apply(e)})).next((function(){return n.Us.Ts(e,o)})).next((function(){return o}))})).then((function(e){return n.Ms=i,e}))}function Ra(e,t,n){var r=En();return n.forEach((function(e){return r=r.add(e)})),t.getEntries(e,r).next((function(e){var r=wn();return n.forEach((function(n,i){var a=e.get(n);i.isNoDocument()&&i.version.isEqual(te.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):_("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",i.version)})),r}))}function La(e,t){var n=M(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.gs.getNextMutationBatchAfterBatchId(e,t)}))}function Ma(e,t){var n=M(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.Un.getTargetData(e,t).next((function(i){return i?(r=i,Gr.resolve(r)):n.Un.allocateTargetId(e).next((function(i){return r=new ai(t,i,0,e.currentSequenceNumber),n.Un.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.$s.set(t,e.targetId)),e}))}function Pa(e,t,n){return Va.apply(this,arguments)}function Va(){return(Va=(0,u.Z)(v().mark((function e(t,n,r){var i,a,u;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=M(t),a=i.Ms.get(n),u=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",u,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Hr(e.t1)){e.next=12;break}throw e.t1;case 12:_("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.Ms=i.Ms.remove(n),i.$s.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function Fa(e,t,n){var r=M(e),i=te.min(),a=En();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=M(e),i=r.$s.get(n);return void 0!==i?Gr.resolve(r.Ms.get(i)):r.Un.getTargetData(t,n)}(r,e,bt(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Un.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.Os.As(e,t,n?i:te.min(),n?a:En())})).next((function(e){return{documents:e,Ks:a}}))}))}function qa(e,t){var n=M(e),r=M(n.Un),i=n.Ms.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.Tt(e,t).next((function(e){return e?e.target:null}))}))}function Ua(e){var t=M(e);return t.persistence.runTransaction("Get new document changes","readonly",(function(e){return function(e,t,n){var r=M(e),i=wn(),a=ci(n),u=va(t),o=IDBKeyRange.lowerBound(a,!0);return u.Qt({index:Sr.readTimeIndex,range:o},(function(e,t){var n=oi(r.O,t);i=i.insert(n.key,n),a=t.readTime})).next((function(){return{ws:i,readTime:li(a)}}))}(t.Bs,e,t.Fs)})).then((function(e){var n=e.ws,r=e.readTime;return t.Fs=r,n}))}function Ba(e){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,u.Z)(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=M(t),e.abrupt("return",n.persistence.runTransaction("Synchronize last document change read time","readonly",(function(e){return function(e){var t=va(e),n=te.min();return t.Qt({index:Sr.readTimeIndex,reverse:!0},(function(e,t,r){t.readTime&&(n=li(t.readTime)),r.done()})).next((function(){return n}))}(e)})).then((function(e){n.Fs=e})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ga(e,t,n,r){return ja.apply(this,arguments)}function ja(){return(ja=(0,u.Z)(v().mark((function e(t,n,r,i){var a,u,o,s,c,l,h,f,d,y;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=M(t),u=En(),o=wn(),s=w(r);try{for(s.s();!(c=s.n()).done;)l=c.value,h=n.Gs(l.metadata.name),l.document&&(u=u.add(h)),(f=n.js(l)).setReadTime(n.Qs(l.metadata.readTime)),o=o.insert(h,f)}catch(v){s.e(v)}finally{s.f()}return d=a.Bs.newChangeBuffer({trackRemovals:!0}),e.next=7,Ma(a,function(e){return bt(vt(ue.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return y=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return Ra(e,d,o).next((function(t){return d.apply(e),t})).next((function(t){return a.Un.removeMatchingKeysForTargetId(e,y.targetId).next((function(){return a.Un.addMatchingKeys(e,u,y.targetId)})).next((function(){return a.Us.Ts(e,t)})).next((function(){return t}))}))})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qa(e,t){return za.apply(this,arguments)}function za(){return za=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u=arguments;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:En(),e.next=3,Ma(t,bt(pi(n.bundledQuery)));case 3:return i=e.sent,a=M(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Kn(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Kn.saveNamedQuery(e,n);var u=i.withResumeToken(he.EMPTY_BYTE_STRING,t);return a.Ms=a.Ms.insert(u.targetId,u),a.Un.updateTargetData(e,u).next((function(){return a.Un.removeMatchingKeysForTargetId(e,i.targetId)})).next((function(){return a.Un.addMatchingKeys(e,r,i.targetId)})).next((function(){return a.Kn.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),za.apply(this,arguments)}var Wa=function(){function e(t){(0,h.Z)(this,e),this.O=t,this.Ws=new Map,this.zs=new Map}return(0,f.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Gr.resolve(this.Ws.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Ws.set(t.id,{id:(n=t).id,version:n.version,createTime:Kn(n.createTime)}),Gr.resolve()}},{key:"getNamedQuery",value:function(e,t){return Gr.resolve(this.zs.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.zs.set(t.name,function(e){return{name:e.name,query:pi(e.bundledQuery),readTime:Kn(e.readTime)}}(t)),Gr.resolve()}}]),e}(),Ha=function(){function e(){(0,h.Z)(this,e),this.overlays=new dn(Te.comparator),this.Hs=new Map}return(0,f.Z)(e,[{key:"getOverlay",value:function(e,t){return Gr.resolve(this.overlays.get(t))}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach((function(n){r.Yt(e,t,n)})),Gr.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.Hs.get(n);return void 0!==i&&(i.forEach((function(e){return r.overlays=r.overlays.remove(e)})),this.Hs.delete(n)),Gr.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=new Map,i=t.length+1,a=new Te(t.child("")),u=this.overlays.getIteratorFrom(a);u.hasNext();){var o=u.getNext().value,s=o.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&o.largestBatchId>n&&r.set(o.getKey(),o)}return Gr.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new dn((function(e,t){return e-t})),a=this.overlays.getIterator();a.hasNext();){var u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){var o=i.get(u.largestBatchId);null===o&&(o=new Map,i=i.insert(u.largestBatchId,o)),o.set(u.getKey(),u)}}for(var s=new Map,c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach((function(e,t){return s.set(t,e)})),!(s.size>=r)););return Gr.resolve(s)}},{key:"Yt",value:function(e,t,n){if(null!==n){var r=this.overlays.get(n.key);null!==r&&this.Hs.get(r.largestBatchId).delete(n.key),this.overlays=this.overlays.insert(n.key,new ii(t,n));var i=this.Hs.get(t);void 0===i&&(i=new Set,this.Hs.set(t,i)),i.add(n.key)}}}]),e}(),Ya=function(){function e(){(0,h.Z)(this,e),this.Js=new pn(Ja.Ys),this.Xs=new pn(Ja.Zs)}return(0,f.Z)(e,[{key:"isEmpty",value:function(){return this.Js.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Ja(e,t);this.Js=this.Js.add(n),this.Xs=this.Xs.add(n)}},{key:"ti",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.ei(new Ja(e,t))}},{key:"ni",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"si",value:function(e){var t=this,n=new Te(new ue([])),r=new Ja(n,e),i=new Ja(n,e+1),a=[];return this.Xs.forEachInRange([r,i],(function(e){t.ei(e),a.push(e.key)})),a}},{key:"ii",value:function(){var e=this;this.Js.forEach((function(t){return e.ei(t)}))}},{key:"ei",value:function(e){this.Js=this.Js.delete(e),this.Xs=this.Xs.delete(e)}},{key:"ri",value:function(e){var t=new Te(new ue([])),n=new Ja(t,e),r=new Ja(t,e+1),i=En();return this.Xs.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new Ja(e,0),n=this.Js.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Ja=function(){function e(t,n){(0,h.Z)(this,e),this.key=t,this.oi=n}return(0,f.Z)(e,null,[{key:"Ys",value:function(e,t){return Te.comparator(e.key,t.key)||J(e.oi,t.oi)}},{key:"Zs",value:function(e,t){return J(e.oi,t.oi)||Te.comparator(e.key,t.key)}}]),e}(),Xa=function(){function e(t,n){(0,h.Z)(this,e),this.indexManager=t,this.referenceDelegate=n,this.gs=[],this.ci=1,this.ui=new pn(Ja.Ys)}return(0,f.Z)(e,[{key:"checkEmpty",value:function(e){return Gr.resolve(0===this.gs.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.ci;this.ci++,this.gs.length>0&&this.gs[this.gs.length-1];var a=new ni(i,t,n,r);this.gs.push(a);var u,o=w(r);try{for(o.s();!(u=o.n()).done;){var s=u.value;this.ui=this.ui.add(new Ja(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}}catch(c){o.e(c)}finally{o.f()}return Gr.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Gr.resolve(this.ai(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.hi(n),i=r<0?0:r;return Gr.resolve(this.gs.length>i?this.gs[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Gr.resolve(0===this.gs.length?-1:this.ci-1)}},{key:"getAllMutationBatches",value:function(e){return Gr.resolve(this.gs.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Ja(t,0),i=new Ja(t,Number.POSITIVE_INFINITY),a=[];return this.ui.forEachInRange([r,i],(function(e){var t=n.ai(e.oi);a.push(t)})),Gr.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new pn(J);return t.forEach((function(e){var t=new Ja(e,0),i=new Ja(e,Number.POSITIVE_INFINITY);n.ui.forEachInRange([t,i],(function(e){r=r.add(e.oi)}))})),Gr.resolve(this.li(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;Te.isDocumentKey(i)||(i=i.child(""));var a=new Ja(new Te(i),0),u=new pn(J);return this.ui.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(u=u.add(e.oi)),!0)}),a),Gr.resolve(this.li(u))}},{key:"li",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.ai(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;R(0===this.fi(t.batchId,"removed")),this.gs.shift();var r=this.ui;return Gr.forEach(t.mutations,(function(i){var a=new Ja(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.ui=r}))}},{key:"Qe",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Ja(t,0),r=this.ui.firstAfterOrEqual(n);return Gr.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.gs.length,Gr.resolve()}},{key:"fi",value:function(e,t){return this.hi(e)}},{key:"hi",value:function(e){return 0===this.gs.length?0:e-this.gs[0].batchId}},{key:"ai",value:function(e){var t=this.hi(e);return t<0||t>=this.gs.length?null:this.gs[t]}}]),e}(),$a=function(){function e(t){(0,h.Z)(this,e),this.di=t,this.docs=new dn(Te.comparator),this.size=0}return(0,f.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.di(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Gr.resolve(n?n.document.mutableCopy():Be.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=wn();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():Be.newInvalidDocument(e))})),Gr.resolve(r)}},{key:"getAll",value:function(e,t,n){for(var r=wn(),i=new Te(t.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var u=a.getNext(),o=u.key,s=u.value.document;if(!t.isPrefixOf(o.path))break;o.path.length>t.length+1||s.readTime.compareTo(n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return Gr.resolve(r)}},{key:"_i",value:function(e,t){return Gr.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new eu(this)}},{key:"getSize",value:function(e){return Gr.resolve(this.size)}}]),e}(),eu=function(e){(0,o.Z)(n,e);var t=x(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).Tn=e,r}return(0,f.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.isValidDocument()?n.push(t.Tn.addEntry(e,i)):t.Tn.removeEntry(r)})),Gr.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.Tn.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.Tn.getEntries(e,t)}}]),n}(la),tu=function(){function e(t){(0,h.Z)(this,e),this.persistence=t,this.wi=new ca((function(e){return He(e)}),Ye),this.lastRemoteSnapshotVersion=te.min(),this.highestTargetId=0,this.mi=0,this.gi=new Ya,this.targetCount=0,this.yi=Yi.He()}return(0,f.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.wi.forEach((function(e,n){return t(n)})),Gr.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Gr.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Gr.resolve(this.mi)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.yi.next(),Gr.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.mi&&(this.mi=t),Gr.resolve()}},{key:"Ze",value:function(e){this.wi.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.yi=new Yi(t),this.highestTargetId=t),e.sequenceNumber>this.mi&&(this.mi=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.Ze(t),this.targetCount+=1,Gr.resolve()}},{key:"updateTargetData",value:function(e,t){return this.Ze(t),Gr.resolve()}},{key:"removeTargetData",value:function(e,t){return this.wi.delete(t.target),this.gi.si(t.targetId),this.targetCount-=1,Gr.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.wi.forEach((function(u,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r.wi.delete(u),a.push(r.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Gr.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return Gr.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.wi.get(t)||null;return Gr.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.gi.ti(t,n),Gr.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.gi.ni(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),Gr.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.gi.si(t),Gr.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.gi.ri(t);return Gr.resolve(n)}},{key:"containsKey",value:function(e,t){return Gr.resolve(this.gi.containsKey(t))}}]),e}(),nu=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.pi={},this.overlays={},this.Nn=new W(0),this.xn=!1,this.xn=!0,this.referenceDelegate=t(this),this.Un=new tu(this),this.indexManager=new Ri,this.qn=new $a((function(e){return r.referenceDelegate.Ii(e)})),this.O=new ui(n),this.Kn=new Wa(this.O)}return(0,f.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.xn=!1,Promise.resolve()}},{key:"started",get:function(){return this.xn}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new Ha,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.pi[e.toKey()];return n||(n=new Xa(t,this.referenceDelegate),this.pi[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Un}},{key:"getRemoteDocumentCache",value:function(){return this.qn}},{key:"getBundleCache",value:function(){return this.Kn}},{key:"runTransaction",value:function(e,t,n){var r=this;_("MemoryPersistence","Starting transaction:",e);var i=new ru(this.Nn.next());return this.referenceDelegate.Ei(),n(i).next((function(e){return r.referenceDelegate.Ti(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ai",value:function(e,t){return Gr.or(Object.values(this.pi).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),ru=function(e){(0,o.Z)(n,e);var t=x(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,f.Z)(n)}(Kr),iu=function(){function e(t){(0,h.Z)(this,e),this.persistence=t,this.Ri=new Ya,this.Pi=null}return(0,f.Z)(e,[{key:"vi",get:function(){if(this.Pi)return this.Pi;throw O()}},{key:"addReference",value:function(e,t,n){return this.Ri.addReference(n,t),this.vi.delete(n.toString()),Gr.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Ri.removeReference(n,t),this.vi.add(n.toString()),Gr.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.vi.add(t.toString()),Gr.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Ri.si(t.targetId).forEach((function(e){return n.vi.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.vi.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"Ei",value:function(){this.Pi=new Set}},{key:"Ti",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Gr.forEach(this.vi,(function(r){var i=Te.fromPath(r);return t.Vi(e,i).next((function(e){e||n.removeEntry(i,te.min())}))})).next((function(){return t.Pi=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.Vi(e,t).next((function(e){e?n.vi.delete(t.toString()):n.vi.add(t.toString())}))}},{key:"Ii",value:function(e){return 0}},{key:"Vi",value:function(e,t){var n=this;return Gr.or([function(){return Gr.resolve(n.Ri.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ai(e,t)}])}}],[{key:"bi",value:function(t){return new e(t)}}]),e}();function au(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function uu(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function ou(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var su=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return(0,f.Z)(e,[{key:"Di",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Si",value:function(t,n,r){var i,a=JSON.parse(r),u="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return u&&a.error&&((u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new V(a.error.code,a.error.message))),u?new e(t,n,a.state,i):(Z("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),cu=function(){function e(t,n,r){(0,h.Z)(this,e),this.targetId=t,this.state=n,this.error=r}return(0,f.Z)(e,[{key:"Di",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Si",value:function(t,n){var r,i=JSON.parse(n),a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new V(i.error.code,i.error.message))),a?new e(t,i.state,r):(Z("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),lu=function(){function e(t,n){(0,h.Z)(this,e),this.clientId=t,this.activeTargetIds=n}return(0,f.Z)(e,null,[{key:"Si",value:function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,a=Nn(),u=0;i&&u<r.activeTargetIds.length;++u)i=Ie(r.activeTargetIds[u]),a=a.add(r.activeTargetIds[u]);return i?new e(t,a):(Z("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),hu=function(){function e(t,n){(0,h.Z)(this,e),this.clientId=t,this.onlineState=n}return(0,f.Z)(e,null,[{key:"Si",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(Z("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),fu=function(){function e(){(0,h.Z)(this,e),this.activeTargetIds=Nn()}return(0,f.Z)(e,[{key:"Ci",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Ni",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Di",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),du=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.window=t,this.Sn=n,this.persistenceKey=r,this.xi=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ki=this.Oi.bind(this),this.Mi=new dn(J),this.started=!1,this.$i=[];var u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.Fi=au(this.persistenceKey,this.xi),this.Bi=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.Mi=this.Mi.insert(this.xi,new fu),this.Li=new RegExp("^firestore_clients_".concat(u,"_([^_]*)$")),this.Ui=new RegExp("^firestore_mutations_".concat(u,"_(\\d+)(?:_(.*))?$")),this.qi=new RegExp("^firestore_targets_".concat(u,"_(\\d+)$")),this.Ki=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Gi=function(e){return"firestore_bundle_loaded_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.ki)}var t,n;return(0,f.Z)(e,[{key:"start",value:(n=(0,u.Z)(v().mark((function e(){var t,n,r,i,a,u,o,s,c,l,h,f=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.ds();case 2:t=e.sent,n=w(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.xi){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(au(this.persistenceKey,i)))&&(u=lu.Si(i,a))&&(this.Mi=this.Mi.insert(u.clientId,u));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.ji(),(o=this.storage.getItem(this.Ki))&&(s=this.Qi(o))&&this.Wi(s),c=w(this.$i);try{for(c.s();!(l=c.n()).done;)h=l.value,this.Oi(h)}catch(d){c.e(d)}finally{c.f()}this.$i=[],this.window.addEventListener("pagehide",(function(){return f.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(){return n.apply(this,arguments)})},{key:"writeSequenceNumber",value:function(e){this.setItem(this.Bi,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.zi(this.Mi)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.Mi.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.Hi(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.Hi(e,t,n),this.Ji(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(ou(this.persistenceKey,e));if(n){var r=cu.Si(e,n);r&&(t=r.state)}}return this.Yi.Ci(e),this.ji(),t}},{key:"removeLocalQueryTarget",value:function(e){this.Yi.Ni(e),this.ji()}},{key:"isLocalQueryTarget",value:function(e){return this.Yi.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(ou(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.Xi(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.Ji(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.Zi(e)}},{key:"notifyBundleLoaded",value:function(){this.tr()}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.ki),this.removeItem(this.Fi),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return _("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"Oi",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(_("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Fi)return void Z("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Sn.enqueueRetryable((0,u.Z)(v().mark((function e(){var r,i,a,u,o,s;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=41;break}if(null===n.key){e.next=39;break}if(!t.Li.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.er(n.key),e.abrupt("return",t.nr(r,null));case 6:if(!(i=t.sr(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.nr(i.clientId,i));case 9:e.next=39;break;case 11:if(!t.Ui.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.ir(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.rr(a));case 16:e.next=39;break;case 18:if(!t.qi.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(u=t.cr(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.ur(u));case 23:e.next=39;break;case 25:if(n.key!==t.Ki){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(o=t.Qi(n.newValue))){e.next=30;break}return e.abrupt("return",t.Wi(o));case 30:e.next=39;break;case 32:if(n.key!==t.Bi){e.next=37;break}s=function(e){var t=W.A;if(null!=e)try{var n=JSON.parse(e);R("number"==typeof n),t=n}catch(e){Z("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),s!==W.A&&t.sequenceNumberHandler(s),e.next=39;break;case 37:if(n.key!==t.Gi){e.next=39;break}return e.abrupt("return",t.syncEngine.ar());case 39:e.next=42;break;case 41:t.$i.push(n);case 42:case"end":return e.stop()}}),e)}))))}}},{key:"Yi",get:function(){return this.Mi.get(this.xi)}},{key:"ji",value:function(){this.setItem(this.Fi,this.Yi.Di())}},{key:"Hi",value:function(e,t,n){var r=new su(this.currentUser,e,t,n),i=uu(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Di())}},{key:"Ji",value:function(e){var t=uu(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"Zi",value:function(e){var t={clientId:this.xi,onlineState:e};this.storage.setItem(this.Ki,JSON.stringify(t))}},{key:"Xi",value:function(e,t,n){var r=ou(this.persistenceKey,e),i=new cu(e,t,n);this.setItem(r,i.Di())}},{key:"tr",value:function(){this.setItem(this.Gi,"value-not-used")}},{key:"er",value:function(e){var t=this.Li.exec(e);return t?t[1]:null}},{key:"sr",value:function(e,t){var n=this.er(e);return lu.Si(n,t)}},{key:"ir",value:function(e,t){var n=this.Ui.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return su.Si(new T(i),r,t)}},{key:"cr",value:function(e,t){var n=this.qi.exec(e),r=Number(n[1]);return cu.Si(r,t)}},{key:"Qi",value:function(e){return hu.Si(e)}},{key:"rr",value:(t=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.hr(t.batchId,t.state,t.error));case 2:_("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"ur",value:function(e){return this.syncEngine.lr(e.targetId,e.state,e.error)}},{key:"nr",value:function(e,t){var n=this,r=t?this.Mi.insert(e,t):this.Mi.remove(e),i=this.zi(this.Mi),a=this.zi(r),u=[],o=[];return a.forEach((function(e){i.has(e)||u.push(e)})),i.forEach((function(e){a.has(e)||o.push(e)})),this.syncEngine.dr(u,o).then((function(){n.Mi=r}))}},{key:"Wi",value:function(e){this.Mi.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"zi",value:function(e){var t=Nn();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"Vt",value:function(e){return!(!e||!e.localStorage)}}]),e}(),vu=function(){function e(){(0,h.Z)(this,e),this._r=new fu,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,f.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this._r.Ci(e),this.wr[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.wr[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this._r.Ni(e)}},{key:"isLocalQueryTarget",value:function(e){return this._r.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.wr[e]}},{key:"getAllActiveQueryTargets",value:function(){return this._r.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this._r.activeTargetIds.has(e)}},{key:"start",value:function(){return this._r=new fu,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(){}}]),e}(),yu=function(){function e(){(0,h.Z)(this,e)}return(0,f.Z)(e,[{key:"mr",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),pu=function(){function e(){var t=this;(0,h.Z)(this,e),this.gr=function(){return t.yr()},this.pr=function(){return t.Ir()},this.Er=[],this.Tr()}return(0,f.Z)(e,[{key:"mr",value:function(e){this.Er.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}},{key:"Tr",value:function(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}},{key:"yr",value:function(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=w(this.Er);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"Ir",value:function(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=w(this.Er);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"Vt",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),mu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},gu=function(){function e(t){(0,h.Z)(this,e),this.Ar=t.Ar,this.Rr=t.Rr}return(0,f.Z)(e,[{key:"Pr",value:function(e){this.br=e}},{key:"vr",value:function(e){this.Vr=e}},{key:"onMessage",value:function(e){this.Sr=e}},{key:"close",value:function(){this.Rr()}},{key:"send",value:function(e){this.Ar(e)}},{key:"Dr",value:function(){this.br()}},{key:"Cr",value:function(e){this.Vr(e)}},{key:"Nr",value:function(e){this.Sr(e)}}]),e}(),ku=function(e){(0,o.Z)(n,e);var t=x(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return(0,f.Z)(n,[{key:"Br",value:function(e,t,n,r){return new Promise((function(i,a){var u=new k.JJ;u.listenOnce(k.tw.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case k.jK.NO_ERROR:var t=u.getResponseJson();_("Connection","XHR received:",JSON.stringify(t)),i(t);break;case k.jK.TIMEOUT:_("Connection",'RPC "'+e+'" timed out'),a(new V(P.DEADLINE_EXCEEDED,"Request time out"));break;case k.jK.HTTP_ERROR:var n=u.getStatus();if(_("Connection",'RPC "'+e+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var o=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(t)>=0?t:P.UNKNOWN}(r.status);a(new V(o,r.message))}else a(new V(P.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new V(P.UNAVAILABLE,"Connection failed."));break;default:O()}}finally{_("Connection",'RPC "'+e+'" completed.')}}));var o=JSON.stringify(r);u.send(t,"POST",o,n,15)}))}},{key:"Ur",value:function(e,t,n){var r=[this.kr,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=(0,k.UE)(),a=(0,k.FJ)(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new k.zI({})),this.Fr(u.initMessageHeaders,t,n),(0,g.uI)()||(0,g.b$)()||(0,g.d)()||(0,g.w1)()||(0,g.Mn)()||(0,g.ru)()||(u.httpHeadersOverwriteParam="$httpHeaders");var o=r.join("");_("Connection","Creating WebChannel: "+o,u);var s=i.createWebChannel(o,u),c=!1,l=!1,h=new gu({Ar:function(e){l?_("Connection","Not sending because WebChannel is closed:",e):(c||(_("Connection","Opening WebChannel transport."),s.open(),c=!0),_("Connection","WebChannel sending:",e),s.send(e))},Rr:function(){return s.close()}}),f=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return f(s,k.ii.EventType.OPEN,(function(){l||_("Connection","WebChannel transport opened.")})),f(s,k.ii.EventType.CLOSE,(function(){l||(l=!0,_("Connection","WebChannel transport closed"),h.Cr())})),f(s,k.ii.EventType.ERROR,(function(e){l||(l=!0,D("Connection","WebChannel transport errored:",e),h.Cr(new V(P.UNAVAILABLE,"The operation could not be completed")))})),f(s,k.ii.EventType.MESSAGE,(function(e){var t;if(!l){var n=e.data[0];R(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){_("Connection","WebChannel received error:",i);var a=i.status,u=function(e){var t=un[e];if(void 0!==t)return fn(t)}(a),o=i.message;void 0===u&&(u=P.INTERNAL,o="Unknown error status: "+a+" with message "+i.message),l=!0,h.Cr(new V(u,o)),s.close()}else _("Connection","WebChannel received:",n),h.Nr(n)}})),f(a,k.ju.STAT_EVENT,(function(e){e.stat===k.kN.PROXY?_("Connection","Detected buffering proxy"):e.stat===k.kN.NOPROXY&&_("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Dr()}),0),h}}]),n}(function(){function e(t){(0,h.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.kr=n+"://"+t.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return(0,f.Z)(e,[{key:"Mr",value:function(e,t,n,r,i){var a=this.$r(e,t);_("RestConnection","Sending: ",a,n);var u={};return this.Fr(u,r,i),this.Br(e,a,u,n).then((function(e){return _("RestConnection","Received: ",e),e}),(function(t){throw D("RestConnection","".concat(e," failed with error: "),t,"url: ",a,"request:",n),t}))}},{key:"Lr",value:function(e,t,n,r,i){return this.Mr(e,t,n,r,i)}},{key:"Fr",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+E,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"$r",value:function(e,t){var n=mu[e];return"".concat(this.kr,"/v1/").concat(t,":").concat(n)}}]),e}());function wu(){return"undefined"!=typeof window?window:null}function bu(){return"undefined"!=typeof document?document:null}function xu(e){return new Fn(e,!0)}var Iu=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,h.Z)(this,e),this.Sn=t,this.timerId=n,this.qr=r,this.Kr=i,this.Gr=a,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}return(0,f.Z)(e,[{key:"reset",value:function(){this.jr=0}},{key:"zr",value:function(){this.jr=this.Gr}},{key:"Hr",value:function(e){var t=this;this.cancel();var n=Math.floor(this.jr+this.Jr()),r=Math.max(0,Date.now()-this.Wr),i=Math.max(0,n-r);i>0&&_("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.jr," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,i,(function(){return t.Wr=Date.now(),e()})),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}},{key:"Yr",value:function(){null!==this.Qr&&(this.Qr.skipDelay(),this.Qr=null)}},{key:"cancel",value:function(){null!==this.Qr&&(this.Qr.cancel(),this.Qr=null)}},{key:"Jr",value:function(){return(Math.random()-.5)*this.jr}}]),e}(),Tu=function(){function e(t,n,r,i,a,u,o,s){(0,h.Z)(this,e),this.Sn=t,this.Xr=r,this.Zr=i,this.eo=a,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new Iu(t,n)}var t,n,r;return(0,f.Z)(e,[{key:"oo",value:function(){return 1===this.state||5===this.state||this.co()}},{key:"co",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.uo()}},{key:"stop",value:(r=(0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.oo(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"ao",value:function(){this.state=0,this.ro.reset()}},{key:"ho",value:function(){var e=this;this.co()&&null===this.so&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,(function(){return e.lo()})))}},{key:"fo",value:function(e){this._o(),this.stream.send(e)}},{key:"lo",value:(n=(0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.co()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_o",value:function(){this.so&&(this.so.cancel(),this.so=null)}},{key:"wo",value:function(){this.io&&(this.io.cancel(),this.io=null)}},{key:"close",value:(t=(0,u.Z)(v().mark((function e(t,n){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._o(),this.wo(),this.ro.cancel(),this.no++,4!==t?this.ro.reset():n&&n.code===P.RESOURCE_EXHAUSTED?(Z(n.toString()),Z("Using maximum backoff delay to prevent overloading the backend."),this.ro.zr()):n&&n.code===P.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.mo(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.vr(n);case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"mo",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.yo(this.no),n=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,a.Z)(t,2),i=r[0],u=r[1];e.no===n&&e.po(i,u)}),(function(n){t((function(){var t=new V(P.UNKNOWN,"Fetching auth token failed: "+n.message);return e.Io(t)}))}))}},{key:"po",value:function(e,t){var n=this,r=this.yo(this.no);this.stream=this.Eo(e,t),this.stream.Pr((function(){r((function(){return n.state=2,n.io=n.Sn.enqueueAfterDelay(n.Zr,1e4,(function(){return n.co()&&(n.state=3),Promise.resolve()})),n.listener.Pr()}))})),this.stream.vr((function(e){r((function(){return n.Io(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"uo",value:function(){var e=this;this.state=5,this.ro.Hr((0,u.Z)(v().mark((function t(){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"Io",value:function(e){return _("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"yo",value:function(e){var t=this;return function(n){t.Sn.enqueueAndForget((function(){return t.no===e?n():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),Eu=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i,a,u,o){var s;return(0,h.Z)(this,n),(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,o)).O=u,s}return(0,f.Z)(n,[{key:"Eo",value:function(e,t){return this.eo.Ur("Listen",e,t)}},{key:"onMessage",value:function(e){this.ro.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:O()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.N?(R(void 0===t||"string"==typeof t),he.fromBase64String(t||"")):(R(void 0===t||t instanceof Uint8Array),he.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),u=t.targetChange.cause,o=u&&function(e){var t=void 0===e.code?P.UNKNOWN:fn(e.code);return new V(t,e.message||"")}(u);n=new Cn(r,i,a,o||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=zn(e,s.document.name),l=Kn(s.document.updateTime),h=new qe({mapValue:{fields:s.document.fields}}),f=Be.newFoundDocument(c,l,h),d=s.targetIds||[],v=s.removedTargetIds||[];n=new Zn(d,v,f.key,f)}else if("documentDelete"in t){t.documentDelete;var y=t.documentDelete;y.document;var p=zn(e,y.document),m=y.readTime?Kn(y.readTime):te.min(),g=Be.newNoDocument(p,m),k=y.removedTargetIds||[];n=new Zn([],k,g.key,g)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=zn(e,w.document),x=w.removedTargetIds||[];n=new Zn([],x,b,null)}else{if(!("filter"in t))return O();t.filter;var I=t.filter;I.targetId;var T=I.count||0,E=new ln(T),S=I.targetId;n=new Dn(S,E)}return n}(this.O,e),n=function(e){if(!("targetChange"in e))return te.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?te.min():t.readTime?Kn(t.readTime):te.min()}(e);return this.listener.To(t,n)}},{key:"Ao",value:function(e){var t={};t.database=Yn(this.O),t.addTarget=function(e,t){var n,r=t.target;return(n=Je(r)?{documents:rr(e,r)}:{query:ir(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Un(e,t.resumeToken):t.snapshotVersion.compareTo(te.min())>0&&(n.readTime=qn(e,t.snapshotVersion.toTimestamp())),n}(this.O,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return O()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.O,e);n&&(t.labels=n),this.fo(t)}},{key:"Ro",value:function(e){var t={};t.database=Yn(this.O),t.removeTarget=e,this.fo(t)}}]),n}(Tu),Su=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i,a,u,o){var s;return(0,h.Z)(this,n),(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,o)).O=u,s.Po=!1,s}return(0,f.Z)(n,[{key:"bo",get:function(){return this.Po}},{key:"start",value:function(){this.Po=!1,this.lastStreamToken=void 0,(0,i.Z)((0,c.Z)(n.prototype),"start",this).call(this)}},{key:"mo",value:function(){this.Po&&this.vo([])}},{key:"Eo",value:function(e,t){return this.eo.Ur("Write",e,t)}},{key:"onMessage",value:function(e){if(R(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Po){this.ro.reset();var t=function(e,t){return e&&e.length>0?(R(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Kn(e.updateTime):Kn(t);return n.isEqual(te.min())&&(n=Kn(t)),new jt(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Kn(e.commitTime);return this.listener.Vo(n,t)}return R(!e.writeResults||0===e.writeResults.length),this.Po=!0,this.listener.So()}},{key:"Do",value:function(){var e={};e.database=Yn(this.O),this.fo(e)}},{key:"vo",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return tr(t.O,e)}))};this.fo(n)}}]),n}(Tu),Nu=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i,a){var u;return(0,h.Z)(this,n),(u=t.call(this)).authCredentials=e,u.appCheckCredentials=r,u.eo=i,u.O=a,u.Co=!1,u}return(0,f.Z)(n,[{key:"No",value:function(){if(this.Co)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Mr",value:function(e,t,n){var r=this;return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var u=(0,a.Z)(i,2),o=u[0],s=u[1];return r.eo.Mr(e,t,n,o,s)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===P.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new V(P.UNKNOWN,e.toString())}))}},{key:"Lr",value:function(e,t,n){var r=this;return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var u=(0,a.Z)(i,2),o=u[0],s=u[1];return r.eo.Lr(e,t,n,o,s)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===P.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new V(P.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.Co=!0}}]),n}(function(){return(0,f.Z)((function e(){(0,h.Z)(this,e)}))}()),Au=function(){function e(t,n){(0,h.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}return(0,f.Z)(e,[{key:"Mo",value:function(){var e=this;0===this.xo&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.ko=null,e.Fo("Backend didn't respond within 10 seconds."),e.$o("Offline"),Promise.resolve()})))}},{key:"Bo",value:function(e){"Online"===this.state?this.$o("Unknown"):(this.xo++,this.xo>=1&&(this.Lo(),this.Fo("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.$o("Offline")))}},{key:"set",value:function(e){this.Lo(),this.xo=0,"Online"===e&&(this.Oo=!1),this.$o(e)}},{key:"$o",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"Fo",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.Oo?(Z(t),this.Oo=!1):_("OnlineStateTracker",t)}},{key:"Lo",value:function(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}}]),e}(),_u=(0,f.Z)((function e(t,n,r,i,a){var o=this;(0,h.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=a,this.jo.mr((function(e){r.enqueueAndForget((0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=qu(o),!e.t0){e.next=5;break}return _("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,u.Z)(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=M(t)).Ko.add(4),e.next=4,Cu(n);case 4:return n.Qo.set("Unknown"),n.Ko.delete(4),e.next=8,Zu(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.Qo=new Au(r,i)}));function Zu(e){return Du.apply(this,arguments)}function Du(){return(Du=(0,u.Z)(v().mark((function e(t){var n,r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!qu(t)){e.next=18;break}n=w(t.Go),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})))).apply(this,arguments)}function Cu(e){return Ou.apply(this,arguments)}function Ou(){return(Ou=(0,u.Z)(v().mark((function e(t){var n,r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=w(t.Go),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))).apply(this,arguments)}function Ru(e,t){var n=M(e);n.qo.has(t.targetId)||(n.qo.set(t.targetId,t),Fu(n)?Vu(n):po(n).co()&&Mu(n,t))}function Lu(e,t){var n=M(e),r=po(n);n.qo.delete(t),r.co()&&Pu(n,t),0===n.qo.size&&(r.co()?r.ho():qu(n)&&n.Qo.set("Unknown"))}function Mu(e,t){e.Wo.Z(t.targetId),po(e).Ao(t)}function Pu(e,t){e.Wo.Z(t),po(e).Ro(t)}function Vu(e){e.Wo=new Rn({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},Tt:function(t){return e.qo.get(t)||null}}),po(e).start(),e.Qo.Mo()}function Fu(e){return qu(e)&&!po(e).oo()&&e.qo.size>0}function qu(e){return 0===M(e).Ko.size}function Uu(e){e.Wo=void 0}function Bu(e){return Ku.apply(this,arguments)}function Ku(){return(Ku=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.qo.forEach((function(e,n){Mu(t,e)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gu(e,t){return ju.apply(this,arguments)}function ju(){return(ju=(0,u.Z)(v().mark((function e(t,n){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Uu(t),Fu(t)?(t.Qo.Bo(n),Vu(t)):t.Qo.set("Unknown");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qu(e,t,n){return zu.apply(this,arguments)}function zu(){return zu=(0,u.Z)(v().mark((function e(t,n,r){var i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.Qo.set("Online"),!(n instanceof Cn&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=w(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(u=a.value,e.t0=t.qo.has(u),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(u,r);case 10:t.qo.delete(u),t.Wo.removeTarget(u);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),_("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,Wu(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof Zn?t.Wo.ct(n):n instanceof Dn?t.Wo._t(n):t.Wo.ht(n),r.isEqual(te.min())){e.next=29;break}return e.prev=14,e.next=17,Ca(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.Wo.yt(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.qo.get(r);i&&e.qo.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.qo.get(t);if(n){e.qo.set(t,n.withResumeToken(he.EMPTY_BYTE_STRING,n.snapshotVersion)),Pu(e,t);var r=new ai(n.target,t,1,n.sequenceNumber);Mu(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),_("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Wu(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),zu.apply(this,arguments)}function Wu(e,t,n){return Hu.apply(this,arguments)}function Hu(){return(Hu=(0,u.Z)(v().mark((function e(t,n,r){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Hr(n)){e.next=2;break}throw n;case 2:return t.Ko.add(1),e.next=5,Cu(t);case 5:t.Qo.set("Offline"),r||(r=function(){return Ca(t.localStore)}),t.asyncQueue.enqueueRetryable((0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.Ko.delete(1),e.next=6,Zu(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yu(e,t){return t().catch((function(n){return Wu(e,n,t)}))}function Ju(e){return Xu.apply(this,arguments)}function Xu(){return(Xu=(0,u.Z)(v().mark((function e(t){var n,r,i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=M(t),r=mo(n),i=n.Uo.length>0?n.Uo[n.Uo.length-1].batchId:-1;case 2:if(!$u(n)){e.next=19;break}return e.prev=3,e.next=6,La(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.Uo.length&&r.ho(),e.abrupt("break",19);case 10:i=a.batchId,eo(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Wu(n,e.t0);case 17:e.next=2;break;case 19:to(n)&&no(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])})))).apply(this,arguments)}function $u(e){return qu(e)&&e.Uo.length<10}function eo(e,t){e.Uo.push(t);var n=mo(e);n.co()&&n.bo&&n.vo(t.mutations)}function to(e){return qu(e)&&!mo(e).oo()&&e.Uo.length>0}function no(e){mo(e).start()}function ro(e){return io.apply(this,arguments)}function io(){return(io=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:mo(t).Do();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ao(e){return uo.apply(this,arguments)}function uo(){return(uo=(0,u.Z)(v().mark((function e(t){var n,r,i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=mo(t),r=w(t.Uo);try{for(r.s();!(i=r.n()).done;)a=i.value,n.vo(a.mutations)}catch(u){r.e(u)}finally{r.f()}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oo(e,t,n){return so.apply(this,arguments)}function so(){return(so=(0,u.Z)(v().mark((function e(t,n,r){var i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.Uo.shift(),a=ri.from(i,n,r),e.next=3,Yu(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,Ju(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function co(e,t){return lo.apply(this,arguments)}function lo(){return lo=(0,u.Z)(v().mark((function e(t,n){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&mo(t).bo,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,u.Z)(v().mark((function e(t,n){var r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!hn(i=n.code)||i===P.ABORTED){e.next=7;break}return r=t.Uo.shift(),mo(t).ao(),e.next=5,Yu(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,Ju(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:to(t)&&no(t);case 5:case"end":return e.stop()}}),e)}))),lo.apply(this,arguments)}function ho(e,t){return fo.apply(this,arguments)}function fo(){return(fo=(0,u.Z)(v().mark((function e(t,n){var r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=M(t)).asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials"),i=qu(r),r.Ko.add(3),e.next=6,Cu(r);case 6:return i&&r.Qo.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.Ko.delete(3),e.next=12,Zu(r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vo(e,t){return yo.apply(this,arguments)}function yo(){return(yo=(0,u.Z)(v().mark((function e(t,n){var r;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=M(t),!n){e.next=7;break}return r.Ko.delete(2),e.next=5,Zu(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.Ko.add(2),e.next=12,Cu(r);case 12:r.Qo.set("Unknown");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function po(e){return e.zo||(e.zo=function(e,t,n){var r=M(e);return r.No(),new Eu(t,r.eo,r.authCredentials,r.appCheckCredentials,r.O,n)}(e.datastore,e.asyncQueue,{Pr:Bu.bind(null,e),vr:Gu.bind(null,e),To:Qu.bind(null,e)}),e.Go.push(function(){var t=(0,u.Z)(v().mark((function t(n){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.zo.ao(),Fu(e)?Vu(e):e.Qo.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.zo.stop();case 6:Uu(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.zo}function mo(e){return e.Ho||(e.Ho=function(e,t,n){var r=M(e);return r.No(),new Su(t,r.eo,r.authCredentials,r.appCheckCredentials,r.O,n)}(e.datastore,e.asyncQueue,{Pr:ro.bind(null,e),vr:co.bind(null,e),So:ao.bind(null,e),Vo:oo.bind(null,e)}),e.Go.push(function(){var t=(0,u.Z)(v().mark((function t(n){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Ho.ao(),t.next=4,Ju(e);case 4:t.next=9;break;case 6:return t.next=8,e.Ho.stop();case 8:e.Uo.length>0&&(_("RemoteStore","Stopping write stream with ".concat(e.Uo.length," pending writes")),e.Uo=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Ho}var go=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new F,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,f.Z)(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new V(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var u=new e(t,n,Date.now()+r,i,a);return u.start(r),u}}]),e}();function ko(e,t){if(Z("AsyncQueue","".concat(t,": ").concat(e)),Hr(e))return new V(P.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var wo=function(){function e(t){(0,h.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||Te.comparator(e.key,n.key)}:function(e,t){return Te.comparator(e.key,t.key)},this.keyedMap=xn(),this.sortedSet=new dn(this.comparator)}return(0,f.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),bo=function(){function e(){(0,h.Z)(this,e),this.Jo=new dn(Te.comparator)}return(0,f.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.Jo.get(t);n?0!==e.type&&3===n.type?this.Jo=this.Jo.insert(t,e):3===e.type&&1!==n.type?this.Jo=this.Jo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jo=this.Jo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jo=this.Jo.remove(t):1===e.type&&2===n.type?this.Jo=this.Jo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):O():this.Jo=this.Jo.insert(t,e)}},{key:"Yo",value:function(){var e=[];return this.Jo.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),xo=function(){function e(t,n,r,i,a,u,o,s){(0,h.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=o,this.excludesMetadataChanges=s}return(0,f.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&It(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach((function(e){a.push({type:0,doc:e})})),new e(t,n,wo.emptySet(n),a,r,i,!0,!1)}}]),e}(),Io=(0,f.Z)((function e(){(0,h.Z)(this,e),this.Xo=void 0,this.listeners=[]})),To=(0,f.Z)((function e(){(0,h.Z)(this,e),this.queries=new ca((function(e){return Tt(e)}),It),this.onlineState="Unknown",this.Zo=new Set}));function Eo(e,t){return So.apply(this,arguments)}function So(){return(So=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u,o;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=M(t),i=n.query,a=!1,(u=r.queries.get(i))||(a=!0,u=new Io),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:u.Xo=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),o=ko(e.t0,"Initialization of query '".concat(Et(n.query),"' failed")),e.abrupt("return",void n.onError(o));case 13:r.queries.set(i,u),u.listeners.push(n),n.tc(r.onlineState),u.Xo&&n.ec(u.Xo)&&Do(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function No(e,t){return Ao.apply(this,arguments)}function Ao(){return(Ao=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u,o;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=M(t),i=n.query,a=!1,(u=r.queries.get(i))&&(o=u.listeners.indexOf(n))>=0&&(u.listeners.splice(o,1),a=0===u.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _o(e,t){var n,r=M(e),i=!1,a=w(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,o=u.query,s=r.queries.get(o);if(s){var c,l=w(s.listeners);try{for(l.s();!(c=l.n()).done;){c.value.ec(u)&&(i=!0)}}catch(h){l.e(h)}finally{l.f()}s.Xo=u}}}catch(h){a.e(h)}finally{a.f()}i&&Do(r)}function Zo(e,t,n){var r=M(e),i=r.queries.get(t);if(i){var a,u=w(i.listeners);try{for(u.s();!(a=u.n()).done;){a.value.onError(n)}}catch(o){u.e(o)}finally{u.f()}}r.queries.delete(t)}function Do(e){e.Zo.forEach((function(e){e.next()}))}var Co=function(){function e(t,n,r){(0,h.Z)(this,e),this.query=t,this.nc=n,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=r||{}}return(0,f.Z)(e,[{key:"ec",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=w(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}e=new xo(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.sc?this.rc(e)&&(this.nc.next(e),a=!0):this.oc(e,this.onlineState)&&(this.cc(e),a=!0),this.ic=e,a}},{key:"onError",value:function(e){this.nc.error(e)}},{key:"tc",value:function(e){this.onlineState=e;var t=!1;return this.ic&&!this.sc&&this.oc(this.ic,e)&&(this.cc(this.ic),t=!0),t}},{key:"oc",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return!(this.options.uc&&n||e.docs.isEmpty()&&"Offline"!==t)}},{key:"rc",value:function(e){if(e.docChanges.length>0)return!0;var t=this.ic&&this.ic.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"cc",value:function(e){e=xo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.sc=!0,this.nc.next(e)}}]),e}(),Oo=function(){function e(t,n){(0,h.Z)(this,e),this.payload=t,this.byteLength=n}return(0,f.Z)(e,[{key:"ac",value:function(){return"metadata"in this.payload}}]),e}(),Ro=function(){function e(t){(0,h.Z)(this,e),this.O=t}return(0,f.Z)(e,[{key:"Gs",value:function(e){return zn(this.O,e)}},{key:"js",value:function(e){return e.metadata.exists?$n(this.O,e.document,!1):Be.newNoDocument(this.Gs(e.metadata.name),this.Qs(e.metadata.readTime))}},{key:"Qs",value:function(e){return Kn(e)}}]),e}(),Lo=function(){function e(t,n,r){(0,h.Z)(this,e),this.hc=t,this.localStore=n,this.O=r,this.queries=[],this.documents=[],this.progress=Mo(t)}var t;return(0,f.Z)(e,[{key:"lc",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"fc",value:function(e){var t,n=new Map,r=new Ro(this.O),i=w(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var u,o=r.Gs(a.metadata.name),s=w(a.metadata.queries);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=(n.get(c)||En()).add(o);n.set(c,l)}}catch(h){s.e(h)}finally{s.f()}}}}catch(h){i.e(h)}finally{i.f()}return n}},{key:"complete",value:(t=(0,u.Z)(v().mark((function e(){var t,n,r,i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ga(this.localStore,new Ro(this.O),this.documents,this.hc.id);case 2:t=e.sent,n=this.fc(this.documents),r=w(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,Qa(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",new Ia(Object.assign({},this.progress),t)));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])}))),function(){return t.apply(this,arguments)})}]),e}();function Mo(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var Po=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.key=t})),Vo=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.key=t})),Fo=function(){function e(t,n){(0,h.Z)(this,e),this.query=t,this.dc=n,this._c=null,this.current=!1,this.wc=En(),this.mutatedKeys=En(),this.mc=Nt(t),this.gc=new wo(this.mc)}return(0,f.Z)(e,[{key:"yc",get:function(){return this.dc}},{key:"Ic",value:function(e,t){var n=this,r=t?t.Ec:new bo,i=t?t.gc:this.gc,a=t?t.mutatedKeys:this.mutatedKeys,u=i,o=!1,s=yt(this.query)&&i.size===this.query.limit?i.last():null,c=pt(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),h=St(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),v=!1;l&&h?l.data.isEqual(h.data)?f!==d&&(r.track({type:3,doc:h}),v=!0):n.Tc(l,h)||(r.track({type:2,doc:h}),v=!0,(s&&n.mc(h,s)>0||c&&n.mc(h,c)<0)&&(o=!0)):!l&&h?(r.track({type:0,doc:h}),v=!0):l&&!h&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(o=!0)),v&&(h?(u=u.add(h),a=d?a.add(e):a.delete(e)):(u=u.delete(e),a=a.delete(e)))})),yt(this.query)||pt(this.query))for(;u.size>this.query.limit;){var l=yt(this.query)?u.last():u.first();u=u.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{gc:u,Ec:r,ks:o,mutatedKeys:a}}},{key:"Tc",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.gc;this.gc=e.gc,this.mutatedKeys=e.mutatedKeys;var a=e.Ec.Yo();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O()}};return n(e)-n(t)}(e.type,t.type)||r.mc(e.doc,t.doc)})),this.Ac(n);var u=t?this.Rc():[],o=0===this.wc.size&&this.current?1:0,s=o!==this._c;return this._c=o,0!==a.length||s?{snapshot:new xo(this.query,e.gc,i,a,e.mutatedKeys,0===o,s,!1),Pc:u}:{Pc:u}}},{key:"tc",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new bo,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}},{key:"bc",value:function(e){return!this.dc.has(e)&&!!this.gc.has(e)&&!this.gc.get(e).hasLocalMutations}},{key:"Ac",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.dc=t.dc.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.dc=t.dc.delete(e)})),this.current=e.current)}},{key:"Rc",value:function(){var e=this;if(!this.current)return[];var t=this.wc;this.wc=En(),this.gc.forEach((function(t){e.bc(t.key)&&(e.wc=e.wc.add(t.key))}));var n=[];return t.forEach((function(t){e.wc.has(t)||n.push(new Vo(t))})),this.wc.forEach((function(e){t.has(e)||n.push(new Po(e))})),n}},{key:"vc",value:function(e){this.dc=e.Ks,this.wc=En();var t=this.Ic(e.documents);return this.applyChanges(t,!0)}},{key:"Vc",value:function(){return xo.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,0===this._c)}}]),e}(),qo=(0,f.Z)((function e(t,n,r){(0,h.Z)(this,e),this.query=t,this.targetId=n,this.view=r})),Uo=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.key=t,this.Sc=!1})),Bo=function(){function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.Dc={},this.Cc=new ca((function(e){return Tt(e)}),It),this.Nc=new Map,this.xc=new Set,this.kc=new dn(Te.comparator),this.Oc=new Map,this.Mc=new Ya,this.$c={},this.Fc=new Map,this.Bc=Yi.Je(),this.onlineState="Unknown",this.Lc=void 0}return(0,f.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.Lc}}]),e}();function Ko(e,t){return Go.apply(this,arguments)}function Go(){return(Go=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u,o,s;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Ms(t),!(u=r.Cc.get(n))){e.next=6;break}i=u.targetId,r.sharedClientState.addLocalQueryTarget(i),a=u.view.Vc(),e.next=15;break;case 6:return e.next=8,Ma(r.localStore,bt(n));case 8:return o=e.sent,r.isPrimaryClient&&Ru(r.remoteStore,o),s=r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.targetId,e.next=14,jo(r,n,i,"current"===s);case 14:a=e.sent;case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jo(e,t,n,r){return Qo.apply(this,arguments)}function Qo(){return Qo=(0,u.Z)(v().mark((function e(t,n,r,i){var a,o,s,c,l,h;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Uc=function(e,n,r){return(i=(0,u.Z)(v().mark((function e(t,n,r,i){var a,u,o;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.Ic(r),e.t0=a.ks,!e.t0){e.next=6;break}return e.next=5,Fa(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.Ic(t,a)}));case 5:a=e.sent;case 6:return u=i&&i.targetChanges.get(n.targetId),o=n.view.applyChanges(a,t.isPrimaryClient,u),e.abrupt("return",(fs(t,n.targetId,o.Pc),o.snapshot));case 8:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return i.apply(this,arguments)})(t,e,n,r);var i},e.next=3,Fa(t.localStore,n,!0);case 3:return a=e.sent,o=new Fo(n,a.Ks),s=o.Ic(a.documents),c=_n.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),l=o.applyChanges(s,t.isPrimaryClient,c),fs(t,r,l.Pc),h=new qo(n,r,o),e.abrupt("return",(t.Cc.set(n,h),t.Nc.has(r)?t.Nc.get(r).push(n):t.Nc.set(r,[n]),l.snapshot));case 11:case"end":return e.stop()}}),e)}))),Qo.apply(this,arguments)}function zo(e,t){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,u.Z)(v().mark((function e(t,n){var r,i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=M(t),i=r.Cc.get(n),!((a=r.Nc.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.Nc.set(i.targetId,a.filter((function(e){return!It(e,n)}))),void r.Cc.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,Pa(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),Lu(r.remoteStore,i.targetId),ls(r,i.targetId)})).catch(ta);case 9:e.next=14;break;case 11:return ls(r,i.targetId),e.next=14,Pa(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ho(e,t,n){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,u.Z)(v().mark((function e(t,n,r){var i,a,u;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Ps(t),e.prev=1,e.next=4,function(e,t){var n,r=M(e),i=ee.now(),a=t.reduce((function(e,t){return e.add(t.key)}),En());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(e){return r.Us.Es(e,a).next((function(a){n=a;var u,o=[],s=w(t);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=Jt(c,n.get(c.key));null!=l&&o.push(new tn(c.key,l,Ue(l.value.mapValue),Qt.exists(!0)))}}catch(h){s.e(h)}finally{s.f()}return r.gs.addMutationBatch(e,i,o,t)}))})).then((function(e){return e.applyToLocalDocumentSet(n),{batchId:e.batchId,changes:n}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.$c[e.currentUser.toKey()];r||(r=new dn(J)),r=r.insert(t,n),e.$c[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,ys(i,a.changes);case 9:return e.next=11,Ju(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),u=ko(e.t0,"Failed to persist write"),r.reject(u);case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function Jo(e,t){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,u.Z)(v().mark((function e(t,n){var r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M(t),e.prev=1,e.next=4,Oa(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.Oc.get(t);n&&(R(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.Sc=!0:e.modifiedDocuments.size>0?R(n.Sc):e.removedDocuments.size>0&&(R(n.Sc),n.Sc=!1))})),e.next=8,ys(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,ta(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function $o(e,t,n){var r=M(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Cc.forEach((function(e,n){var r=n.view.tc(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=M(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=w(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.tc(t)&&(r=!0)}}catch(u){a.e(u)}finally{a.f()}})),r&&Do(n)}(r.eventManager,t),i.length&&r.Dc.To(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function es(e,t,n){return ts.apply(this,arguments)}function ts(){return(ts=(0,u.Z)(v().mark((function e(t,n,r){var i,a,u,o,s,c;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=M(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.Oc.get(n),!(u=a&&a.key)){e.next=14;break}return o=(o=new dn(Te.comparator)).insert(u,Be.newNoDocument(u,te.min())),s=En().add(u),c=new An(te.min(),new Map,new pn(J),o,s),e.next=9,Jo(i,c);case 9:i.kc=i.kc.remove(u),i.Oc.delete(n),vs(i),e.next=16;break;case 14:return e.next=16,Pa(i.localStore,n,!1).then((function(){return ls(i,n,r)})).catch(ta);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ns(e,t){return rs.apply(this,arguments)}function rs(){return(rs=(0,u.Z)(v().mark((function e(t,n){var r,i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M(t),i=n.batch.batchId,e.prev=1,e.next=4,Da(r.localStore,n);case 4:return a=e.sent,cs(r,i,null),ss(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,ys(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,ta(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function is(e,t,n){return as.apply(this,arguments)}function as(){return(as=(0,u.Z)(v().mark((function e(t,n,r){var i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=M(t),e.prev=1,e.next=4,function(e,t){var n=M(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.gs.lookupMutationBatch(e,t).next((function(t){return R(null!==t),r=t.keys(),n.gs.removeMutationBatch(e,t)})).next((function(){return n.gs.performConsistencyCheck(e)})).next((function(){return n.Us.Es(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,cs(i,n,r),ss(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,ys(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,ta(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function us(e,t){return os.apply(this,arguments)}function os(){return(os=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qu((r=M(t)).remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=M(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.gs.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.Fc.get(i)||[]).push(n),r.Fc.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),u=ko(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(u);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}function ss(e,t){(e.Fc.get(t)||[]).forEach((function(e){e.resolve()})),e.Fc.delete(t)}function cs(e,t,n){var r=M(e),i=r.$c[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.$c[r.currentUser.toKey()]=i}}function ls(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=w(e.Nc.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.Cc.delete(a),n&&e.Dc.qc(a,n)}}catch(u){i.e(u)}finally{i.f()}e.Nc.delete(t),e.isPrimaryClient&&e.Mc.si(t).forEach((function(t){e.Mc.containsKey(t)||hs(e,t)}))}function hs(e,t){e.xc.delete(t.path.canonicalString());var n=e.kc.get(t);null!==n&&(Lu(e.remoteStore,n),e.kc=e.kc.remove(t),e.Oc.delete(n),vs(e))}function fs(e,t,n){var r,i=w(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof Po?(e.Mc.addReference(a.key,t),ds(e,a)):a instanceof Vo?(_("SyncEngine","Document no longer in limbo: "+a.key),e.Mc.removeReference(a.key,t),e.Mc.containsKey(a.key)||hs(e,a.key)):O()}}catch(u){i.e(u)}finally{i.f()}}function ds(e,t){var n=t.key,r=n.path.canonicalString();e.kc.get(n)||e.xc.has(r)||(_("SyncEngine","New document in limbo: "+n),e.xc.add(r),vs(e))}function vs(e){for(;e.xc.size>0&&e.kc.size<e.maxConcurrentLimboResolutions;){var t=e.xc.values().next().value;e.xc.delete(t);var n=new Te(ue.fromString(t)),r=e.Bc.next();e.Oc.set(r,new Uo(n)),e.kc=e.kc.insert(n,r),Ru(e.remoteStore,new ai(bt(vt(n.path)),r,2,W.A))}}function ys(e,t,n){return ps.apply(this,arguments)}function ps(){return ps=(0,u.Z)(v().mark((function e(t,n,r){var i,a,o,s;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=M(t),a=[],o=[],s=[],e.t0=i.Cc.isEmpty(),e.t0){e.next=9;break}return i.Cc.forEach((function(e,t){s.push(i.Uc(t,n,r).then((function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),a.push(e);var n=Ea.Ss(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(s);case 6:return i.Dc.To(a),e.next=9,function(){var e=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u,o,s,c,l;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Gr.forEach(n,(function(t){return Gr.forEach(t.vs,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return Gr.forEach(t.Vs,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Hr(e.t0)){e.next=10;break}throw e.t0;case 10:_("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=w(n);try{for(i.s();!(a=i.n()).done;)u=a.value,o=u.targetId,u.fromCache||(s=r.Ms.get(o),c=s.snapshotVersion,l=s.withLastLimboFreeSnapshotVersion(c),r.Ms=r.Ms.insert(o,l))}catch(h){i.e(h)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,o);case 9:case"end":return e.stop()}}),e)}))),ps.apply(this,arguments)}function ms(e,t){return gs.apply(this,arguments)}function gs(){return(gs=(0,u.Z)(v().mark((function e(t,n){var r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=M(t)).currentUser.isEqual(n)){e.next=11;break}return _("SyncEngine","User change. New user:",n.toKey()),e.next=5,_a(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.Fc.forEach((function(e){e.forEach((function(e){e.reject(new V(P.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Fc.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,ys(r,i.qs);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ks(e,t){var n=M(e),r=n.Oc.get(t);if(r&&r.Sc)return En().add(r.key);var i=En(),a=n.Nc.get(t);if(!a)return i;var u,o=w(a);try{for(o.s();!(u=o.n()).done;){var s=u.value,c=n.Cc.get(s);i=i.unionWith(c.view.yc)}}catch(l){o.e(l)}finally{o.f()}return i}function ws(e,t){return bs.apply(this,arguments)}function bs(){return(bs=(0,u.Z)(v().mark((function e(t,n){var r,i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M(t),e.next=3,Fa(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.vc(i),e.abrupt("return",(r.isPrimaryClient&&fs(r,n.targetId,a.Pc),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xs(e){return Is.apply(this,arguments)}function Is(){return(Is=(0,u.Z)(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=M(t),e.abrupt("return",Ua(n.localStore).then((function(e){return ys(n,e)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ts(e,t,n,r){return Es.apply(this,arguments)}function Es(){return(Es=(0,u.Z)(v().mark((function e(t,n,r,i){var a,u;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=M(t),e.next=3,function(e,t){var n=M(e),r=M(n.gs);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.Ge(e,t).next((function(t){return t?n.Us.Es(e,t):Gr.resolve(null)}))}))}(a.localStore,n);case 3:if(null===(u=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,Ju(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(cs(a,n,i||null),ss(a,n),function(e,t){M(M(e).gs).Qe(t)}(a.localStore,n)):O();case 11:return e.next=13,ys(a,u);case 13:e.next=16;break;case 15:_("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ss(e,t){return Ns.apply(this,arguments)}function Ns(){return(Ns=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u,o,s,c,l;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ms(r=M(t)),Ps(r),!0!==n||!0===r.Lc){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,As(r,i.toArray());case 5:return a=e.sent,r.Lc=!0,e.next=9,vo(r.remoteStore,!0);case 9:u=w(a);try{for(u.s();!(o=u.n()).done;)s=o.value,Ru(r.remoteStore,s)}catch(h){u.e(h)}finally{u.f()}e.next=25;break;case 13:if(!1!==n||!1===r.Lc){e.next=25;break}return c=[],l=Promise.resolve(),r.Nc.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?c.push(t):l=l.then((function(){return ls(r,t),Pa(r.localStore,t,!0)})),Lu(r.remoteStore,t)})),e.next=19,l;case 19:return e.next=21,As(r,c);case 21:return function(e){var t=M(e);t.Oc.forEach((function(e,n){Lu(t.remoteStore,n)})),t.Mc.ii(),t.Oc=new Map,t.kc=new dn(Te.comparator)}(r),r.Lc=!1,e.next=25,vo(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function As(e,t,n){return _s.apply(this,arguments)}function _s(){return(_s=(0,u.Z)(v().mark((function e(t,n,r){var i,a,u,o,s,c,l,h,f,d,y,p,m,g;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=M(t),a=[],u=[],o=w(n),e.prev=2,o.s();case 4:if((s=o.n()).done){e.next=45;break}if(c=s.value,l=void 0,!(h=i.Nc.get(c))||0===h.length){e.next=34;break}return e.next=11,Ma(i.localStore,bt(h[0]));case 11:l=e.sent,f=w(h),e.prev=13,f.s();case 15:if((d=f.n()).done){e.next=24;break}return y=d.value,p=i.Cc.get(y),e.next=20,ws(i,p);case 20:(m=e.sent).snapshot&&u.push(m.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),f.e(e.t0);case 29:return e.prev=29,f.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,qa(i.localStore,c);case 36:return g=e.sent,e.next=39,Ma(i.localStore,g);case 39:return l=e.sent,e.next=42,jo(i,Zs(g),c,!1);case 42:a.push(l);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),o.e(e.t1);case 50:return e.prev=50,o.f(),e.finish(50);case 53:return e.abrupt("return",(i.Dc.To(u),a));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])})))).apply(this,arguments)}function Zs(e){return dt(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Ds(e){var t=M(e);return M(M(t.localStore).persistence).ds()}function Cs(e,t,n,r){return Os.apply(this,arguments)}function Os(){return(Os=(0,u.Z)(v().mark((function e(t,n,r,i){var a,u,o;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=M(t)).Lc){e.next=5;break}_("SyncEngine","Ignoring unexpected query state notification."),e.next=21;break;case 5:if(!a.Nc.has(n)){e.next=21;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?9:"rejected"===e.t0?16:20;break;case 9:return e.next=11,Ua(a.localStore);case 11:return u=e.sent,o=An.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),e.next=15,ys(a,u,o);case 15:return e.abrupt("break",21);case 16:return e.next=18,Pa(a.localStore,n,!0);case 18:return ls(a,n,i),e.abrupt("break",21);case 20:O();case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rs(e,t,n){return Ls.apply(this,arguments)}function Ls(){return(Ls=(0,u.Z)(v().mark((function e(t,n,r){var i,a,u,o,s,c,l,h,f;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=Ms(t)).Lc){e.next=45;break}a=w(n),e.prev=3,a.s();case 5:if((u=a.n()).done){e.next=21;break}if(o=u.value,!i.Nc.has(o)){e.next=10;break}return _("SyncEngine","Adding an already active target "+o),e.abrupt("continue",19);case 10:return e.next=12,qa(i.localStore,o);case 12:return s=e.sent,e.next=15,Ma(i.localStore,s);case 15:return c=e.sent,e.next=18,jo(i,Zs(s),c.targetId,!1);case 18:Ru(i.remoteStore,c);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:l=w(r),e.prev=30,f=v().mark((function e(){var t;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.value,e.t0=i.Nc.has(t),!e.t0){e.next=5;break}return e.next=5,Pa(i.localStore,t,!1).then((function(){Lu(i.remoteStore,t),ls(i,t)})).catch(ta);case 5:case"end":return e.stop()}}),e)})),l.s();case 33:if((h=l.n()).done){e.next=37;break}return e.delegateYield(f(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),l.e(e.t2);case 42:return e.prev=42,l.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])})))).apply(this,arguments)}function Ms(e){var t=M(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Jo.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ks.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=es.bind(null,t),t.Dc.To=_o.bind(null,t.eventManager),t.Dc.qc=Zo.bind(null,t.eventManager),t}function Ps(e){var t=M(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ns.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=is.bind(null,t),t}function Vs(e,t,n){var r,i=M(e);(r=(0,u.Z)(v().mark((function e(t,n,r){var i,a,u,o,s;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=M(e),r=Kn(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Kn.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,i);case 6:if(!e.sent){e.next=10;break}return e.next=9,n.close();case 9:return e.abrupt("return",void r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)));case 10:return r._updateProgress(Mo(i)),a=new Lo(i,t.localStore,n.O),e.next=14,n.Kc();case 14:u=e.sent;case 15:if(!u){e.next=25;break}return e.next=18,a.lc(u);case 18:return(o=e.sent)&&r._updateProgress(o),e.next=22,n.Kc();case 22:u=e.sent;case 23:e.next=15;break;case 25:return e.next=27,a.complete();case 27:return s=e.sent,e.next=30,ys(t,s.ws,void 0);case 30:return e.next=32,function(e,t){var n=M(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Kn.saveBundleMetadata(e,t)}))}(t.localStore,i);case 32:r._completeWith(s.progress),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(0),D("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,35]])}))),function(e,t,n){return r.apply(this,arguments)})(i,t,n).then((function(){i.sharedClientState.notifyBundleLoaded()}))}var Fs=function(){function e(){(0,h.Z)(this,e),this.synchronizeTabs=!1}var t,n;return(0,f.Z)(e,[{key:"initialize",value:(n=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.O=xu(t.databaseInfo.databaseId),this.sharedClientState=this.Gc(t),this.persistence=this.jc(t),e.next=5,this.persistence.start();case 5:this.gcScheduler=this.Qc(t),this.localStore=this.Wc(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"Qc",value:function(e){return null}},{key:"Wc",value:function(e){return Aa(this.persistence,new Sa,e.initialUser,this.O)}},{key:"jc",value:function(e){return new nu(iu.bi,this.O)}},{key:"Gc",value:function(e){return new vu}},{key:"terminate",value:(t=(0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),qs=function(e){(0,o.Z)(r,e);var t,n=x(r);function r(e,t,i){var a;return(0,h.Z)(this,r),(a=n.call(this)).zc=e,a.cacheSizeBytes=t,a.forceOwnership=i,a.synchronizeTabs=!1,a}return(0,f.Z)(r,[{key:"initialize",value:(t=(0,u.Z)(v().mark((function e(t){var n=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,c.Z)(r.prototype),"initialize",this).call(this,t);case 2:return e.next=4,Ba(this.localStore);case 4:return e.next=6,this.zc.initialize(this,t);case 6:return e.next=8,Ps(this.zc.syncEngine);case 8:return e.next=10,Ju(this.zc.remoteStore);case 10:return e.next=12,this.persistence.Hn((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"Wc",value:function(e){return Aa(this.persistence,new Sa,e.initialUser,this.O)}},{key:"Qc",value:function(e){var t=this.persistence.referenceDelegate.garbageCollector;return new aa(t,e.asyncQueue)}},{key:"jc",value:function(e){var t=xa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Bi.withCacheSize(this.cacheSizeBytes):Bi.DEFAULT;return new ka(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,wu(),bu(),this.O,this.sharedClientState,!!this.forceOwnership)}},{key:"Gc",value:function(e){return new vu}}]),r}(Fs),Us=function(e){(0,o.Z)(r,e);var t,n=x(r);function r(e,t){var i;return(0,h.Z)(this,r),(i=n.call(this,e,t,!1)).zc=e,i.cacheSizeBytes=t,i.synchronizeTabs=!0,i}return(0,f.Z)(r,[{key:"initialize",value:(t=(0,u.Z)(v().mark((function e(t){var n,a=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,c.Z)(r.prototype),"initialize",this).call(this,t);case 2:if(n=this.zc.syncEngine,e.t0=this.sharedClientState instanceof du,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={hr:Ts.bind(null,n),lr:Cs.bind(null,n),dr:Rs.bind(null,n),ds:Ds.bind(null,n),ar:xs.bind(null,n)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.Hn(function(){var e=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ss(a.zc.syncEngine,t);case 2:a.gcScheduler&&(t&&!a.gcScheduler.started?a.gcScheduler.start(a.localStore):t||a.gcScheduler.stop());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"Gc",value:function(e){var t=wu();if(!du.Vt(t))throw new V(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=xa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new du(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),r}(qs),Bs=function(){function e(){(0,h.Z)(this,e)}var t;return(0,f.Z)(e,[{key:"initialize",value:(t=(0,u.Z)(v().mark((function e(t,n){var r=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return $o(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=ms.bind(null,this.syncEngine),e.next=12,vo(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"createEventManager",value:function(e){return new To}},{key:"createDatastore",value:function(e){var t,n=xu(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new ku(t));return function(e,t,n,r){return new Nu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,u=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return $o(u.syncEngine,e,0)},a=pu.Vt()?new pu:new yu,new _u(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,u){var o=new Bo(e,t,n,r,i,a);return u&&(o.Lc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return(e=(0,u.Z)(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=M(t),_("RemoteStore","RemoteStore shutting down."),n.Ko.add(5),e.next=5,Cu(n);case 5:n.jo.shutdown(),n.Qo.set("Unknown");case 7:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}]),e}();function Ks(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return(0,u.Z)(v().mark((function r(){var i;return v().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return(0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Gs=function(){function e(t){(0,h.Z)(this,e),this.observer=t,this.muted=!1}return(0,f.Z)(e,[{key:"next",value:function(e){this.observer.next&&this.Hc(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Hc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"Jc",value:function(){this.muted=!0}},{key:"Hc",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),js=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.Yc=t,this.O=n,this.metadata=new F,this.buffer=new Uint8Array,this.Xc=new TextDecoder("utf-8"),this.Zc().then((function(e){e&&e.ac()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.payload))))}),(function(e){return r.metadata.reject(e)}))}var t,n,r,i,a,o;return(0,f.Z)(e,[{key:"close",value:function(){return this.Yc.cancel()}},{key:"getMetadata",value:(o=(0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"Kc",value:(a=(0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.Zc());case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"Zc",value:(i=(0,u.Z)(v().mark((function e(){var t,n,r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tu();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.Xc.decode(t),r=Number(n),isNaN(r)&&this.eu("length string (".concat(n,") is not valid number")),e.next=9,this.nu(r);case 9:return i=e.sent,e.abrupt("return",new Oo(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"su",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"tu",value:(r=(0,u.Z)(v().mark((function e(){var t,n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.su()<0)){e.next=7;break}return e.next=3,this.iu();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.su())<0&&this.eu("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"nu",value:(n=(0,u.Z)(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.iu();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.eu("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.Xc.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"eu",value:function(e){throw this.Yc.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"iu",value:(t=(0,u.Z)(v().mark((function e(){var t,n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Yc.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Qs=function(){function e(t){(0,h.Z)(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}var t,n;return(0,f.Z)(e,[{key:"lookup",value:(n=(0,u.Z)(v().mark((function e(t){var n,r=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new V(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=(0,u.Z)(v().mark((function e(t,n){var r,i,a,u,o,s;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M(t),i=Yn(r.O)+"/documents",a={documents:n.map((function(e){return Qn(r.O,e)}))},e.next=5,r.Lr("BatchGetDocuments",i,a);case 5:return u=e.sent,o=new Map,u.forEach((function(e){var t=er(r.O,e);o.set(t.key.toString(),t)})),s=[],e.abrupt("return",(n.forEach((function(e){var t=o.get(e.toString());R(!!t),s.push(t)})),s));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new sn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:(t=(0,u.Z)(v().mark((function e(){var t,n=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=Te.fromPath(t);n.mutations.push(new cn(r,n.precondition(r)))})),e.next=7,function(){var e=(0,u.Z)(v().mark((function e(t,n){var r,i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M(t),i=Yn(r.O)+"/documents",a={writes:n.map((function(e){return tr(r.O,e)}))},e.next=3,r.Mr("Commit",i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw O();t=te.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new V(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Qt.updateTime(t):Qt.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(te.min()))throw new V(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Qt.updateTime(t)}return Qt.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),zs=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.ru=5,this.ro=new Iu(this.asyncQueue,"transaction_retry")}return(0,f.Z)(e,[{key:"run",value:function(){this.ru-=1,this.ou()}},{key:"ou",value:function(){var e=this;this.ro.Hr((0,u.Z)(v().mark((function t(){var n,r;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new Qs(e.datastore),(r=e.cu(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.uu(t)}))}))})).catch((function(t){e.uu(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"cu",value:function(e){try{var t=this.updateFunction(e);return!be(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"uu",value:function(e){var t=this;this.ru>0&&this.au(e)?(this.ru-=1,this.asyncQueue.enqueueAndForget((function(){return t.ou(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"au",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!hn(t)}return!1}}]),e}(),Ws=function(){function e(t,n,r,i){var a=this;(0,h.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=T.UNAUTHENTICATED,this.clientId=Y.R(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(e){return _("FirestoreClient","Received new app check token=",e),a.appCheckCredentialListener(e,a.user)}))}var t;return(0,f.Z)(e,[{key:"getConfiguration",value:(t=(0,u.Z)(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new F;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,u.Z)(v().mark((function n(){var r;return v().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=ko(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function Hs(e,t){return Ys.apply(this,arguments)}function Ys(){return Ys=(0,u.Z)(v().mark((function e(t,n){var r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,_a(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),Ys.apply(this,arguments)}function Js(e,t){return Xs.apply(this,arguments)}function Xs(){return(Xs=(0,u.Z)(v().mark((function e(t,n){var r,i;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,$s(t);case 3:return r=e.sent,_("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener((function(e){return ho(n.remoteStore,e)})),t.setAppCheckTokenChangeListener((function(e,t){return ho(n.remoteStore,t)})),t.onlineComponents=n;case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $s(e){return ec.apply(this,arguments)}function ec(){return(ec=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return _("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,Hs(t,new Fs);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tc(e){return nc.apply(this,arguments)}function nc(){return(nc=(0,u.Z)(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return _("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,Js(t,new Bs);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rc(e){return $s(e).then((function(e){return e.persistence}))}function ic(e){return $s(e).then((function(e){return e.localStore}))}function ac(e){return tc(e).then((function(e){return e.remoteStore}))}function uc(e){return tc(e).then((function(e){return e.syncEngine}))}function oc(e){return sc.apply(this,arguments)}function sc(){return(sc=(0,u.Z)(v().mark((function e(t){var n,r;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tc(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Ko.bind(null,n.syncEngine),r.onUnlisten=zo.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new F;return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function i(){return v().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Gs({next:function(a){t.enqueueAndForget((function(){return No(e,u)}));var o=a.docs.has(n);!o&&a.fromCache?i.reject(new V(P.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&a.fromCache&&r&&"server"===r.source?i.reject(new V(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),u=new Co(vt(n.path),a,{includeMetadataChanges:!0,uc:!0});return Eo(e,u)},i.next=3,oc(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function lc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new F;return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function i(){return v().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Gs({next:function(n){t.enqueueAndForget((function(){return No(e,u)})),n.fromCache&&"server"===r.source?i.reject(new V(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),u=new Co(n,a,{includeMetadataChanges:!0,uc:!0});return Eo(e,u)},i.next=3,oc(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}var hc=new Map;function fc(e,t,n){if(!n)throw new V(P.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function dc(e,t,n,r){if(!0===t&&!0===r)throw new V(P.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function vc(e){if(!Te.isDocumentKey(e))throw new V(P.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function yc(e){if(Te.isDocumentKey(e))throw new V(P.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function pc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":O()}function mc(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new V(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=pc(e);throw new V(P.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function gc(e,t){if(t<=0)throw new V(P.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var kc=function(){function e(t){var n;if((0,h.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new V(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new V(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,dc("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return(0,f.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),wc=function(){function e(t,n,r){(0,h.Z)(this,e),this._authCredentials=n,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new kc({}),this._settingsFrozen=!1,t instanceof we?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new V(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new we(e.options.projectId)}(t))}return(0,f.Z)(e,[{key:"app",get:function(){if(!this._app)throw new V(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new V(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kc(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new U;switch(e.type){case"gapi":var t=e.client;return R(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new j(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new V(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return e=this,(t=hc.get(e))&&(_("ComponentProvider","Removing Datastore"),hc.delete(e),t.terminate()),Promise.resolve();var e,t}}]),e}();function bc(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=mc(e,wc))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==t&&D("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},a),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var u,o;if("string"==typeof i.mockUserToken)u=i.mockUserToken,o=T.MOCK_USER;else{u=(0,g.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new V(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new T(s)}e._authCredentials=new B(new q(u,o))}}var xc=function(){function e(t,n,r){(0,h.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,f.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Tc(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),Ic=function(){function e(t,n,r){(0,h.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,f.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),Tc=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this,e,r,vt(i)))._path=i,a.type="collection",a}return(0,f.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new xc(this.firestore,null,new Te(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(Ic);function Ec(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,g.m9)(e),fc("collection","path",t),e instanceof wc){var a=ue.fromString.apply(ue,[t].concat(r));return yc(a),new Tc(e,null,a)}if(!(e instanceof xc||e instanceof Tc))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(ue.fromString.apply(ue,[t].concat(r)));return yc(u),new Tc(e.firestore,null,u)}function Sc(e,t){if(e=mc(e,wc),fc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new V(P.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new Ic(e,null,function(e){return new ft(ue.emptyPath(),e)}(t))}function Nc(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,g.m9)(e),1===arguments.length&&(t=Y.R()),fc("doc","path",t),e instanceof wc){var a=ue.fromString.apply(ue,[t].concat(r));return vc(a),new xc(e,null,new Te(a))}if(!(e instanceof xc||e instanceof Tc))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(ue.fromString.apply(ue,[t].concat(r)));return vc(u),new xc(e.firestore,e instanceof Tc?e.converter:null,new Te(u))}function Ac(e,t){return e=(0,g.m9)(e),t=(0,g.m9)(t),(e instanceof xc||e instanceof Tc)&&(t instanceof xc||t instanceof Tc)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function _c(e,t){return e=(0,g.m9)(e),t=(0,g.m9)(t),e instanceof Ic&&t instanceof Ic&&e.firestore===t.firestore&&It(e._query,t._query)&&e.converter===t.converter}var Zc=function(){function e(){var t=this;(0,h.Z)(this,e),this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new Iu(this,"async_queue_retry"),this.yu=function(){var e=bu();e&&_("AsyncQueue","Visibility state changed to "+e.visibilityState),t.ro.Yr()};var n=bu();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.yu)}var t,n;return(0,f.Z)(e,[{key:"isShuttingDown",get:function(){return this.fu}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.pu(),this.Iu(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.fu){this.fu=!0,this.mu=e||!1;var t=bu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.yu)}}},{key:"enqueue",value:function(e){var t=this;if(this.pu(),this.fu)return new Promise((function(){}));var n=new F;return this.Iu((function(){return t.fu&&t.mu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.lu.push(e),t.Eu()}))}},{key:"Eu",value:(n=(0,u.Z)(v().mark((function e(){var t=this;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.lu.length){e.next=14;break}return e.prev=1,e.next=4,this.lu[0]();case 4:this.lu.shift(),this.ro.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Hr(e.t0)){e.next=12;break}throw e.t0;case 12:_("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.lu.length>0&&this.ro.Hr((function(){return t.Eu()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return n.apply(this,arguments)})},{key:"Iu",value:function(e){var t=this,n=this.hu.then((function(){return t.wu=!0,e().catch((function(e){t._u=e,t.wu=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Z("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.wu=!1,e}))}));return this.hu=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.pu(),this.gu.indexOf(e)>-1&&(t=0);var i=go.createAndSchedule(this,e,t,n,(function(e){return r.Tu(e)}));return this.du.push(i),i}},{key:"pu",value:function(){this._u&&O()}},{key:"verifyOperationInProgress",value:function(){}},{key:"Au",value:(t=(0,u.Z)(v().mark((function e(){var t;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.hu,e.next=3,t;case 3:if(t!==this.hu){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"Ru",value:function(e){var t,n=w(this.du);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Pu",value:function(e){var t=this;return this.Au().then((function(){t.du.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=w(t.du);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.Au()}))}},{key:"bu",value:function(e){this.gu.push(e)}},{key:"Tu",value:function(e){var t=this.du.indexOf(e);this.du.splice(t,1)}}]),e}();function Dc(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=w(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e)}var Cc=function(){function e(){(0,h.Z)(this,e),this._progressObserver={},this._taskCompletionResolver=new F,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return(0,f.Z)(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),Oc=-1,Rc=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this,e,r,i)).type="firestore",a._queue=new Zc,a._persistenceKey="name"in e?e.name:"[DEFAULT]",a}return(0,f.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||Mc(this),this._firestoreClient.terminate()}}]),n}(wc);function Lc(e){return e._firestoreClient||Mc(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Mc(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new ke(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Ws(e._authCredentials,e._appCheckCredentials,e._queue,r)}function Pc(e,t){Qc(e=mc(e,Rc));var n=Lc(e),r=e._freezeSettings(),i=new Bs;return Fc(n,i,new qs(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function Vc(e){Qc(e=mc(e,Rc));var t=Lc(e),n=e._freezeSettings(),r=new Bs;return Fc(t,r,new Us(r,n.cacheSizeBytes))}function Fc(e,t,n){var r=new F;return e.asyncQueue.enqueue((0,u.Z)(v().mark((function i(){return v().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Hs(e,n);case 3:return i.next=5,Js(e,t);case 5:r.resolve(),i.next=13;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return"FirebaseError"===e.name?e.code===P.FAILED_PRECONDITION||e.code===P.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(i.t0)){i.next=12;break}throw i.t0;case 12:console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i.t0),r.reject(i.t0);case 13:case"end":return i.stop()}}),i,null,[[0,8]])})))).then((function(){return r.promise}))}function qc(e){if(e._initialized&&!e._terminated)throw new V(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new F;return e._queue.enqueueAndForgetEvenWhileRestricted((0,u.Z)(v().mark((function n(){return v().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=(0,u.Z)(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Qr.Vt()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Qr.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(xa(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}function Uc(e){return function(e){var t=new F;return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function n(){return v().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=us,n.next=3,uc(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(Lc(e=mc(e,Rc)))}function Bc(e){return function(e){return e.asyncQueue.enqueue((0,u.Z)(v().mark((function t(){var n,r;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rc(e);case 2:return n=t.sent,t.next=5,ac(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=M(e);return t.Ko.delete(0),Zu(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(Lc(e=mc(e,Rc)))}function Kc(e){return function(e){return e.asyncQueue.enqueue((0,u.Z)(v().mark((function t(){var n,r;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rc(e);case 2:return n=t.sent,t.next=5,ac(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=(0,u.Z)(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=M(t)).Ko.add(0),e.next=4,Cu(n);case 4:n.Qo.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(Lc(e=mc(e,Rc)))}function Gc(e,t){var n=Lc(e=mc(e,Rc)),r=new Cc;return function(e,t,n,r){var i=function(e,t){return function(e,t){return new js(e,t)}(function(e,t){if(e instanceof Uint8Array)return Ks(e,t);if(e instanceof ArrayBuffer)return Ks(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,xu(t));e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function t(){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Vs,t.next=3,uc(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function jc(e,t){return function(e,t){return e.asyncQueue.enqueue((0,u.Z)(v().mark((function n(){return v().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=M(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Kn.getNamedQuery(e,t)}))},n.next=3,ic(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(Lc(e=mc(e,Rc)),t).then((function(t){return t?new Ic(e,null,t.query):null}))}function Qc(e){if(e._initialized||e._terminated)throw new V(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var zc=function(){function e(){(0,h.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new V(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new se(n)}return(0,f.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();var Wc=function(){function e(t){(0,h.Z)(this,e),this._byteString=t}return(0,f.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(he.fromBase64String(t))}catch(t){throw new V(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(he.fromUint8Array(t))}}]),e}(),Hc=(0,f.Z)((function e(t){(0,h.Z)(this,e),this._methodName=t})),Yc=function(){function e(t,n){if((0,h.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new V(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new V(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,f.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return J(this._lat,e._lat)||J(this._long,e._long)}}]),e}(),Jc=/^__.*__$/,Xc=function(){function e(t,n,r){(0,h.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,f.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new tn(e,this.data,this.fieldMask,t,this.fieldTransforms):new en(e,this.data,t,this.fieldTransforms)}}]),e}(),$c=function(){function e(t,n,r){(0,h.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,f.Z)(e,[{key:"toMutation",value:function(e,t){return new tn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function el(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O()}}var tl=function(){function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.settings=t,this.databaseId=n,this.O=r,this.ignoreUndefinedProperties=i,void 0===a&&this.vu(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return(0,f.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"Vu",get:function(){return this.settings.Vu}},{key:"Su",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Du",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Su({path:n,Cu:!1});return r.Nu(e),r}},{key:"xu",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Su({path:n,Cu:!1});return r.vu(),r}},{key:"ku",value:function(e){return this.Su({path:void 0,Cu:!0})}},{key:"Ou",value:function(e){return bl(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"vu",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.Nu(this.path.get(e))}},{key:"Nu",value:function(e){if(0===e.length)throw this.Ou("Document fields must not be empty");if(el(this.Vu)&&Jc.test(e))throw this.Ou('Document fields cannot begin and end with "__"')}}]),e}(),nl=function(){function e(t,n,r){(0,h.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.O=r||xu(t)}return(0,f.Z)(e,[{key:"Fu",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new tl({Vu:e,methodName:t,$u:n,path:se.emptyPath(),Cu:!1,Mu:r},this.databaseId,this.O,this.ignoreUndefinedProperties)}}]),e}();function rl(e){var t=e._freezeSettings(),n=xu(e._databaseId);return new nl(e._databaseId,!!t.ignoreUndefinedProperties,n)}function il(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=e.Fu(a.merge||a.mergeFields?2:0,t,n,i);ml("Data must be an object, but it was:",u,r);var o,s,c=yl(r,u);if(a.merge)o=new ce(u.fieldMask),s=u.fieldTransforms;else if(a.mergeFields){var l,h=[],f=w(a.mergeFields);try{for(f.s();!(l=f.n()).done;){var d=l.value,v=gl(t,d,n);if(!u.contains(v))throw new V(P.INVALID_ARGUMENT,"Field '".concat(v,"' is specified in your field mask but missing from your input data."));xl(h,v)||h.push(v)}}catch(y){f.e(y)}finally{f.f()}o=new ce(h),s=u.fieldTransforms.filter((function(e){return o.covers(e.field)}))}else o=null,s=u.fieldTransforms;return new Xc(new qe(c),o,s)}var al=function(e){(0,o.Z)(n,e);var t=x(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.Vu)throw 1===e.Vu?e.Ou("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Ou("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Hc);function ul(e,t,n){return new tl({Vu:3,$u:t.settings.$u,methodName:e._methodName,Cu:n},t.databaseId,t.O,t.ignoreUndefinedProperties)}var ol=function(e){(0,o.Z)(n,e);var t=x(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"_toFieldTransform",value:function(e){return new Gt(e.path,new Mt)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Hc),sl=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).Bu=r,i}return(0,f.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=ul(this,e,!0),n=this.Bu.map((function(e){return vl(e,t)})),r=new Pt(n);return new Gt(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Hc),cl=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).Bu=r,i}return(0,f.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=ul(this,e,!0),n=this.Bu.map((function(e){return vl(e,t)})),r=new Ft(n);return new Gt(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Hc),ll=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).Lu=r,i}return(0,f.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=new Ut(e.O,Dt(e.O,this.Lu));return new Gt(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Hc);function hl(e,t,n,r){var i=e.Fu(1,t,n);ml("Data must be an object, but it was:",i,r);var a=[],u=qe.empty();re(r,(function(e,r){var o=wl(t,e,n);r=(0,g.m9)(r);var s=i.xu(o);if(r instanceof al)a.push(o);else{var c=vl(r,s);null!=c&&(a.push(o),u.set(o,c))}}));var o=new ce(a);return new $c(u,o,i.fieldTransforms)}function fl(e,t,n,r,i,a){var u=e.Fu(1,t,n),o=[gl(t,r,n)],s=[i];if(a.length%2!=0)throw new V(P.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)o.push(gl(t,a[c])),s.push(a[c+1]);for(var l=[],h=qe.empty(),f=o.length-1;f>=0;--f)if(!xl(l,o[f])){var d=o[f],v=s[f];v=(0,g.m9)(v);var y=u.xu(d);if(v instanceof al)l.push(d);else{var p=vl(v,y);null!=p&&(l.push(d),h.set(d,p))}}var m=new ce(l);return new $c(h,m,u.fieldTransforms)}function dl(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return vl(n,e.Fu(r?4:3,t))}function vl(e,t){if(pl(e=(0,g.m9)(e)))return ml("Unsupported field value:",t,e),yl(e,t);if(e instanceof Hc)return function(e,t){if(!el(t.Vu))throw t.Ou("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Ou("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Cu&&4!==t.Vu)throw t.Ou("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=w(e);try{for(a.s();!(n=a.n()).done;){var u=vl(n.value,t.ku(i));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),i++}}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,g.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Dt(t.O,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=ee.fromDate(e);return{timestampValue:qn(t.O,n)}}if(e instanceof ee){var r=new ee(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:qn(t.O,r)}}if(e instanceof Yc)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Wc)return{bytesValue:Un(t.O,e._byteString)};if(e instanceof xc){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.Ou("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Gn(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ou("Unsupported field value: ".concat(pc(e)))}(e,t)}function yl(e,t){var n={};return ie(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):re(e,(function(e,r){var i=vl(r,t.Du(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function pl(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ee||e instanceof Yc||e instanceof Wc||e instanceof xc||e instanceof Hc)}function ml(e,t,n){if(!pl(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=pc(n);throw"an object"===r?t.Ou(e+" a custom object"):t.Ou(e+" "+r)}}function gl(e,t,n){if((t=(0,g.m9)(t))instanceof zc)return t._internalPath;if("string"==typeof t)return wl(e,t);throw bl("Field path arguments must be of type string or ",e,!1,void 0,n)}var kl=new RegExp("[~\\*/\\[\\]]");function wl(e,t,n){if(t.search(kl)>=0)throw bl("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,r.Z)(zc,(0,l.Z)(t.split(".")))._internalPath}catch(i){throw bl("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function bl(e,t,n,r,i){var a=r&&!r.isEmpty(),u=void 0!==i,o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";var s="";return(a||u)&&(s+=" (found",a&&(s+=" in field ".concat(r)),u&&(s+=" in document ".concat(i)),s+=")"),new V(P.INVALID_ARGUMENT,o+e+s)}function xl(e,t){return e.some((function(e){return e.isEqual(t)}))}var Il=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,f.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new xc(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new Tl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(El("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),Tl=function(e){(0,o.Z)(n,e);var t=x(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"data",value:function(){return(0,i.Z)((0,c.Z)(n.prototype),"data",this).call(this)}}]),n}(Il);function El(e,t){return"string"==typeof t?wl(e,t):t instanceof zc?t._internalPath:t._delegate._internalPath}var Sl=function(){function e(t,n){(0,h.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,f.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),Nl=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i,a,u,o){var s;return(0,h.Z)(this,n),(s=t.call(this,e,r,i,a,o))._firestore=e,s._firestoreImpl=e,s.metadata=u,s}return(0,f.Z)(n,[{key:"exists",value:function(){return(0,i.Z)((0,c.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new Al(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(El("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(Il),Al=function(e){(0,o.Z)(n,e);var t=x(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.Z)((0,c.Z)(n.prototype),"data",this).call(this,e)}}]),n}(Nl),_l=function(){function e(t,n,r,i){(0,h.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new Sl(i.hasPendingWrites,i.fromCache),this.query=r}return(0,f.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new Al(n._firestore,n._userDataWriter,r.key,r,new Sl(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){return{type:"added",doc:new Al(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Sl(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new Al(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Sl(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:Zl(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function Zl(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O()}}function Dl(e,t){return e instanceof Nl&&t instanceof Nl?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof _l&&t instanceof _l&&e._firestore===t._firestore&&_c(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Cl(e){if(pt(e)&&0===e.explicitOrderBy.length)throw new V(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ol=(0,f.Z)((function e(){(0,h.Z)(this,e)}));function Rl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=u._apply(e)}return e}var Ll=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).Uu=e,a.qu=r,a.Ku=i,a.type="where",a}return(0,f.Z)(n,[{key:"_apply",value:function(e){var t=rl(e.firestore),n=function(e,t,n,r,i,a,u){var o;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new V(P.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){Yl(u,a);var s,c=[],l=w(u);try{for(l.s();!(s=l.n()).done;){var h=s.value;c.push(Hl(r,e,h))}}catch(d){l.e(d)}finally{l.f()}o={arrayValue:{values:c}}}else o=Hl(r,e,u)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||Yl(u,a),o=dl(n,"where",u,"in"===a||"not-in"===a);var f=Xe.create(i,a,o);return function(e,t){if(t.S()){var n=gt(e);if(null!==n&&!n.isEqual(t.field))throw new V(P.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=mt(e);null!==r&&Jl(e,t.field,r)}var i=function(e,t){var n,r=w(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(d){r.e(d)}finally{r.f()}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw i===t.op?new V(P.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new V(P.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(e,f),f}(e._query,0,t,e.firestore._databaseId,this.Uu,this.qu,this.Ku);return new Ic(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new ft(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}(Ol);function Ml(e,t,n){var r=t,i=El("where",e);return new Ll(i,r,n)}var Pl=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).Uu=e,i.Gu=r,i.type="orderBy",i}return(0,f.Z)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new V(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new V(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new st(t,n);return function(e,t){if(null===mt(e)){var n=gt(e);null!==n&&Jl(e,n,t.field)}}(e,r),r}(e._query,this.Uu,this.Gu);return new Ic(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new ft(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}(Ol);function Vl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=t,r=El("orderBy",e);return new Pl(r,n)}var Fl=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.ju=r,a.Qu=i,a}return(0,f.Z)(n,[{key:"_apply",value:function(e){return new Ic(e.firestore,e.converter,xt(e._query,this.ju,this.Qu))}}]),n}(Ol);function ql(e){return gc("limit",e),new Fl("limit",e,"F")}function Ul(e){return gc("limitToLast",e),new Fl("limitToLast",e,"L")}var Bl=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.Wu=r,a.zu=i,a}return(0,f.Z)(n,[{key:"_apply",value:function(e){var t=Wl(e,this.type,this.Wu,this.zu);return new Ic(e.firestore,e.converter,function(e,t){return new ft(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}(Ol);function Kl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Bl("startAt",t,!0)}function Gl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Bl("startAfter",t,!1)}var jl=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.Wu=r,a.zu=i,a}return(0,f.Z)(n,[{key:"_apply",value:function(e){var t=Wl(e,this.type,this.Wu,this.zu);return new Ic(e.firestore,e.converter,function(e,t){return new ft(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}(Ol);function Ql(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new jl("endBefore",t,!1)}function zl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new jl("endAt",t,!0)}function Wl(e,t,n,r){if(n[0]=(0,g.m9)(n[0]),n[0]instanceof Il)return function(e,t,n,r,i){if(!r)throw new V(P.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,u=[],o=w(wt(e));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.field.isKeyField())u.push(Oe(t,r.key));else{var c=r.data.field(s.field);if(pe(c))throw new V(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=s.field.canonicalString();throw new V(P.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(l,"' (used as the orderBy) does not exist."))}u.push(c)}}}catch(h){o.e(h)}finally{o.f()}return new ot(u,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=rl(e.firestore);return function(e,t,n,r,i,a){var u=e.explicitOrderBy;if(i.length>u.length)throw new V(P.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var o=[],s=0;s<i.length;s++){var c=i[s];if(u[s].field.isKeyField()){if("string"!=typeof c)throw new V(P.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!kt(e)&&-1!==c.indexOf("/"))throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(ue.fromString(c));if(!Te.isDocumentKey(l))throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var h=new Te(l);o.push(Oe(t,h))}else{var f=dl(n,r,c);o.push(f)}}return new ot(o,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function Hl(e,t,n){if("string"==typeof(n=(0,g.m9)(n))){if(""===n)throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kt(t)&&-1!==n.indexOf("/"))throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(ue.fromString(n));if(!Te.isDocumentKey(r))throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Oe(e,new Te(r))}if(n instanceof xc)return Oe(e,n._key);throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(pc(n),"."))}function Yl(e,t){if(!Array.isArray(e)||0===e.length)throw new V(P.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new V(P.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function Jl(e,t,n){if(!n.isEqual(t))throw new V(P.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var Xl=function(){function e(){(0,h.Z)(this,e)}return(0,f.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Se(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ye(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw O()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return re(e.fields,(function(e,i){r[e]=n.convertValue(i,t)})),r}},{key:"convertGeoPoint",value:function(e){return new Yc(ve(e.latitude),ve(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=me(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ge(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=de(e);return new ee(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=ue.fromString(e);R(vr(n));var r=new we(n.get(1),n.get(3)),i=new Te(n.popFirst(5));return r.isEqual(t)||Z("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function $l(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var eh=function(e){(0,o.Z)(n,e);var t=x(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,f.Z)(n,[{key:"convertBytes",value:function(e){return new Wc(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new xc(this.firestore,null,t)}}]),n}(Xl),th=function(){function e(t,n){(0,h.Z)(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=rl(t)}return(0,f.Z)(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=nh(e,this._firestore),i=$l(r.converter,t,n),a=il(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,Qt.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=nh(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,g.m9)(t))||t instanceof zc?fl(this._dataReader,"WriteBatch.update",i._key,t,n,u):hl(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Qt.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=nh(e,this._firestore);return this._mutations=this._mutations.concat(new sn(t._key,Qt.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new V(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function nh(e,t){if((e=(0,g.m9)(e)).firestore!==t)throw new V(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function rh(e){e=mc(e,xc);var t=mc(e.firestore,Rc);return cc(Lc(t),e._key).then((function(n){return mh(t,e,n)}))}var ih=function(e){(0,o.Z)(n,e);var t=x(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,f.Z)(n,[{key:"convertBytes",value:function(e){return new Wc(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new xc(this.firestore,null,t)}}]),n}(Xl);function ah(e){e=mc(e,xc);var t=mc(e.firestore,Rc),n=Lc(t),r=new ih(t);return function(e,t){var n=new F;return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function r(){return v().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,u.Z)(v().mark((function e(t,n,r){var i,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=M(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.Us.ys(e,t)}))}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new V(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=ko(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,ic(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new Nl(t,r,e._key,n,new Sl(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function uh(e){e=mc(e,xc);var t=mc(e.firestore,Rc);return cc(Lc(t),e._key,{source:"server"}).then((function(n){return mh(t,e,n)}))}function oh(e){e=mc(e,Ic);var t=mc(e.firestore,Rc),n=Lc(t),r=new ih(t);return Cl(e._query),lc(n,e._query).then((function(n){return new _l(t,r,e,n)}))}function sh(e){e=mc(e,Ic);var t=mc(e.firestore,Rc),n=Lc(t),r=new ih(t);return function(e,t){var n=new F;return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function r(){return v().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,u.Z)(v().mark((function e(t,n,r){var i,a,u,o,s;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Fa(t,n,!0);case 3:i=e.sent,a=new Fo(n,i.Ks),u=a.Ic(i.documents),o=a.applyChanges(u,!1),r.resolve(o.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=ko(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(s);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,ic(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new _l(t,r,e,n)}))}function ch(e){e=mc(e,Ic);var t=mc(e.firestore,Rc),n=Lc(t),r=new ih(t);return lc(n,e._query,{source:"server"}).then((function(n){return new _l(t,r,e,n)}))}function lh(e,t,n){e=mc(e,xc);var r=mc(e.firestore,Rc),i=$l(e.converter,t,n);return ph(r,[il(rl(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Qt.none())])}function hh(e,t,n){e=mc(e,xc);for(var r=mc(e.firestore,Rc),i=rl(r),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return ph(r,[("string"==typeof(t=(0,g.m9)(t))||t instanceof zc?fl(i,"updateDoc",e._key,t,n,u):hl(i,"updateDoc",e._key,t)).toMutation(e._key,Qt.exists(!0))])}function fh(e){return ph(mc(e.firestore,Rc),[new sn(e._key,Qt.none())])}function dh(e,t){var n=mc(e.firestore,Rc),r=Nc(e),i=$l(e.converter,t);return ph(n,[il(rl(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Qt.exists(!1))]).then((function(){return r}))}function vh(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,o;e=(0,g.m9)(e);var s={includeMetadataChanges:!1},c=0;"object"!=typeof n[c]||Dc(n[c])||(s=n[c],c++);var l,h,f,d={includeMetadataChanges:s.includeMetadataChanges};if(Dc(n[c])){var y=n[c];n[c]=null===(i=y.next)||void 0===i?void 0:i.bind(y),n[c+1]=null===(a=y.error)||void 0===a?void 0:a.bind(y),n[c+2]=null===(o=y.complete)||void 0===o?void 0:o.bind(y)}if(e instanceof xc)h=mc(e.firestore,Rc),f=vt(e._key.path),l={next:function(t){n[c]&&n[c](mh(h,e,t))},error:n[c+1],complete:n[c+2]};else{var p=mc(e,Ic);h=mc(p.firestore,Rc),f=p._query;var m=new ih(h);l={next:function(e){n[c]&&n[c](new _l(h,m,p,e))},error:n[c+1],complete:n[c+2]},Cl(e._query)}return function(e,t,n,r){var i=new Gs(r),a=new Co(t,i,n);return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function t(){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Eo,t.next=3,oc(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.Jc(),e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function t(){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=No,t.next=3,oc(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(Lc(h),f,d,l)}function yh(e,t){return function(e,t){var n=new Gs(t);return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function t(){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){M(e).Zo.add(t),t.next()},t.next=3,oc(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.Jc(),e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function t(){return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){M(e).Zo.delete(t)},t.next=3,oc(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(Lc(e=mc(e,Rc)),Dc(t)?t:{next:t})}function ph(e,t){return function(e,t){var n=new F;return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function r(){return v().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Ho,r.next=3,uc(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(Lc(e),t)}function mh(e,t,n){var r=n.docs.get(t._key),i=new ih(e);return new Nl(e,i,t._key,r,new Sl(n.hasPendingWrites,n.fromCache),t.converter)}var gh=function(e){(0,o.Z)(n,e);var t=x(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,r))._firestore=e,i}return(0,f.Z)(n,[{key:"get",value:function(e){var t=this,r=nh(e,this._firestore),a=new ih(this._firestore);return(0,i.Z)((0,c.Z)(n.prototype),"get",this).call(this,e).then((function(e){return new Nl(t._firestore,a,r._key,e._document,new Sl(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){(0,h.Z)(this,e),this._firestore=t,this._transaction=n,this._dataReader=rl(t)}return(0,f.Z)(e,[{key:"get",value:function(e){var t=this,n=nh(e,this._firestore),r=new eh(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return O();var i=e[0];if(i.isFoundDocument())return new Il(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Il(t._firestore,r,n._key,null,n.converter);throw O()}))}},{key:"set",value:function(e,t,n){var r=nh(e,this._firestore),i=$l(r.converter,t,n),a=il(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=nh(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,g.m9)(t))||t instanceof zc?fl(this._dataReader,"Transaction.update",i._key,t,n,u):hl(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=nh(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function kh(e,t){return function(e,t){var n=new F;return e.asyncQueue.enqueueAndForget((0,u.Z)(v().mark((function r(){var i;return v().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,function(e){return tc(e).then((function(e){return e.datastore}))}(e);case 2:i=r.sent,new zs(e.asyncQueue,i,t,n).run();case 4:case"end":return r.stop()}}),r)})))),n.promise}(Lc(e=mc(e,Rc)),(function(n){return t(new gh(e,n))}))}function wh(){return new al("deleteField")}function bh(){return new ol("serverTimestamp")}function xh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new sl("arrayUnion",t)}function Ih(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new cl("arrayRemove",t)}function Th(e){return new ll("increment",e)}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){E=e}(y.SDK_VERSION),(0,y._registerComponent)(new p.wA("firestore",(function(e,n){var r=n.options,i=e.getProvider("app").getImmediate(),a=new Rc(i,new K(e.getProvider("auth-internal")),new z(e.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a}),"PUBLIC")),(0,y.registerVersion)(I,"3.4.5",e),(0,y.registerVersion)(I,"3.4.5","esm2017")}()}}]);
//# sourceMappingURL=7112840a-07cf941e05b1d1a424f4.js.map